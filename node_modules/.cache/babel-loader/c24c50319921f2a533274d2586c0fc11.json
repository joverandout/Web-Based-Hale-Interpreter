{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { createCancelablePromise, RunOnceScheduler } from '../../../../base/common/async.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { DocumentRangeSemanticTokensProviderRegistry } from '../../../common/languages.js';\nimport { getDocumentRangeSemanticTokens, hasDocumentRangeSemanticTokensProvider } from '../../../common/services/getSemanticTokens.js';\nimport { IModelService } from '../../../common/services/model.js';\nimport { isSemanticColoringEnabled, SEMANTIC_HIGHLIGHTING_SETTING_ID } from '../../../common/services/modelService.js';\nimport { toMultilineTokens2 } from '../../../common/services/semanticTokensProviderStyling.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nlet ViewportSemanticTokensContribution = class ViewportSemanticTokensContribution extends Disposable {\n  constructor(editor, _modelService, _themeService, _configurationService, languageFeatureDebounceService) {\n    super();\n    this._modelService = _modelService;\n    this._themeService = _themeService;\n    this._configurationService = _configurationService;\n    this._editor = editor;\n    this._debounceInformation = languageFeatureDebounceService.for(DocumentRangeSemanticTokensProviderRegistry, 'DocumentRangeSemanticTokens', {\n      min: 100,\n      max: 500\n    });\n    this._tokenizeViewport = new RunOnceScheduler(() => this._tokenizeViewportNow(), 100);\n    this._outstandingRequests = [];\n\n    const scheduleTokenizeViewport = () => {\n      if (this._editor.hasModel()) {\n        this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()));\n      }\n    };\n\n    this._register(this._editor.onDidScrollChange(() => {\n      scheduleTokenizeViewport();\n    }));\n\n    this._register(this._editor.onDidChangeModel(() => {\n      this._cancelAll();\n\n      scheduleTokenizeViewport();\n    }));\n\n    this._register(this._editor.onDidChangeModelContent(e => {\n      this._cancelAll();\n\n      scheduleTokenizeViewport();\n    }));\n\n    this._register(DocumentRangeSemanticTokensProviderRegistry.onDidChange(() => {\n      this._cancelAll();\n\n      scheduleTokenizeViewport();\n    }));\n\n    this._register(this._configurationService.onDidChangeConfiguration(e => {\n      if (e.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)) {\n        this._cancelAll();\n\n        scheduleTokenizeViewport();\n      }\n    }));\n\n    this._register(this._themeService.onDidColorThemeChange(() => {\n      this._cancelAll();\n\n      scheduleTokenizeViewport();\n    }));\n  }\n\n  _cancelAll() {\n    for (const request of this._outstandingRequests) {\n      request.cancel();\n    }\n\n    this._outstandingRequests = [];\n  }\n\n  _removeOutstandingRequest(req) {\n    for (let i = 0, len = this._outstandingRequests.length; i < len; i++) {\n      if (this._outstandingRequests[i] === req) {\n        this._outstandingRequests.splice(i, 1);\n\n        return;\n      }\n    }\n  }\n\n  _tokenizeViewportNow() {\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    const model = this._editor.getModel();\n\n    if (model.hasCompleteSemanticTokens()) {\n      return;\n    }\n\n    if (!isSemanticColoringEnabled(model, this._themeService, this._configurationService)) {\n      if (model.hasSomeSemanticTokens()) {\n        model.setSemanticTokens(null, false);\n      }\n\n      return;\n    }\n\n    if (!hasDocumentRangeSemanticTokensProvider(model)) {\n      if (model.hasSomeSemanticTokens()) {\n        model.setSemanticTokens(null, false);\n      }\n\n      return;\n    }\n\n    const visibleRanges = this._editor.getVisibleRangesPlusViewportAboveBelow();\n\n    this._outstandingRequests = this._outstandingRequests.concat(visibleRanges.map(range => this._requestRange(model, range)));\n  }\n\n  _requestRange(model, range) {\n    const requestVersionId = model.getVersionId();\n    const request = createCancelablePromise(token => Promise.resolve(getDocumentRangeSemanticTokens(model, range, token)));\n    const sw = new StopWatch(false);\n    request.then(r => {\n      this._debounceInformation.update(model, sw.elapsed());\n\n      if (!r || !r.tokens || model.isDisposed() || model.getVersionId() !== requestVersionId) {\n        return;\n      }\n\n      const {\n        provider,\n        tokens: result\n      } = r;\n\n      const styling = this._modelService.getSemanticTokensProviderStyling(provider);\n\n      model.setPartialSemanticTokens(range, toMultilineTokens2(result, styling, model.getLanguageId()));\n    }).then(() => this._removeOutstandingRequest(request), () => this._removeOutstandingRequest(request));\n    return request;\n  }\n\n};\nViewportSemanticTokensContribution.ID = 'editor.contrib.viewportSemanticTokens';\nViewportSemanticTokensContribution = __decorate([__param(1, IModelService), __param(2, IThemeService), __param(3, IConfigurationService), __param(4, ILanguageFeatureDebounceService)], ViewportSemanticTokensContribution);\nregisterEditorContribution(ViewportSemanticTokensContribution.ID, ViewportSemanticTokensContribution);","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/viewportSemanticTokens/browser/viewportSemanticTokens.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","createCancelablePromise","RunOnceScheduler","Disposable","registerEditorContribution","DocumentRangeSemanticTokensProviderRegistry","getDocumentRangeSemanticTokens","hasDocumentRangeSemanticTokensProvider","IModelService","isSemanticColoringEnabled","SEMANTIC_HIGHLIGHTING_SETTING_ID","toMultilineTokens2","IConfigurationService","IThemeService","ILanguageFeatureDebounceService","StopWatch","ViewportSemanticTokensContribution","constructor","editor","_modelService","_themeService","_configurationService","languageFeatureDebounceService","_editor","_debounceInformation","for","min","max","_tokenizeViewport","_tokenizeViewportNow","_outstandingRequests","scheduleTokenizeViewport","hasModel","schedule","get","getModel","_register","onDidScrollChange","onDidChangeModel","_cancelAll","onDidChangeModelContent","e","onDidChange","onDidChangeConfiguration","affectsConfiguration","onDidColorThemeChange","request","cancel","_removeOutstandingRequest","req","len","splice","model","hasCompleteSemanticTokens","hasSomeSemanticTokens","setSemanticTokens","visibleRanges","getVisibleRangesPlusViewportAboveBelow","concat","map","range","_requestRange","requestVersionId","getVersionId","token","Promise","resolve","sw","then","update","elapsed","tokens","isDisposed","provider","result","styling","getSemanticTokensProviderStyling","setPartialSemanticTokens","getLanguageId","ID"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { createCancelablePromise, RunOnceScheduler } from '../../../../base/common/async.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { DocumentRangeSemanticTokensProviderRegistry } from '../../../common/languages.js';\nimport { getDocumentRangeSemanticTokens, hasDocumentRangeSemanticTokensProvider } from '../../../common/services/getSemanticTokens.js';\nimport { IModelService } from '../../../common/services/model.js';\nimport { isSemanticColoringEnabled, SEMANTIC_HIGHLIGHTING_SETTING_ID } from '../../../common/services/modelService.js';\nimport { toMultilineTokens2 } from '../../../common/services/semanticTokensProviderStyling.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nlet ViewportSemanticTokensContribution = class ViewportSemanticTokensContribution extends Disposable {\n    constructor(editor, _modelService, _themeService, _configurationService, languageFeatureDebounceService) {\n        super();\n        this._modelService = _modelService;\n        this._themeService = _themeService;\n        this._configurationService = _configurationService;\n        this._editor = editor;\n        this._debounceInformation = languageFeatureDebounceService.for(DocumentRangeSemanticTokensProviderRegistry, 'DocumentRangeSemanticTokens', { min: 100, max: 500 });\n        this._tokenizeViewport = new RunOnceScheduler(() => this._tokenizeViewportNow(), 100);\n        this._outstandingRequests = [];\n        const scheduleTokenizeViewport = () => {\n            if (this._editor.hasModel()) {\n                this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()));\n            }\n        };\n        this._register(this._editor.onDidScrollChange(() => {\n            scheduleTokenizeViewport();\n        }));\n        this._register(this._editor.onDidChangeModel(() => {\n            this._cancelAll();\n            scheduleTokenizeViewport();\n        }));\n        this._register(this._editor.onDidChangeModelContent((e) => {\n            this._cancelAll();\n            scheduleTokenizeViewport();\n        }));\n        this._register(DocumentRangeSemanticTokensProviderRegistry.onDidChange(() => {\n            this._cancelAll();\n            scheduleTokenizeViewport();\n        }));\n        this._register(this._configurationService.onDidChangeConfiguration(e => {\n            if (e.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)) {\n                this._cancelAll();\n                scheduleTokenizeViewport();\n            }\n        }));\n        this._register(this._themeService.onDidColorThemeChange(() => {\n            this._cancelAll();\n            scheduleTokenizeViewport();\n        }));\n    }\n    _cancelAll() {\n        for (const request of this._outstandingRequests) {\n            request.cancel();\n        }\n        this._outstandingRequests = [];\n    }\n    _removeOutstandingRequest(req) {\n        for (let i = 0, len = this._outstandingRequests.length; i < len; i++) {\n            if (this._outstandingRequests[i] === req) {\n                this._outstandingRequests.splice(i, 1);\n                return;\n            }\n        }\n    }\n    _tokenizeViewportNow() {\n        if (!this._editor.hasModel()) {\n            return;\n        }\n        const model = this._editor.getModel();\n        if (model.hasCompleteSemanticTokens()) {\n            return;\n        }\n        if (!isSemanticColoringEnabled(model, this._themeService, this._configurationService)) {\n            if (model.hasSomeSemanticTokens()) {\n                model.setSemanticTokens(null, false);\n            }\n            return;\n        }\n        if (!hasDocumentRangeSemanticTokensProvider(model)) {\n            if (model.hasSomeSemanticTokens()) {\n                model.setSemanticTokens(null, false);\n            }\n            return;\n        }\n        const visibleRanges = this._editor.getVisibleRangesPlusViewportAboveBelow();\n        this._outstandingRequests = this._outstandingRequests.concat(visibleRanges.map(range => this._requestRange(model, range)));\n    }\n    _requestRange(model, range) {\n        const requestVersionId = model.getVersionId();\n        const request = createCancelablePromise(token => Promise.resolve(getDocumentRangeSemanticTokens(model, range, token)));\n        const sw = new StopWatch(false);\n        request.then((r) => {\n            this._debounceInformation.update(model, sw.elapsed());\n            if (!r || !r.tokens || model.isDisposed() || model.getVersionId() !== requestVersionId) {\n                return;\n            }\n            const { provider, tokens: result } = r;\n            const styling = this._modelService.getSemanticTokensProviderStyling(provider);\n            model.setPartialSemanticTokens(range, toMultilineTokens2(result, styling, model.getLanguageId()));\n        }).then(() => this._removeOutstandingRequest(request), () => this._removeOutstandingRequest(request));\n        return request;\n    }\n};\nViewportSemanticTokensContribution.ID = 'editor.contrib.viewportSemanticTokens';\nViewportSemanticTokensContribution = __decorate([\n    __param(1, IModelService),\n    __param(2, IThemeService),\n    __param(3, IConfigurationService),\n    __param(4, ILanguageFeatureDebounceService)\n], ViewportSemanticTokensContribution);\nregisterEditorContribution(ViewportSemanticTokensContribution.ID, ViewportSemanticTokensContribution);\n"]},"metadata":{},"sourceType":"module"}