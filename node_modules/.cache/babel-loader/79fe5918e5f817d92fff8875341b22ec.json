{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport * as async from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport * as resources from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport './links.css';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { ModelDecorationOptions } from '../../../common/model/textModel.js';\nimport { LinkProviderRegistry } from '../../../common/languages.js';\nimport { ClickLinkGesture } from '../../gotoSymbol/browser/link/clickLinkGesture.js';\nimport { getLinks } from './getLinks.js';\nimport * as nls from '../../../../nls.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { editorActiveLinkForeground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\n\nfunction getHoverMessage(link, useMetaKey) {\n  const executeCmd = link.url && /^command:/i.test(link.url.toString());\n  const label = link.tooltip ? link.tooltip : executeCmd ? nls.localize('links.navigate.executeCmd', 'Execute command') : nls.localize('links.navigate.follow', 'Follow link');\n  const kb = useMetaKey ? platform.isMacintosh ? nls.localize('links.navigate.kb.meta.mac', \"cmd + click\") : nls.localize('links.navigate.kb.meta', \"ctrl + click\") : platform.isMacintosh ? nls.localize('links.navigate.kb.alt.mac', \"option + click\") : nls.localize('links.navigate.kb.alt', \"alt + click\");\n\n  if (link.url) {\n    let nativeLabel = '';\n\n    if (/^command:/i.test(link.url.toString())) {\n      // Don't show complete command arguments in the native tooltip\n      const match = link.url.toString().match(/^command:([^?#]+)/);\n\n      if (match) {\n        const commandId = match[1];\n        const nativeLabelText = nls.localize('tooltip.explanation', \"Execute command {0}\", commandId);\n        nativeLabel = ` \"${nativeLabelText}\"`;\n      }\n    }\n\n    const hoverMessage = new MarkdownString('', true).appendMarkdown(`[${label}](${link.url.toString(true).replace(/ /g, '%20')}${nativeLabel}) (${kb})`);\n    return hoverMessage;\n  } else {\n    return new MarkdownString().appendText(`${label} (${kb})`);\n  }\n}\n\nconst decoration = {\n  general: ModelDecorationOptions.register({\n    description: 'detected-link',\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    collapseOnReplaceEdit: true,\n    inlineClassName: 'detected-link'\n  }),\n  active: ModelDecorationOptions.register({\n    description: 'detected-link-active',\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    collapseOnReplaceEdit: true,\n    inlineClassName: 'detected-link-active'\n  })\n};\n\nclass LinkOccurrence {\n  constructor(link, decorationId) {\n    this.link = link;\n    this.decorationId = decorationId;\n  }\n\n  static decoration(link, useMetaKey) {\n    return {\n      range: link.range,\n      options: LinkOccurrence._getOptions(link, useMetaKey, false)\n    };\n  }\n\n  static _getOptions(link, useMetaKey, isActive) {\n    const options = Object.assign({}, isActive ? decoration.active : decoration.general);\n    options.hoverMessage = getHoverMessage(link, useMetaKey);\n    return options;\n  }\n\n  activate(changeAccessor, useMetaKey) {\n    changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, true));\n  }\n\n  deactivate(changeAccessor, useMetaKey) {\n    changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, false));\n  }\n\n}\n\nlet LinkDetector = class LinkDetector {\n  constructor(editor, openerService, notificationService) {\n    this.listenersToRemove = new DisposableStore();\n    this.editor = editor;\n    this.openerService = openerService;\n    this.notificationService = notificationService;\n    let clickLinkGesture = new ClickLinkGesture(editor);\n    this.listenersToRemove.add(clickLinkGesture);\n    this.listenersToRemove.add(clickLinkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent]) => {\n      this._onEditorMouseMove(mouseEvent, keyboardEvent);\n    }));\n    this.listenersToRemove.add(clickLinkGesture.onExecute(e => {\n      this.onEditorMouseUp(e);\n    }));\n    this.listenersToRemove.add(clickLinkGesture.onCancel(e => {\n      this.cleanUpActiveLinkDecoration();\n    }));\n    this.enabled = editor.getOption(63\n    /* links */\n    );\n    this.listenersToRemove.add(editor.onDidChangeConfiguration(e => {\n      const enabled = editor.getOption(63\n      /* links */\n      );\n\n      if (this.enabled === enabled) {\n        // No change in our configuration option\n        return;\n      }\n\n      this.enabled = enabled; // Remove any links (for the getting disabled case)\n\n      this.updateDecorations([]); // Stop any computation (for the getting disabled case)\n\n      this.stop(); // Start computing (for the getting enabled case)\n\n      this.beginCompute();\n    }));\n    this.listenersToRemove.add(editor.onDidChangeModelContent(e => this.onChange()));\n    this.listenersToRemove.add(editor.onDidChangeModel(e => this.onModelChanged()));\n    this.listenersToRemove.add(editor.onDidChangeModelLanguage(e => this.onModelLanguageChanged()));\n    this.listenersToRemove.add(LinkProviderRegistry.onDidChange(e => this.onModelLanguageChanged()));\n    this.timeout = new async.TimeoutTimer();\n    this.computePromise = null;\n    this.activeLinksList = null;\n    this.currentOccurrences = {};\n    this.activeLinkDecorationId = null;\n    this.beginCompute();\n  }\n\n  static get(editor) {\n    return editor.getContribution(LinkDetector.ID);\n  }\n\n  onModelChanged() {\n    this.currentOccurrences = {};\n    this.activeLinkDecorationId = null;\n    this.stop();\n    this.beginCompute();\n  }\n\n  onModelLanguageChanged() {\n    this.stop();\n    this.beginCompute();\n  }\n\n  onChange() {\n    this.timeout.setIfNotSet(() => this.beginCompute(), LinkDetector.RECOMPUTE_TIME);\n  }\n\n  beginCompute() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.editor.hasModel() || !this.enabled) {\n        return;\n      }\n\n      const model = this.editor.getModel();\n\n      if (!LinkProviderRegistry.has(model)) {\n        return;\n      }\n\n      if (this.activeLinksList) {\n        this.activeLinksList.dispose();\n        this.activeLinksList = null;\n      }\n\n      this.computePromise = async.createCancelablePromise(token => getLinks(model, token));\n\n      try {\n        this.activeLinksList = yield this.computePromise;\n        this.updateDecorations(this.activeLinksList.links);\n      } catch (err) {\n        onUnexpectedError(err);\n      } finally {\n        this.computePromise = null;\n      }\n    });\n  }\n\n  updateDecorations(links) {\n    const useMetaKey = this.editor.getOption(70\n    /* multiCursorModifier */\n    ) === 'altKey';\n    let oldDecorations = [];\n    let keys = Object.keys(this.currentOccurrences);\n\n    for (let i = 0, len = keys.length; i < len; i++) {\n      let decorationId = keys[i];\n      let occurance = this.currentOccurrences[decorationId];\n      oldDecorations.push(occurance.decorationId);\n    }\n\n    let newDecorations = [];\n\n    if (links) {\n      // Not sure why this is sometimes null\n      for (const link of links) {\n        newDecorations.push(LinkOccurrence.decoration(link, useMetaKey));\n      }\n    }\n\n    let decorations = this.editor.deltaDecorations(oldDecorations, newDecorations);\n    this.currentOccurrences = {};\n    this.activeLinkDecorationId = null;\n\n    for (let i = 0, len = decorations.length; i < len; i++) {\n      let occurance = new LinkOccurrence(links[i], decorations[i]);\n      this.currentOccurrences[occurance.decorationId] = occurance;\n    }\n  }\n\n  _onEditorMouseMove(mouseEvent, withKey) {\n    const useMetaKey = this.editor.getOption(70\n    /* multiCursorModifier */\n    ) === 'altKey';\n\n    if (this.isEnabled(mouseEvent, withKey)) {\n      this.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one\n\n      const occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n\n      if (occurrence) {\n        this.editor.changeDecorations(changeAccessor => {\n          occurrence.activate(changeAccessor, useMetaKey);\n          this.activeLinkDecorationId = occurrence.decorationId;\n        });\n      }\n    } else {\n      this.cleanUpActiveLinkDecoration();\n    }\n  }\n\n  cleanUpActiveLinkDecoration() {\n    const useMetaKey = this.editor.getOption(70\n    /* multiCursorModifier */\n    ) === 'altKey';\n\n    if (this.activeLinkDecorationId) {\n      const occurrence = this.currentOccurrences[this.activeLinkDecorationId];\n\n      if (occurrence) {\n        this.editor.changeDecorations(changeAccessor => {\n          occurrence.deactivate(changeAccessor, useMetaKey);\n        });\n      }\n\n      this.activeLinkDecorationId = null;\n    }\n  }\n\n  onEditorMouseUp(mouseEvent) {\n    if (!this.isEnabled(mouseEvent)) {\n      return;\n    }\n\n    const occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n\n    if (!occurrence) {\n      return;\n    }\n\n    this.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier, true\n    /* from user gesture */\n    );\n  }\n\n  openLinkOccurrence(occurrence, openToSide, fromUserGesture = false) {\n    if (!this.openerService) {\n      return;\n    }\n\n    const {\n      link\n    } = occurrence;\n    link.resolve(CancellationToken.None).then(uri => {\n      // Support for relative file URIs of the shape file://./relativeFile.txt or file:///./relativeFile.txt\n      if (typeof uri === 'string' && this.editor.hasModel()) {\n        const modelUri = this.editor.getModel().uri;\n\n        if (modelUri.scheme === Schemas.file && uri.startsWith(`${Schemas.file}:`)) {\n          const parsedUri = URI.parse(uri);\n\n          if (parsedUri.scheme === Schemas.file) {\n            const fsPath = resources.originalFSPath(parsedUri);\n            let relativePath = null;\n\n            if (fsPath.startsWith('/./')) {\n              relativePath = `.${fsPath.substr(1)}`;\n            } else if (fsPath.startsWith('//./')) {\n              relativePath = `.${fsPath.substr(2)}`;\n            }\n\n            if (relativePath) {\n              uri = resources.joinPath(modelUri, relativePath);\n            }\n          }\n        }\n      }\n\n      return this.openerService.open(uri, {\n        openToSide,\n        fromUserGesture,\n        allowContributedOpeners: true,\n        allowCommands: true\n      });\n    }, err => {\n      const messageOrError = err instanceof Error ? err.message : err; // different error cases\n\n      if (messageOrError === 'invalid') {\n        this.notificationService.warn(nls.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url.toString()));\n      } else if (messageOrError === 'missing') {\n        this.notificationService.warn(nls.localize('missing.url', 'Failed to open this link because its target is missing.'));\n      } else {\n        onUnexpectedError(err);\n      }\n    });\n  }\n\n  getLinkOccurrence(position) {\n    if (!this.editor.hasModel() || !position) {\n      return null;\n    }\n\n    const decorations = this.editor.getModel().getDecorationsInRange({\n      startLineNumber: position.lineNumber,\n      startColumn: position.column,\n      endLineNumber: position.lineNumber,\n      endColumn: position.column\n    }, 0, true);\n\n    for (const decoration of decorations) {\n      const currentOccurrence = this.currentOccurrences[decoration.id];\n\n      if (currentOccurrence) {\n        return currentOccurrence;\n      }\n    }\n\n    return null;\n  }\n\n  isEnabled(mouseEvent, withKey) {\n    return Boolean(mouseEvent.target.type === 6\n    /* CONTENT_TEXT */\n    && (mouseEvent.hasTriggerModifier || withKey && withKey.keyCodeIsTriggerKey));\n  }\n\n  stop() {\n    var _a;\n\n    this.timeout.cancel();\n\n    if (this.activeLinksList) {\n      (_a = this.activeLinksList) === null || _a === void 0 ? void 0 : _a.dispose();\n      this.activeLinksList = null;\n    }\n\n    if (this.computePromise) {\n      this.computePromise.cancel();\n      this.computePromise = null;\n    }\n  }\n\n  dispose() {\n    this.listenersToRemove.dispose();\n    this.stop();\n    this.timeout.dispose();\n  }\n\n};\nLinkDetector.ID = 'editor.linkDetector';\nLinkDetector.RECOMPUTE_TIME = 1000; // ms\n\nLinkDetector = __decorate([__param(1, IOpenerService), __param(2, INotificationService)], LinkDetector);\nexport { LinkDetector };\n\nclass OpenLinkAction extends EditorAction {\n  constructor() {\n    super({\n      id: 'editor.action.openLink',\n      label: nls.localize('label', \"Open Link\"),\n      alias: 'Open Link',\n      precondition: undefined\n    });\n  }\n\n  run(accessor, editor) {\n    const linkDetector = LinkDetector.get(editor);\n\n    if (!linkDetector) {\n      return;\n    }\n\n    if (!editor.hasModel()) {\n      return;\n    }\n\n    let selections = editor.getSelections();\n\n    for (let sel of selections) {\n      let link = linkDetector.getLinkOccurrence(sel.getEndPosition());\n\n      if (link) {\n        linkDetector.openLinkOccurrence(link, false);\n      }\n    }\n  }\n\n}\n\nregisterEditorContribution(LinkDetector.ID, LinkDetector);\nregisterEditorAction(OpenLinkAction);\nregisterThemingParticipant((theme, collector) => {\n  const activeLinkForeground = theme.getColor(editorActiveLinkForeground);\n\n  if (activeLinkForeground) {\n    collector.addRule(`.monaco-editor .detected-link-active { color: ${activeLinkForeground} !important; }`);\n  }\n});","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/links/browser/links.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","async","CancellationToken","onUnexpectedError","MarkdownString","DisposableStore","Schemas","platform","resources","URI","EditorAction","registerEditorAction","registerEditorContribution","ModelDecorationOptions","LinkProviderRegistry","ClickLinkGesture","getLinks","nls","INotificationService","IOpenerService","editorActiveLinkForeground","registerThemingParticipant","getHoverMessage","link","useMetaKey","executeCmd","url","test","toString","label","tooltip","localize","kb","isMacintosh","nativeLabel","match","commandId","nativeLabelText","hoverMessage","appendMarkdown","replace","appendText","decoration","general","register","description","stickiness","collapseOnReplaceEdit","inlineClassName","active","LinkOccurrence","constructor","decorationId","range","options","_getOptions","isActive","assign","activate","changeAccessor","changeDecorationOptions","deactivate","LinkDetector","editor","openerService","notificationService","listenersToRemove","clickLinkGesture","add","onMouseMoveOrRelevantKeyDown","mouseEvent","keyboardEvent","_onEditorMouseMove","onExecute","onEditorMouseUp","onCancel","cleanUpActiveLinkDecoration","enabled","getOption","onDidChangeConfiguration","updateDecorations","stop","beginCompute","onDidChangeModelContent","onChange","onDidChangeModel","onModelChanged","onDidChangeModelLanguage","onModelLanguageChanged","onDidChange","timeout","TimeoutTimer","computePromise","activeLinksList","currentOccurrences","activeLinkDecorationId","get","getContribution","ID","setIfNotSet","RECOMPUTE_TIME","hasModel","model","getModel","has","dispose","createCancelablePromise","token","links","err","oldDecorations","keys","len","occurance","push","newDecorations","decorations","deltaDecorations","withKey","isEnabled","occurrence","getLinkOccurrence","position","changeDecorations","openLinkOccurrence","hasSideBySideModifier","openToSide","fromUserGesture","None","uri","modelUri","scheme","file","startsWith","parsedUri","parse","fsPath","originalFSPath","relativePath","substr","joinPath","open","allowContributedOpeners","allowCommands","messageOrError","Error","message","warn","getDecorationsInRange","startLineNumber","lineNumber","startColumn","column","endLineNumber","endColumn","currentOccurrence","id","Boolean","type","hasTriggerModifier","keyCodeIsTriggerKey","_a","cancel","OpenLinkAction","alias","precondition","undefined","run","accessor","linkDetector","selections","getSelections","sel","getEndPosition","theme","collector","activeLinkForeground","getColor","addRule"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport * as async from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport * as resources from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport './links.css';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { ModelDecorationOptions } from '../../../common/model/textModel.js';\nimport { LinkProviderRegistry } from '../../../common/languages.js';\nimport { ClickLinkGesture } from '../../gotoSymbol/browser/link/clickLinkGesture.js';\nimport { getLinks } from './getLinks.js';\nimport * as nls from '../../../../nls.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { editorActiveLinkForeground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\nfunction getHoverMessage(link, useMetaKey) {\n    const executeCmd = link.url && /^command:/i.test(link.url.toString());\n    const label = link.tooltip\n        ? link.tooltip\n        : executeCmd\n            ? nls.localize('links.navigate.executeCmd', 'Execute command')\n            : nls.localize('links.navigate.follow', 'Follow link');\n    const kb = useMetaKey\n        ? platform.isMacintosh\n            ? nls.localize('links.navigate.kb.meta.mac', \"cmd + click\")\n            : nls.localize('links.navigate.kb.meta', \"ctrl + click\")\n        : platform.isMacintosh\n            ? nls.localize('links.navigate.kb.alt.mac', \"option + click\")\n            : nls.localize('links.navigate.kb.alt', \"alt + click\");\n    if (link.url) {\n        let nativeLabel = '';\n        if (/^command:/i.test(link.url.toString())) {\n            // Don't show complete command arguments in the native tooltip\n            const match = link.url.toString().match(/^command:([^?#]+)/);\n            if (match) {\n                const commandId = match[1];\n                const nativeLabelText = nls.localize('tooltip.explanation', \"Execute command {0}\", commandId);\n                nativeLabel = ` \"${nativeLabelText}\"`;\n            }\n        }\n        const hoverMessage = new MarkdownString('', true).appendMarkdown(`[${label}](${link.url.toString(true).replace(/ /g, '%20')}${nativeLabel}) (${kb})`);\n        return hoverMessage;\n    }\n    else {\n        return new MarkdownString().appendText(`${label} (${kb})`);\n    }\n}\nconst decoration = {\n    general: ModelDecorationOptions.register({\n        description: 'detected-link',\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link'\n    }),\n    active: ModelDecorationOptions.register({\n        description: 'detected-link-active',\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link-active'\n    })\n};\nclass LinkOccurrence {\n    constructor(link, decorationId) {\n        this.link = link;\n        this.decorationId = decorationId;\n    }\n    static decoration(link, useMetaKey) {\n        return {\n            range: link.range,\n            options: LinkOccurrence._getOptions(link, useMetaKey, false)\n        };\n    }\n    static _getOptions(link, useMetaKey, isActive) {\n        const options = Object.assign({}, (isActive ? decoration.active : decoration.general));\n        options.hoverMessage = getHoverMessage(link, useMetaKey);\n        return options;\n    }\n    activate(changeAccessor, useMetaKey) {\n        changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, true));\n    }\n    deactivate(changeAccessor, useMetaKey) {\n        changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, false));\n    }\n}\nlet LinkDetector = class LinkDetector {\n    constructor(editor, openerService, notificationService) {\n        this.listenersToRemove = new DisposableStore();\n        this.editor = editor;\n        this.openerService = openerService;\n        this.notificationService = notificationService;\n        let clickLinkGesture = new ClickLinkGesture(editor);\n        this.listenersToRemove.add(clickLinkGesture);\n        this.listenersToRemove.add(clickLinkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent]) => {\n            this._onEditorMouseMove(mouseEvent, keyboardEvent);\n        }));\n        this.listenersToRemove.add(clickLinkGesture.onExecute((e) => {\n            this.onEditorMouseUp(e);\n        }));\n        this.listenersToRemove.add(clickLinkGesture.onCancel((e) => {\n            this.cleanUpActiveLinkDecoration();\n        }));\n        this.enabled = editor.getOption(63 /* links */);\n        this.listenersToRemove.add(editor.onDidChangeConfiguration((e) => {\n            const enabled = editor.getOption(63 /* links */);\n            if (this.enabled === enabled) {\n                // No change in our configuration option\n                return;\n            }\n            this.enabled = enabled;\n            // Remove any links (for the getting disabled case)\n            this.updateDecorations([]);\n            // Stop any computation (for the getting disabled case)\n            this.stop();\n            // Start computing (for the getting enabled case)\n            this.beginCompute();\n        }));\n        this.listenersToRemove.add(editor.onDidChangeModelContent((e) => this.onChange()));\n        this.listenersToRemove.add(editor.onDidChangeModel((e) => this.onModelChanged()));\n        this.listenersToRemove.add(editor.onDidChangeModelLanguage((e) => this.onModelLanguageChanged()));\n        this.listenersToRemove.add(LinkProviderRegistry.onDidChange((e) => this.onModelLanguageChanged()));\n        this.timeout = new async.TimeoutTimer();\n        this.computePromise = null;\n        this.activeLinksList = null;\n        this.currentOccurrences = {};\n        this.activeLinkDecorationId = null;\n        this.beginCompute();\n    }\n    static get(editor) {\n        return editor.getContribution(LinkDetector.ID);\n    }\n    onModelChanged() {\n        this.currentOccurrences = {};\n        this.activeLinkDecorationId = null;\n        this.stop();\n        this.beginCompute();\n    }\n    onModelLanguageChanged() {\n        this.stop();\n        this.beginCompute();\n    }\n    onChange() {\n        this.timeout.setIfNotSet(() => this.beginCompute(), LinkDetector.RECOMPUTE_TIME);\n    }\n    beginCompute() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.editor.hasModel() || !this.enabled) {\n                return;\n            }\n            const model = this.editor.getModel();\n            if (!LinkProviderRegistry.has(model)) {\n                return;\n            }\n            if (this.activeLinksList) {\n                this.activeLinksList.dispose();\n                this.activeLinksList = null;\n            }\n            this.computePromise = async.createCancelablePromise(token => getLinks(model, token));\n            try {\n                this.activeLinksList = yield this.computePromise;\n                this.updateDecorations(this.activeLinksList.links);\n            }\n            catch (err) {\n                onUnexpectedError(err);\n            }\n            finally {\n                this.computePromise = null;\n            }\n        });\n    }\n    updateDecorations(links) {\n        const useMetaKey = (this.editor.getOption(70 /* multiCursorModifier */) === 'altKey');\n        let oldDecorations = [];\n        let keys = Object.keys(this.currentOccurrences);\n        for (let i = 0, len = keys.length; i < len; i++) {\n            let decorationId = keys[i];\n            let occurance = this.currentOccurrences[decorationId];\n            oldDecorations.push(occurance.decorationId);\n        }\n        let newDecorations = [];\n        if (links) {\n            // Not sure why this is sometimes null\n            for (const link of links) {\n                newDecorations.push(LinkOccurrence.decoration(link, useMetaKey));\n            }\n        }\n        let decorations = this.editor.deltaDecorations(oldDecorations, newDecorations);\n        this.currentOccurrences = {};\n        this.activeLinkDecorationId = null;\n        for (let i = 0, len = decorations.length; i < len; i++) {\n            let occurance = new LinkOccurrence(links[i], decorations[i]);\n            this.currentOccurrences[occurance.decorationId] = occurance;\n        }\n    }\n    _onEditorMouseMove(mouseEvent, withKey) {\n        const useMetaKey = (this.editor.getOption(70 /* multiCursorModifier */) === 'altKey');\n        if (this.isEnabled(mouseEvent, withKey)) {\n            this.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one\n            const occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n            if (occurrence) {\n                this.editor.changeDecorations((changeAccessor) => {\n                    occurrence.activate(changeAccessor, useMetaKey);\n                    this.activeLinkDecorationId = occurrence.decorationId;\n                });\n            }\n        }\n        else {\n            this.cleanUpActiveLinkDecoration();\n        }\n    }\n    cleanUpActiveLinkDecoration() {\n        const useMetaKey = (this.editor.getOption(70 /* multiCursorModifier */) === 'altKey');\n        if (this.activeLinkDecorationId) {\n            const occurrence = this.currentOccurrences[this.activeLinkDecorationId];\n            if (occurrence) {\n                this.editor.changeDecorations((changeAccessor) => {\n                    occurrence.deactivate(changeAccessor, useMetaKey);\n                });\n            }\n            this.activeLinkDecorationId = null;\n        }\n    }\n    onEditorMouseUp(mouseEvent) {\n        if (!this.isEnabled(mouseEvent)) {\n            return;\n        }\n        const occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n        if (!occurrence) {\n            return;\n        }\n        this.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier, true /* from user gesture */);\n    }\n    openLinkOccurrence(occurrence, openToSide, fromUserGesture = false) {\n        if (!this.openerService) {\n            return;\n        }\n        const { link } = occurrence;\n        link.resolve(CancellationToken.None).then(uri => {\n            // Support for relative file URIs of the shape file://./relativeFile.txt or file:///./relativeFile.txt\n            if (typeof uri === 'string' && this.editor.hasModel()) {\n                const modelUri = this.editor.getModel().uri;\n                if (modelUri.scheme === Schemas.file && uri.startsWith(`${Schemas.file}:`)) {\n                    const parsedUri = URI.parse(uri);\n                    if (parsedUri.scheme === Schemas.file) {\n                        const fsPath = resources.originalFSPath(parsedUri);\n                        let relativePath = null;\n                        if (fsPath.startsWith('/./')) {\n                            relativePath = `.${fsPath.substr(1)}`;\n                        }\n                        else if (fsPath.startsWith('//./')) {\n                            relativePath = `.${fsPath.substr(2)}`;\n                        }\n                        if (relativePath) {\n                            uri = resources.joinPath(modelUri, relativePath);\n                        }\n                    }\n                }\n            }\n            return this.openerService.open(uri, { openToSide, fromUserGesture, allowContributedOpeners: true, allowCommands: true });\n        }, err => {\n            const messageOrError = err instanceof Error ? err.message : err;\n            // different error cases\n            if (messageOrError === 'invalid') {\n                this.notificationService.warn(nls.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url.toString()));\n            }\n            else if (messageOrError === 'missing') {\n                this.notificationService.warn(nls.localize('missing.url', 'Failed to open this link because its target is missing.'));\n            }\n            else {\n                onUnexpectedError(err);\n            }\n        });\n    }\n    getLinkOccurrence(position) {\n        if (!this.editor.hasModel() || !position) {\n            return null;\n        }\n        const decorations = this.editor.getModel().getDecorationsInRange({\n            startLineNumber: position.lineNumber,\n            startColumn: position.column,\n            endLineNumber: position.lineNumber,\n            endColumn: position.column\n        }, 0, true);\n        for (const decoration of decorations) {\n            const currentOccurrence = this.currentOccurrences[decoration.id];\n            if (currentOccurrence) {\n                return currentOccurrence;\n            }\n        }\n        return null;\n    }\n    isEnabled(mouseEvent, withKey) {\n        return Boolean((mouseEvent.target.type === 6 /* CONTENT_TEXT */)\n            && (mouseEvent.hasTriggerModifier || (withKey && withKey.keyCodeIsTriggerKey)));\n    }\n    stop() {\n        var _a;\n        this.timeout.cancel();\n        if (this.activeLinksList) {\n            (_a = this.activeLinksList) === null || _a === void 0 ? void 0 : _a.dispose();\n            this.activeLinksList = null;\n        }\n        if (this.computePromise) {\n            this.computePromise.cancel();\n            this.computePromise = null;\n        }\n    }\n    dispose() {\n        this.listenersToRemove.dispose();\n        this.stop();\n        this.timeout.dispose();\n    }\n};\nLinkDetector.ID = 'editor.linkDetector';\nLinkDetector.RECOMPUTE_TIME = 1000; // ms\nLinkDetector = __decorate([\n    __param(1, IOpenerService),\n    __param(2, INotificationService)\n], LinkDetector);\nexport { LinkDetector };\nclass OpenLinkAction extends EditorAction {\n    constructor() {\n        super({\n            id: 'editor.action.openLink',\n            label: nls.localize('label', \"Open Link\"),\n            alias: 'Open Link',\n            precondition: undefined\n        });\n    }\n    run(accessor, editor) {\n        const linkDetector = LinkDetector.get(editor);\n        if (!linkDetector) {\n            return;\n        }\n        if (!editor.hasModel()) {\n            return;\n        }\n        let selections = editor.getSelections();\n        for (let sel of selections) {\n            let link = linkDetector.getLinkOccurrence(sel.getEndPosition());\n            if (link) {\n                linkDetector.openLinkOccurrence(link, false);\n            }\n        }\n    }\n}\nregisterEditorContribution(LinkDetector.ID, LinkDetector);\nregisterEditorAction(OpenLinkAction);\nregisterThemingParticipant((theme, collector) => {\n    const activeLinkForeground = theme.getColor(editorActiveLinkForeground);\n    if (activeLinkForeground) {\n        collector.addRule(`.monaco-editor .detected-link-active { color: ${activeLinkForeground} !important; }`);\n    }\n});\n"]},"metadata":{},"sourceType":"module"}