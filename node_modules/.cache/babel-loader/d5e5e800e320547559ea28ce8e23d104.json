{"ast":null,"code":"var Util = require('util');\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar Packets = require('../packets');\n\nvar ErrorConstants = require('../constants/errors');\n\nvar Timer = require('../Timer'); // istanbul ignore next: Node.js < 0.10 not covered\n\n\nvar listenerCount = EventEmitter.listenerCount || function (emitter, type) {\n  return emitter.listeners(type).length;\n};\n\nvar LONG_STACK_DELIMITER = '\\n    --------------------\\n';\nmodule.exports = Sequence;\nUtil.inherits(Sequence, EventEmitter);\n\nfunction Sequence(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  EventEmitter.call(this);\n  options = options || {};\n  this._callback = callback;\n  this._callSite = null;\n  this._ended = false;\n  this._timeout = options.timeout;\n  this._timer = new Timer(this);\n}\n\nSequence.determinePacket = function (byte) {\n  switch (byte) {\n    case 0x00:\n      return Packets.OkPacket;\n\n    case 0xfe:\n      return Packets.EofPacket;\n\n    case 0xff:\n      return Packets.ErrorPacket;\n\n    default:\n      return undefined;\n  }\n};\n\nSequence.prototype.hasErrorHandler = function () {\n  return Boolean(this._callback) || listenerCount(this, 'error') > 1;\n};\n\nSequence.prototype._packetToError = function (packet) {\n  var code = ErrorConstants[packet.errno] || 'UNKNOWN_CODE_PLEASE_REPORT';\n  var err = new Error(code + ': ' + packet.message);\n  err.code = code;\n  err.errno = packet.errno;\n  err.sqlMessage = packet.message;\n  err.sqlState = packet.sqlState;\n  return err;\n};\n\nSequence.prototype.end = function (err) {\n  if (this._ended) {\n    return;\n  }\n\n  this._ended = true;\n\n  if (err) {\n    this._addLongStackTrace(err);\n  } // Without this we are leaking memory. This problem was introduced in\n  // 8189925374e7ce3819bbe88b64c7b15abac96b16. I suspect that the error object\n  // causes a cyclic reference that the GC does not detect properly, but I was\n  // unable to produce a standalone version of this leak. This would be a great\n  // challenge for somebody interested in difficult problems : )!\n\n\n  this._callSite = null; // try...finally for exception safety\n\n  try {\n    if (err) {\n      this.emit('error', err);\n    }\n  } finally {\n    try {\n      if (this._callback) {\n        this._callback.apply(this, arguments);\n      }\n    } finally {\n      this.emit('end');\n    }\n  }\n};\n\nSequence.prototype['OkPacket'] = function (packet) {\n  this.end(null, packet);\n};\n\nSequence.prototype['ErrorPacket'] = function (packet) {\n  this.end(this._packetToError(packet));\n}; // Implemented by child classes\n\n\nSequence.prototype.start = function () {};\n\nSequence.prototype._addLongStackTrace = function _addLongStackTrace(err) {\n  var callSiteStack = this._callSite && this._callSite.stack;\n\n  if (!callSiteStack || typeof callSiteStack !== 'string') {\n    // No recorded call site\n    return;\n  }\n\n  if (err.stack.indexOf(LONG_STACK_DELIMITER) !== -1) {\n    // Error stack already looks long\n    return;\n  }\n\n  var index = callSiteStack.indexOf('\\n');\n\n  if (index !== -1) {\n    // Append recorded call site\n    err.stack += LONG_STACK_DELIMITER + callSiteStack.substr(index + 1);\n  }\n};\n\nSequence.prototype._onTimeout = function _onTimeout() {\n  this.emit('timeout');\n};","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/mysql/lib/protocol/sequences/Sequence.js"],"names":["Util","require","EventEmitter","Packets","ErrorConstants","Timer","listenerCount","emitter","type","listeners","length","LONG_STACK_DELIMITER","module","exports","Sequence","inherits","options","callback","call","_callback","_callSite","_ended","_timeout","timeout","_timer","determinePacket","byte","OkPacket","EofPacket","ErrorPacket","undefined","prototype","hasErrorHandler","Boolean","_packetToError","packet","code","errno","err","Error","message","sqlMessage","sqlState","end","_addLongStackTrace","emit","apply","arguments","start","callSiteStack","stack","indexOf","index","substr","_onTimeout"],"mappings":"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","sourcesContent":["var Util           = require('util');\nvar EventEmitter   = require('events').EventEmitter;\nvar Packets        = require('../packets');\nvar ErrorConstants = require('../constants/errors');\nvar Timer          = require('../Timer');\n\n// istanbul ignore next: Node.js < 0.10 not covered\nvar listenerCount = EventEmitter.listenerCount\n  || function(emitter, type){ return emitter.listeners(type).length; };\n\nvar LONG_STACK_DELIMITER = '\\n    --------------------\\n';\n\nmodule.exports = Sequence;\nUtil.inherits(Sequence, EventEmitter);\nfunction Sequence(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  EventEmitter.call(this);\n\n  options = options || {};\n\n  this._callback = callback;\n  this._callSite = null;\n  this._ended    = false;\n  this._timeout  = options.timeout;\n  this._timer    = new Timer(this);\n}\n\nSequence.determinePacket = function(byte) {\n  switch (byte) {\n    case 0x00: return Packets.OkPacket;\n    case 0xfe: return Packets.EofPacket;\n    case 0xff: return Packets.ErrorPacket;\n    default:   return undefined;\n  }\n};\n\nSequence.prototype.hasErrorHandler = function() {\n  return Boolean(this._callback) || listenerCount(this, 'error') > 1;\n};\n\nSequence.prototype._packetToError = function(packet) {\n  var code = ErrorConstants[packet.errno] || 'UNKNOWN_CODE_PLEASE_REPORT';\n  var err  = new Error(code + ': ' + packet.message);\n  err.code = code;\n  err.errno = packet.errno;\n\n  err.sqlMessage = packet.message;\n  err.sqlState   = packet.sqlState;\n\n  return err;\n};\n\nSequence.prototype.end = function(err) {\n  if (this._ended) {\n    return;\n  }\n\n  this._ended = true;\n\n  if (err) {\n    this._addLongStackTrace(err);\n  }\n\n  // Without this we are leaking memory. This problem was introduced in\n  // 8189925374e7ce3819bbe88b64c7b15abac96b16. I suspect that the error object\n  // causes a cyclic reference that the GC does not detect properly, but I was\n  // unable to produce a standalone version of this leak. This would be a great\n  // challenge for somebody interested in difficult problems : )!\n  this._callSite = null;\n\n  // try...finally for exception safety\n  try {\n    if (err) {\n      this.emit('error', err);\n    }\n  } finally {\n    try {\n      if (this._callback) {\n        this._callback.apply(this, arguments);\n      }\n    } finally {\n      this.emit('end');\n    }\n  }\n};\n\nSequence.prototype['OkPacket'] = function(packet) {\n  this.end(null, packet);\n};\n\nSequence.prototype['ErrorPacket'] = function(packet) {\n  this.end(this._packetToError(packet));\n};\n\n// Implemented by child classes\nSequence.prototype.start = function() {};\n\nSequence.prototype._addLongStackTrace = function _addLongStackTrace(err) {\n  var callSiteStack = this._callSite && this._callSite.stack;\n\n  if (!callSiteStack || typeof callSiteStack !== 'string') {\n    // No recorded call site\n    return;\n  }\n\n  if (err.stack.indexOf(LONG_STACK_DELIMITER) !== -1) {\n    // Error stack already looks long\n    return;\n  }\n\n  var index = callSiteStack.indexOf('\\n');\n\n  if (index !== -1) {\n    // Append recorded call site\n    err.stack += LONG_STACK_DELIMITER + callSiteStack.substr(index + 1);\n  }\n};\n\nSequence.prototype._onTimeout = function _onTimeout() {\n  this.emit('timeout');\n};\n"]},"metadata":{},"sourceType":"script"}