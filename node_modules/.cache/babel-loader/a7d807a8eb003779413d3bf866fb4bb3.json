{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { isSafari } from '../../../../base/browser/browser.js';\nimport * as dom from '../../../../base/browser/dom.js';\nimport { DomScrollableElement } from '../../../../base/browser/ui/scrollbar/scrollableElement.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { MarkdownRenderer } from '../../markdownRenderer/browser/markdownRenderer.js';\nimport { EDITOR_FONT_DEFAULTS } from '../../../common/config/editorOptions.js';\nimport { ResizableHTMLElement } from './resizable.js';\nimport * as nls from '../../../../nls.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nexport function canExpandCompletionItem(item) {\n  return !!item && Boolean(item.completion.documentation || item.completion.detail && item.completion.detail !== item.completion.label);\n}\nlet SuggestDetailsWidget = class SuggestDetailsWidget {\n  constructor(_editor, instaService) {\n    this._editor = _editor;\n    this._onDidClose = new Emitter();\n    this.onDidClose = this._onDidClose.event;\n    this._onDidChangeContents = new Emitter();\n    this.onDidChangeContents = this._onDidChangeContents.event;\n    this._disposables = new DisposableStore();\n    this._renderDisposeable = new DisposableStore();\n    this._borderWidth = 1;\n    this._size = new dom.Dimension(330, 0);\n    this.domNode = dom.$('.suggest-details');\n    this.domNode.classList.add('no-docs');\n    this._markdownRenderer = instaService.createInstance(MarkdownRenderer, {\n      editor: _editor\n    });\n    this._body = dom.$('.body');\n    this._scrollbar = new DomScrollableElement(this._body, {});\n    dom.append(this.domNode, this._scrollbar.getDomNode());\n\n    this._disposables.add(this._scrollbar);\n\n    this._header = dom.append(this._body, dom.$('.header'));\n    this._close = dom.append(this._header, dom.$('span' + Codicon.close.cssSelector));\n    this._close.title = nls.localize('details.close', \"Close\");\n    this._type = dom.append(this._header, dom.$('p.type'));\n    this._docs = dom.append(this._body, dom.$('p.docs'));\n\n    this._configureFont();\n\n    this._disposables.add(this._editor.onDidChangeConfiguration(e => {\n      if (e.hasChanged(44\n      /* fontInfo */\n      )) {\n        this._configureFont();\n      }\n    }));\n  }\n\n  dispose() {\n    this._disposables.dispose();\n\n    this._renderDisposeable.dispose();\n  }\n\n  _configureFont() {\n    const options = this._editor.getOptions();\n\n    const fontInfo = options.get(44\n    /* fontInfo */\n    );\n    const fontFamily = fontInfo.getMassagedFontFamily(isSafari ? EDITOR_FONT_DEFAULTS.fontFamily : null);\n    const fontSize = options.get(107\n    /* suggestFontSize */\n    ) || fontInfo.fontSize;\n    const lineHeight = options.get(108\n    /* suggestLineHeight */\n    ) || fontInfo.lineHeight;\n    const fontWeight = fontInfo.fontWeight;\n    const fontSizePx = `${fontSize}px`;\n    const lineHeightPx = `${lineHeight}px`;\n    this.domNode.style.fontSize = fontSizePx;\n    this.domNode.style.lineHeight = `${lineHeight / fontSize}`;\n    this.domNode.style.fontWeight = fontWeight;\n    this.domNode.style.fontFeatureSettings = fontInfo.fontFeatureSettings;\n    this._type.style.fontFamily = fontFamily;\n    this._close.style.height = lineHeightPx;\n    this._close.style.width = lineHeightPx;\n  }\n\n  getLayoutInfo() {\n    const lineHeight = this._editor.getOption(108\n    /* suggestLineHeight */\n    ) || this._editor.getOption(44\n    /* fontInfo */\n    ).lineHeight;\n\n    const borderWidth = this._borderWidth;\n    const borderHeight = borderWidth * 2;\n    return {\n      lineHeight,\n      borderWidth,\n      borderHeight,\n      verticalPadding: 22,\n      horizontalPadding: 14\n    };\n  }\n\n  renderLoading() {\n    this._type.textContent = nls.localize('loading', \"Loading...\");\n    this._docs.textContent = '';\n    this.domNode.classList.remove('no-docs', 'no-type');\n    this.layout(this.size.width, this.getLayoutInfo().lineHeight * 2);\n\n    this._onDidChangeContents.fire(this);\n  }\n\n  renderItem(item, explainMode) {\n    var _a, _b;\n\n    this._renderDisposeable.clear();\n\n    let {\n      detail,\n      documentation\n    } = item.completion;\n\n    if (explainMode) {\n      let md = '';\n      md += `score: ${item.score[0]}\\n`;\n      md += `prefix: ${(_a = item.word) !== null && _a !== void 0 ? _a : '(no prefix)'}\\n`;\n      md += `word: ${item.completion.filterText ? item.completion.filterText + ' (filterText)' : item.textLabel}\\n`;\n      md += `distance: ${item.distance} (localityBonus-setting)\\n`;\n      md += `index: ${item.idx}, based on ${item.completion.sortText && `sortText: \"${item.completion.sortText}\"` || 'label'}\\n`;\n      md += `commit_chars: ${(_b = item.completion.commitCharacters) === null || _b === void 0 ? void 0 : _b.join('')}\\n`;\n      documentation = new MarkdownString().appendCodeblock('empty', md);\n      detail = `Provider: ${item.provider._debugDisplayName}`;\n    }\n\n    if (!explainMode && !canExpandCompletionItem(item)) {\n      this.clearContents();\n      return;\n    }\n\n    this.domNode.classList.remove('no-docs', 'no-type'); // --- details\n\n    if (detail) {\n      const cappedDetail = detail.length > 100000 ? `${detail.substr(0, 100000)}â€¦` : detail;\n      this._type.textContent = cappedDetail;\n      this._type.title = cappedDetail;\n      dom.show(this._type);\n\n      this._type.classList.toggle('auto-wrap', !/\\r?\\n^\\s+/gmi.test(cappedDetail));\n    } else {\n      dom.clearNode(this._type);\n      this._type.title = '';\n      dom.hide(this._type);\n      this.domNode.classList.add('no-type');\n    } // --- documentation\n\n\n    dom.clearNode(this._docs);\n\n    if (typeof documentation === 'string') {\n      this._docs.classList.remove('markdown-docs');\n\n      this._docs.textContent = documentation;\n    } else if (documentation) {\n      this._docs.classList.add('markdown-docs');\n\n      dom.clearNode(this._docs);\n\n      const renderedContents = this._markdownRenderer.render(documentation);\n\n      this._docs.appendChild(renderedContents.element);\n\n      this._renderDisposeable.add(renderedContents);\n\n      this._renderDisposeable.add(this._markdownRenderer.onDidRenderAsync(() => {\n        this.layout(this._size.width, this._type.clientHeight + this._docs.clientHeight);\n\n        this._onDidChangeContents.fire(this);\n      }));\n    }\n\n    this.domNode.style.userSelect = 'text';\n    this.domNode.tabIndex = -1;\n\n    this._close.onmousedown = e => {\n      e.preventDefault();\n      e.stopPropagation();\n    };\n\n    this._close.onclick = e => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      this._onDidClose.fire();\n    };\n\n    this._body.scrollTop = 0;\n    this.layout(this._size.width, this._type.clientHeight + this._docs.clientHeight);\n\n    this._onDidChangeContents.fire(this);\n  }\n\n  clearContents() {\n    this.domNode.classList.add('no-docs');\n    this._type.textContent = '';\n    this._docs.textContent = '';\n  }\n\n  get size() {\n    return this._size;\n  }\n\n  layout(width, height) {\n    const newSize = new dom.Dimension(width, height);\n\n    if (!dom.Dimension.equals(newSize, this._size)) {\n      this._size = newSize;\n      dom.size(this.domNode, width, height);\n    }\n\n    this._scrollbar.scanDomNode();\n  }\n\n  scrollDown(much = 8) {\n    this._body.scrollTop += much;\n  }\n\n  scrollUp(much = 8) {\n    this._body.scrollTop -= much;\n  }\n\n  scrollTop() {\n    this._body.scrollTop = 0;\n  }\n\n  scrollBottom() {\n    this._body.scrollTop = this._body.scrollHeight;\n  }\n\n  pageDown() {\n    this.scrollDown(80);\n  }\n\n  pageUp() {\n    this.scrollUp(80);\n  }\n\n  set borderWidth(width) {\n    this._borderWidth = width;\n  }\n\n  get borderWidth() {\n    return this._borderWidth;\n  }\n\n};\nSuggestDetailsWidget = __decorate([__param(1, IInstantiationService)], SuggestDetailsWidget);\nexport { SuggestDetailsWidget };\nexport class SuggestDetailsOverlay {\n  constructor(widget, _editor) {\n    this.widget = widget;\n    this._editor = _editor;\n    this._disposables = new DisposableStore();\n    this._added = false;\n    this._preferAlignAtTop = true;\n    this._resizable = new ResizableHTMLElement();\n\n    this._resizable.domNode.classList.add('suggest-details-container');\n\n    this._resizable.domNode.appendChild(widget.domNode);\n\n    this._resizable.enableSashes(false, true, true, false);\n\n    let topLeftNow;\n    let sizeNow;\n    let deltaTop = 0;\n    let deltaLeft = 0;\n\n    this._disposables.add(this._resizable.onDidWillResize(() => {\n      topLeftNow = this._topLeft;\n      sizeNow = this._resizable.size;\n    }));\n\n    this._disposables.add(this._resizable.onDidResize(e => {\n      if (topLeftNow && sizeNow) {\n        this.widget.layout(e.dimension.width, e.dimension.height);\n        let updateTopLeft = false;\n\n        if (e.west) {\n          deltaLeft = sizeNow.width - e.dimension.width;\n          updateTopLeft = true;\n        }\n\n        if (e.north) {\n          deltaTop = sizeNow.height - e.dimension.height;\n          updateTopLeft = true;\n        }\n\n        if (updateTopLeft) {\n          this._applyTopLeft({\n            top: topLeftNow.top + deltaTop,\n            left: topLeftNow.left + deltaLeft\n          });\n        }\n      }\n\n      if (e.done) {\n        topLeftNow = undefined;\n        sizeNow = undefined;\n        deltaTop = 0;\n        deltaLeft = 0;\n        this._userSize = e.dimension;\n      }\n    }));\n\n    this._disposables.add(this.widget.onDidChangeContents(() => {\n      var _a;\n\n      if (this._anchorBox) {\n        this._placeAtAnchor(this._anchorBox, (_a = this._userSize) !== null && _a !== void 0 ? _a : this.widget.size, this._preferAlignAtTop);\n      }\n    }));\n  }\n\n  dispose() {\n    this._resizable.dispose();\n\n    this._disposables.dispose();\n\n    this.hide();\n  }\n\n  getId() {\n    return 'suggest.details';\n  }\n\n  getDomNode() {\n    return this._resizable.domNode;\n  }\n\n  getPosition() {\n    return null;\n  }\n\n  show() {\n    if (!this._added) {\n      this._editor.addOverlayWidget(this);\n\n      this.getDomNode().style.position = 'fixed';\n      this._added = true;\n    }\n  }\n\n  hide(sessionEnded = false) {\n    this._resizable.clearSashHoverState();\n\n    if (this._added) {\n      this._editor.removeOverlayWidget(this);\n\n      this._added = false;\n      this._anchorBox = undefined;\n      this._topLeft = undefined;\n    }\n\n    if (sessionEnded) {\n      this._userSize = undefined;\n      this.widget.clearContents();\n    }\n  }\n\n  placeAtAnchor(anchor, preferAlignAtTop) {\n    var _a;\n\n    const anchorBox = anchor.getBoundingClientRect();\n    this._anchorBox = anchorBox;\n    this._preferAlignAtTop = preferAlignAtTop;\n\n    this._placeAtAnchor(this._anchorBox, (_a = this._userSize) !== null && _a !== void 0 ? _a : this.widget.size, preferAlignAtTop);\n  }\n\n  _placeAtAnchor(anchorBox, size, preferAlignAtTop) {\n    var _a;\n\n    const bodyBox = dom.getClientArea(document.body);\n    const info = this.widget.getLayoutInfo();\n    const defaultMinSize = new dom.Dimension(220, 2 * info.lineHeight);\n    const defaultTop = anchorBox.top; // EAST\n\n    const eastPlacement = function () {\n      const width = bodyBox.width - (anchorBox.left + anchorBox.width + info.borderWidth + info.horizontalPadding);\n      const left = -info.borderWidth + anchorBox.left + anchorBox.width;\n      const maxSizeTop = new dom.Dimension(width, bodyBox.height - anchorBox.top - info.borderHeight - info.verticalPadding);\n      const maxSizeBottom = maxSizeTop.with(undefined, anchorBox.top + anchorBox.height - info.borderHeight - info.verticalPadding);\n      return {\n        top: defaultTop,\n        left,\n        fit: width - size.width,\n        maxSizeTop,\n        maxSizeBottom,\n        minSize: defaultMinSize.with(Math.min(width, defaultMinSize.width))\n      };\n    }(); // WEST\n\n\n    const westPlacement = function () {\n      const width = anchorBox.left - info.borderWidth - info.horizontalPadding;\n      const left = Math.max(info.horizontalPadding, anchorBox.left - size.width - info.borderWidth);\n      const maxSizeTop = new dom.Dimension(width, bodyBox.height - anchorBox.top - info.borderHeight - info.verticalPadding);\n      const maxSizeBottom = maxSizeTop.with(undefined, anchorBox.top + anchorBox.height - info.borderHeight - info.verticalPadding);\n      return {\n        top: defaultTop,\n        left,\n        fit: width - size.width,\n        maxSizeTop,\n        maxSizeBottom,\n        minSize: defaultMinSize.with(Math.min(width, defaultMinSize.width))\n      };\n    }(); // SOUTH\n\n\n    const southPacement = function () {\n      const left = anchorBox.left;\n      const top = -info.borderWidth + anchorBox.top + anchorBox.height;\n      const maxSizeBottom = new dom.Dimension(anchorBox.width - info.borderHeight, bodyBox.height - anchorBox.top - anchorBox.height - info.verticalPadding);\n      return {\n        top,\n        left,\n        fit: maxSizeBottom.height - size.height,\n        maxSizeBottom,\n        maxSizeTop: maxSizeBottom,\n        minSize: defaultMinSize.with(maxSizeBottom.width)\n      };\n    }(); // take first placement that fits or the first with \"least bad\" fit\n\n\n    const placements = [eastPlacement, westPlacement, southPacement];\n    const placement = (_a = placements.find(p => p.fit >= 0)) !== null && _a !== void 0 ? _a : placements.sort((a, b) => b.fit - a.fit)[0]; // top/bottom placement\n\n    const bottom = anchorBox.top + anchorBox.height - info.borderHeight;\n    let alignAtTop;\n    let height = size.height;\n    const maxHeight = Math.max(placement.maxSizeTop.height, placement.maxSizeBottom.height);\n\n    if (height > maxHeight) {\n      height = maxHeight;\n    }\n\n    let maxSize;\n\n    if (preferAlignAtTop) {\n      if (height <= placement.maxSizeTop.height) {\n        alignAtTop = true;\n        maxSize = placement.maxSizeTop;\n      } else {\n        alignAtTop = false;\n        maxSize = placement.maxSizeBottom;\n      }\n    } else {\n      if (height <= placement.maxSizeBottom.height) {\n        alignAtTop = false;\n        maxSize = placement.maxSizeBottom;\n      } else {\n        alignAtTop = true;\n        maxSize = placement.maxSizeTop;\n      }\n    }\n\n    this._applyTopLeft({\n      left: placement.left,\n      top: alignAtTop ? placement.top : bottom - height\n    });\n\n    this.getDomNode().style.position = 'fixed';\n\n    this._resizable.enableSashes(!alignAtTop, placement === eastPlacement, alignAtTop, placement !== eastPlacement);\n\n    this._resizable.minSize = placement.minSize;\n    this._resizable.maxSize = maxSize;\n\n    this._resizable.layout(height, Math.min(maxSize.width, size.width));\n\n    this.widget.layout(this._resizable.size.width, this._resizable.size.height);\n  }\n\n  _applyTopLeft(topLeft) {\n    this._topLeft = topLeft;\n    this.getDomNode().style.left = `${this._topLeft.left}px`;\n    this.getDomNode().style.top = `${this._topLeft.top}px`;\n  }\n\n}","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/suggest/browser/suggestWidgetDetails.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","isSafari","dom","DomScrollableElement","Codicon","Emitter","MarkdownString","DisposableStore","MarkdownRenderer","EDITOR_FONT_DEFAULTS","ResizableHTMLElement","nls","IInstantiationService","canExpandCompletionItem","item","Boolean","completion","documentation","detail","label","SuggestDetailsWidget","constructor","_editor","instaService","_onDidClose","onDidClose","event","_onDidChangeContents","onDidChangeContents","_disposables","_renderDisposeable","_borderWidth","_size","Dimension","domNode","$","classList","add","_markdownRenderer","createInstance","editor","_body","_scrollbar","append","getDomNode","_header","_close","close","cssSelector","title","localize","_type","_docs","_configureFont","onDidChangeConfiguration","e","hasChanged","dispose","options","getOptions","fontInfo","get","fontFamily","getMassagedFontFamily","fontSize","lineHeight","fontWeight","fontSizePx","lineHeightPx","style","fontFeatureSettings","height","width","getLayoutInfo","getOption","borderWidth","borderHeight","verticalPadding","horizontalPadding","renderLoading","textContent","remove","layout","size","fire","renderItem","explainMode","_a","_b","clear","md","score","word","filterText","textLabel","distance","idx","sortText","commitCharacters","join","appendCodeblock","provider","_debugDisplayName","clearContents","cappedDetail","substr","show","toggle","test","clearNode","hide","renderedContents","render","appendChild","element","onDidRenderAsync","clientHeight","userSelect","tabIndex","onmousedown","preventDefault","stopPropagation","onclick","scrollTop","newSize","equals","scanDomNode","scrollDown","much","scrollUp","scrollBottom","scrollHeight","pageDown","pageUp","SuggestDetailsOverlay","widget","_added","_preferAlignAtTop","_resizable","enableSashes","topLeftNow","sizeNow","deltaTop","deltaLeft","onDidWillResize","_topLeft","onDidResize","dimension","updateTopLeft","west","north","_applyTopLeft","top","left","done","undefined","_userSize","_anchorBox","_placeAtAnchor","getId","getPosition","addOverlayWidget","position","sessionEnded","clearSashHoverState","removeOverlayWidget","placeAtAnchor","anchor","preferAlignAtTop","anchorBox","getBoundingClientRect","bodyBox","getClientArea","document","body","info","defaultMinSize","defaultTop","eastPlacement","maxSizeTop","maxSizeBottom","with","fit","minSize","Math","min","westPlacement","max","southPacement","placements","placement","find","p","sort","a","b","bottom","alignAtTop","maxHeight","maxSize","topLeft"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { isSafari } from '../../../../base/browser/browser.js';\nimport * as dom from '../../../../base/browser/dom.js';\nimport { DomScrollableElement } from '../../../../base/browser/ui/scrollbar/scrollableElement.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { MarkdownRenderer } from '../../markdownRenderer/browser/markdownRenderer.js';\nimport { EDITOR_FONT_DEFAULTS } from '../../../common/config/editorOptions.js';\nimport { ResizableHTMLElement } from './resizable.js';\nimport * as nls from '../../../../nls.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nexport function canExpandCompletionItem(item) {\n    return !!item && Boolean(item.completion.documentation || item.completion.detail && item.completion.detail !== item.completion.label);\n}\nlet SuggestDetailsWidget = class SuggestDetailsWidget {\n    constructor(_editor, instaService) {\n        this._editor = _editor;\n        this._onDidClose = new Emitter();\n        this.onDidClose = this._onDidClose.event;\n        this._onDidChangeContents = new Emitter();\n        this.onDidChangeContents = this._onDidChangeContents.event;\n        this._disposables = new DisposableStore();\n        this._renderDisposeable = new DisposableStore();\n        this._borderWidth = 1;\n        this._size = new dom.Dimension(330, 0);\n        this.domNode = dom.$('.suggest-details');\n        this.domNode.classList.add('no-docs');\n        this._markdownRenderer = instaService.createInstance(MarkdownRenderer, { editor: _editor });\n        this._body = dom.$('.body');\n        this._scrollbar = new DomScrollableElement(this._body, {});\n        dom.append(this.domNode, this._scrollbar.getDomNode());\n        this._disposables.add(this._scrollbar);\n        this._header = dom.append(this._body, dom.$('.header'));\n        this._close = dom.append(this._header, dom.$('span' + Codicon.close.cssSelector));\n        this._close.title = nls.localize('details.close', \"Close\");\n        this._type = dom.append(this._header, dom.$('p.type'));\n        this._docs = dom.append(this._body, dom.$('p.docs'));\n        this._configureFont();\n        this._disposables.add(this._editor.onDidChangeConfiguration(e => {\n            if (e.hasChanged(44 /* fontInfo */)) {\n                this._configureFont();\n            }\n        }));\n    }\n    dispose() {\n        this._disposables.dispose();\n        this._renderDisposeable.dispose();\n    }\n    _configureFont() {\n        const options = this._editor.getOptions();\n        const fontInfo = options.get(44 /* fontInfo */);\n        const fontFamily = fontInfo.getMassagedFontFamily(isSafari ? EDITOR_FONT_DEFAULTS.fontFamily : null);\n        const fontSize = options.get(107 /* suggestFontSize */) || fontInfo.fontSize;\n        const lineHeight = options.get(108 /* suggestLineHeight */) || fontInfo.lineHeight;\n        const fontWeight = fontInfo.fontWeight;\n        const fontSizePx = `${fontSize}px`;\n        const lineHeightPx = `${lineHeight}px`;\n        this.domNode.style.fontSize = fontSizePx;\n        this.domNode.style.lineHeight = `${lineHeight / fontSize}`;\n        this.domNode.style.fontWeight = fontWeight;\n        this.domNode.style.fontFeatureSettings = fontInfo.fontFeatureSettings;\n        this._type.style.fontFamily = fontFamily;\n        this._close.style.height = lineHeightPx;\n        this._close.style.width = lineHeightPx;\n    }\n    getLayoutInfo() {\n        const lineHeight = this._editor.getOption(108 /* suggestLineHeight */) || this._editor.getOption(44 /* fontInfo */).lineHeight;\n        const borderWidth = this._borderWidth;\n        const borderHeight = borderWidth * 2;\n        return {\n            lineHeight,\n            borderWidth,\n            borderHeight,\n            verticalPadding: 22,\n            horizontalPadding: 14\n        };\n    }\n    renderLoading() {\n        this._type.textContent = nls.localize('loading', \"Loading...\");\n        this._docs.textContent = '';\n        this.domNode.classList.remove('no-docs', 'no-type');\n        this.layout(this.size.width, this.getLayoutInfo().lineHeight * 2);\n        this._onDidChangeContents.fire(this);\n    }\n    renderItem(item, explainMode) {\n        var _a, _b;\n        this._renderDisposeable.clear();\n        let { detail, documentation } = item.completion;\n        if (explainMode) {\n            let md = '';\n            md += `score: ${item.score[0]}\\n`;\n            md += `prefix: ${(_a = item.word) !== null && _a !== void 0 ? _a : '(no prefix)'}\\n`;\n            md += `word: ${item.completion.filterText ? item.completion.filterText + ' (filterText)' : item.textLabel}\\n`;\n            md += `distance: ${item.distance} (localityBonus-setting)\\n`;\n            md += `index: ${item.idx}, based on ${item.completion.sortText && `sortText: \"${item.completion.sortText}\"` || 'label'}\\n`;\n            md += `commit_chars: ${(_b = item.completion.commitCharacters) === null || _b === void 0 ? void 0 : _b.join('')}\\n`;\n            documentation = new MarkdownString().appendCodeblock('empty', md);\n            detail = `Provider: ${item.provider._debugDisplayName}`;\n        }\n        if (!explainMode && !canExpandCompletionItem(item)) {\n            this.clearContents();\n            return;\n        }\n        this.domNode.classList.remove('no-docs', 'no-type');\n        // --- details\n        if (detail) {\n            const cappedDetail = detail.length > 100000 ? `${detail.substr(0, 100000)}â€¦` : detail;\n            this._type.textContent = cappedDetail;\n            this._type.title = cappedDetail;\n            dom.show(this._type);\n            this._type.classList.toggle('auto-wrap', !/\\r?\\n^\\s+/gmi.test(cappedDetail));\n        }\n        else {\n            dom.clearNode(this._type);\n            this._type.title = '';\n            dom.hide(this._type);\n            this.domNode.classList.add('no-type');\n        }\n        // --- documentation\n        dom.clearNode(this._docs);\n        if (typeof documentation === 'string') {\n            this._docs.classList.remove('markdown-docs');\n            this._docs.textContent = documentation;\n        }\n        else if (documentation) {\n            this._docs.classList.add('markdown-docs');\n            dom.clearNode(this._docs);\n            const renderedContents = this._markdownRenderer.render(documentation);\n            this._docs.appendChild(renderedContents.element);\n            this._renderDisposeable.add(renderedContents);\n            this._renderDisposeable.add(this._markdownRenderer.onDidRenderAsync(() => {\n                this.layout(this._size.width, this._type.clientHeight + this._docs.clientHeight);\n                this._onDidChangeContents.fire(this);\n            }));\n        }\n        this.domNode.style.userSelect = 'text';\n        this.domNode.tabIndex = -1;\n        this._close.onmousedown = e => {\n            e.preventDefault();\n            e.stopPropagation();\n        };\n        this._close.onclick = e => {\n            e.preventDefault();\n            e.stopPropagation();\n            this._onDidClose.fire();\n        };\n        this._body.scrollTop = 0;\n        this.layout(this._size.width, this._type.clientHeight + this._docs.clientHeight);\n        this._onDidChangeContents.fire(this);\n    }\n    clearContents() {\n        this.domNode.classList.add('no-docs');\n        this._type.textContent = '';\n        this._docs.textContent = '';\n    }\n    get size() {\n        return this._size;\n    }\n    layout(width, height) {\n        const newSize = new dom.Dimension(width, height);\n        if (!dom.Dimension.equals(newSize, this._size)) {\n            this._size = newSize;\n            dom.size(this.domNode, width, height);\n        }\n        this._scrollbar.scanDomNode();\n    }\n    scrollDown(much = 8) {\n        this._body.scrollTop += much;\n    }\n    scrollUp(much = 8) {\n        this._body.scrollTop -= much;\n    }\n    scrollTop() {\n        this._body.scrollTop = 0;\n    }\n    scrollBottom() {\n        this._body.scrollTop = this._body.scrollHeight;\n    }\n    pageDown() {\n        this.scrollDown(80);\n    }\n    pageUp() {\n        this.scrollUp(80);\n    }\n    set borderWidth(width) {\n        this._borderWidth = width;\n    }\n    get borderWidth() {\n        return this._borderWidth;\n    }\n};\nSuggestDetailsWidget = __decorate([\n    __param(1, IInstantiationService)\n], SuggestDetailsWidget);\nexport { SuggestDetailsWidget };\nexport class SuggestDetailsOverlay {\n    constructor(widget, _editor) {\n        this.widget = widget;\n        this._editor = _editor;\n        this._disposables = new DisposableStore();\n        this._added = false;\n        this._preferAlignAtTop = true;\n        this._resizable = new ResizableHTMLElement();\n        this._resizable.domNode.classList.add('suggest-details-container');\n        this._resizable.domNode.appendChild(widget.domNode);\n        this._resizable.enableSashes(false, true, true, false);\n        let topLeftNow;\n        let sizeNow;\n        let deltaTop = 0;\n        let deltaLeft = 0;\n        this._disposables.add(this._resizable.onDidWillResize(() => {\n            topLeftNow = this._topLeft;\n            sizeNow = this._resizable.size;\n        }));\n        this._disposables.add(this._resizable.onDidResize(e => {\n            if (topLeftNow && sizeNow) {\n                this.widget.layout(e.dimension.width, e.dimension.height);\n                let updateTopLeft = false;\n                if (e.west) {\n                    deltaLeft = sizeNow.width - e.dimension.width;\n                    updateTopLeft = true;\n                }\n                if (e.north) {\n                    deltaTop = sizeNow.height - e.dimension.height;\n                    updateTopLeft = true;\n                }\n                if (updateTopLeft) {\n                    this._applyTopLeft({\n                        top: topLeftNow.top + deltaTop,\n                        left: topLeftNow.left + deltaLeft,\n                    });\n                }\n            }\n            if (e.done) {\n                topLeftNow = undefined;\n                sizeNow = undefined;\n                deltaTop = 0;\n                deltaLeft = 0;\n                this._userSize = e.dimension;\n            }\n        }));\n        this._disposables.add(this.widget.onDidChangeContents(() => {\n            var _a;\n            if (this._anchorBox) {\n                this._placeAtAnchor(this._anchorBox, (_a = this._userSize) !== null && _a !== void 0 ? _a : this.widget.size, this._preferAlignAtTop);\n            }\n        }));\n    }\n    dispose() {\n        this._resizable.dispose();\n        this._disposables.dispose();\n        this.hide();\n    }\n    getId() {\n        return 'suggest.details';\n    }\n    getDomNode() {\n        return this._resizable.domNode;\n    }\n    getPosition() {\n        return null;\n    }\n    show() {\n        if (!this._added) {\n            this._editor.addOverlayWidget(this);\n            this.getDomNode().style.position = 'fixed';\n            this._added = true;\n        }\n    }\n    hide(sessionEnded = false) {\n        this._resizable.clearSashHoverState();\n        if (this._added) {\n            this._editor.removeOverlayWidget(this);\n            this._added = false;\n            this._anchorBox = undefined;\n            this._topLeft = undefined;\n        }\n        if (sessionEnded) {\n            this._userSize = undefined;\n            this.widget.clearContents();\n        }\n    }\n    placeAtAnchor(anchor, preferAlignAtTop) {\n        var _a;\n        const anchorBox = anchor.getBoundingClientRect();\n        this._anchorBox = anchorBox;\n        this._preferAlignAtTop = preferAlignAtTop;\n        this._placeAtAnchor(this._anchorBox, (_a = this._userSize) !== null && _a !== void 0 ? _a : this.widget.size, preferAlignAtTop);\n    }\n    _placeAtAnchor(anchorBox, size, preferAlignAtTop) {\n        var _a;\n        const bodyBox = dom.getClientArea(document.body);\n        const info = this.widget.getLayoutInfo();\n        const defaultMinSize = new dom.Dimension(220, 2 * info.lineHeight);\n        const defaultTop = anchorBox.top;\n        // EAST\n        const eastPlacement = (function () {\n            const width = bodyBox.width - (anchorBox.left + anchorBox.width + info.borderWidth + info.horizontalPadding);\n            const left = -info.borderWidth + anchorBox.left + anchorBox.width;\n            const maxSizeTop = new dom.Dimension(width, bodyBox.height - anchorBox.top - info.borderHeight - info.verticalPadding);\n            const maxSizeBottom = maxSizeTop.with(undefined, anchorBox.top + anchorBox.height - info.borderHeight - info.verticalPadding);\n            return { top: defaultTop, left, fit: width - size.width, maxSizeTop, maxSizeBottom, minSize: defaultMinSize.with(Math.min(width, defaultMinSize.width)) };\n        })();\n        // WEST\n        const westPlacement = (function () {\n            const width = anchorBox.left - info.borderWidth - info.horizontalPadding;\n            const left = Math.max(info.horizontalPadding, anchorBox.left - size.width - info.borderWidth);\n            const maxSizeTop = new dom.Dimension(width, bodyBox.height - anchorBox.top - info.borderHeight - info.verticalPadding);\n            const maxSizeBottom = maxSizeTop.with(undefined, anchorBox.top + anchorBox.height - info.borderHeight - info.verticalPadding);\n            return { top: defaultTop, left, fit: width - size.width, maxSizeTop, maxSizeBottom, minSize: defaultMinSize.with(Math.min(width, defaultMinSize.width)) };\n        })();\n        // SOUTH\n        const southPacement = (function () {\n            const left = anchorBox.left;\n            const top = -info.borderWidth + anchorBox.top + anchorBox.height;\n            const maxSizeBottom = new dom.Dimension(anchorBox.width - info.borderHeight, bodyBox.height - anchorBox.top - anchorBox.height - info.verticalPadding);\n            return { top, left, fit: maxSizeBottom.height - size.height, maxSizeBottom, maxSizeTop: maxSizeBottom, minSize: defaultMinSize.with(maxSizeBottom.width) };\n        })();\n        // take first placement that fits or the first with \"least bad\" fit\n        const placements = [eastPlacement, westPlacement, southPacement];\n        const placement = (_a = placements.find(p => p.fit >= 0)) !== null && _a !== void 0 ? _a : placements.sort((a, b) => b.fit - a.fit)[0];\n        // top/bottom placement\n        const bottom = anchorBox.top + anchorBox.height - info.borderHeight;\n        let alignAtTop;\n        let height = size.height;\n        const maxHeight = Math.max(placement.maxSizeTop.height, placement.maxSizeBottom.height);\n        if (height > maxHeight) {\n            height = maxHeight;\n        }\n        let maxSize;\n        if (preferAlignAtTop) {\n            if (height <= placement.maxSizeTop.height) {\n                alignAtTop = true;\n                maxSize = placement.maxSizeTop;\n            }\n            else {\n                alignAtTop = false;\n                maxSize = placement.maxSizeBottom;\n            }\n        }\n        else {\n            if (height <= placement.maxSizeBottom.height) {\n                alignAtTop = false;\n                maxSize = placement.maxSizeBottom;\n            }\n            else {\n                alignAtTop = true;\n                maxSize = placement.maxSizeTop;\n            }\n        }\n        this._applyTopLeft({ left: placement.left, top: alignAtTop ? placement.top : bottom - height });\n        this.getDomNode().style.position = 'fixed';\n        this._resizable.enableSashes(!alignAtTop, placement === eastPlacement, alignAtTop, placement !== eastPlacement);\n        this._resizable.minSize = placement.minSize;\n        this._resizable.maxSize = maxSize;\n        this._resizable.layout(height, Math.min(maxSize.width, size.width));\n        this.widget.layout(this._resizable.size.width, this._resizable.size.height);\n    }\n    _applyTopLeft(topLeft) {\n        this._topLeft = topLeft;\n        this.getDomNode().style.left = `${this._topLeft.left}px`;\n        this.getDomNode().style.top = `${this._topLeft.top}px`;\n    }\n}\n"]},"metadata":{},"sourceType":"module"}