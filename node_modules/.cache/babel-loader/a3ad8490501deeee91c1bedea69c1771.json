{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as dom from '../../base/browser/dom.js';\nimport { GlobalMouseMoveMonitor } from '../../base/browser/globalMouseMoveMonitor.js';\nimport { StandardMouseEvent } from '../../base/browser/mouseEvent.js';\nimport { RunOnceScheduler } from '../../base/common/async.js';\nimport { Disposable } from '../../base/common/lifecycle.js';\nimport { asCssVariableName } from '../../platform/theme/common/colorRegistry.js';\n/**\n * Coordinates relative to the whole document (e.g. mouse event's pageX and pageY)\n */\n\nexport class PageCoordinates {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n    this._pageCoordinatesBrand = undefined;\n  }\n\n  toClientCoordinates() {\n    return new ClientCoordinates(this.x - dom.StandardWindow.scrollX, this.y - dom.StandardWindow.scrollY);\n  }\n\n}\n/**\n * Coordinates within the application's client area (i.e. origin is document's scroll position).\n *\n * For example, clicking in the top-left corner of the client area will\n * always result in a mouse event with a client.x value of 0, regardless\n * of whether the page is scrolled horizontally.\n */\n\nexport class ClientCoordinates {\n  constructor(clientX, clientY) {\n    this.clientX = clientX;\n    this.clientY = clientY;\n    this._clientCoordinatesBrand = undefined;\n  }\n\n  toPageCoordinates() {\n    return new PageCoordinates(this.clientX + dom.StandardWindow.scrollX, this.clientY + dom.StandardWindow.scrollY);\n  }\n\n}\n/**\n * The position of the editor in the page.\n */\n\nexport class EditorPagePosition {\n  constructor(x, y, width, height) {\n    this.x = x;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this._editorPagePositionBrand = undefined;\n  }\n\n}\n/**\n * Coordinates relative to the the (top;left) of the editor that can be used safely with other internal editor metrics.\n * **NOTE**: This position is obtained by taking page coordinates and transforming them relative to the\n * editor's (top;left) position in a way in which scale transformations are taken into account.\n * **NOTE**: These coordinates could be negative if the mouse position is outside the editor.\n */\n\nexport class CoordinatesRelativeToEditor {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n    this._positionRelativeToEditorBrand = undefined;\n  }\n\n}\nexport function createEditorPagePosition(editorViewDomNode) {\n  const editorPos = dom.getDomNodePagePosition(editorViewDomNode);\n  return new EditorPagePosition(editorPos.left, editorPos.top, editorPos.width, editorPos.height);\n}\nexport function createCoordinatesRelativeToEditor(editorViewDomNode, editorPagePosition, pos) {\n  // The editor's page position is read from the DOM using getBoundingClientRect().\n  //\n  // getBoundingClientRect() returns the actual dimensions, while offsetWidth and offsetHeight\n  // reflect the unscaled size. We can use this difference to detect a transform:scale()\n  // and we will apply the transformation in inverse to get mouse coordinates that make sense inside the editor.\n  //\n  // This could be expanded to cover rotation as well maybe by walking the DOM up from `editorViewDomNode`\n  // and computing the effective transformation matrix using getComputedStyle(element).transform.\n  //\n  const scaleX = editorPagePosition.width / editorViewDomNode.offsetWidth;\n  const scaleY = editorPagePosition.height / editorViewDomNode.offsetHeight; // Adjust mouse offsets if editor appears to be scaled via transforms\n\n  const relativeX = (pos.x - editorPagePosition.x) / scaleX;\n  const relativeY = (pos.y - editorPagePosition.y) / scaleY;\n  return new CoordinatesRelativeToEditor(relativeX, relativeY);\n}\nexport class EditorMouseEvent extends StandardMouseEvent {\n  constructor(e, editorViewDomNode) {\n    super(e);\n    this._editorMouseEventBrand = undefined;\n    this.pos = new PageCoordinates(this.posx, this.posy);\n    this.editorPos = createEditorPagePosition(editorViewDomNode);\n    this.relativePos = createCoordinatesRelativeToEditor(editorViewDomNode, this.editorPos, this.pos);\n  }\n\n}\nexport class EditorMouseEventFactory {\n  constructor(editorViewDomNode) {\n    this._editorViewDomNode = editorViewDomNode;\n  }\n\n  _create(e) {\n    return new EditorMouseEvent(e, this._editorViewDomNode);\n  }\n\n  onContextMenu(target, callback) {\n    return dom.addDisposableListener(target, 'contextmenu', e => {\n      callback(this._create(e));\n    });\n  }\n\n  onMouseUp(target, callback) {\n    return dom.addDisposableListener(target, 'mouseup', e => {\n      callback(this._create(e));\n    });\n  }\n\n  onMouseDown(target, callback) {\n    return dom.addDisposableListener(target, 'mousedown', e => {\n      callback(this._create(e));\n    });\n  }\n\n  onMouseLeave(target, callback) {\n    return dom.addDisposableNonBubblingMouseOutListener(target, e => {\n      callback(this._create(e));\n    });\n  }\n\n  onMouseMoveThrottled(target, callback, merger, minimumTimeMs) {\n    const myMerger = (lastEvent, currentEvent) => {\n      return merger(lastEvent, this._create(currentEvent));\n    };\n\n    return dom.addDisposableThrottledListener(target, 'mousemove', callback, myMerger, minimumTimeMs);\n  }\n\n}\nexport class EditorPointerEventFactory {\n  constructor(editorViewDomNode) {\n    this._editorViewDomNode = editorViewDomNode;\n  }\n\n  _create(e) {\n    return new EditorMouseEvent(e, this._editorViewDomNode);\n  }\n\n  onPointerUp(target, callback) {\n    return dom.addDisposableListener(target, 'pointerup', e => {\n      callback(this._create(e));\n    });\n  }\n\n  onPointerDown(target, callback) {\n    return dom.addDisposableListener(target, 'pointerdown', e => {\n      callback(this._create(e));\n    });\n  }\n\n  onPointerLeave(target, callback) {\n    return dom.addDisposableNonBubblingPointerOutListener(target, e => {\n      callback(this._create(e));\n    });\n  }\n\n  onPointerMoveThrottled(target, callback, merger, minimumTimeMs) {\n    const myMerger = (lastEvent, currentEvent) => {\n      return merger(lastEvent, this._create(currentEvent));\n    };\n\n    return dom.addDisposableThrottledListener(target, 'pointermove', callback, myMerger, minimumTimeMs);\n  }\n\n}\nexport class GlobalEditorMouseMoveMonitor extends Disposable {\n  constructor(editorViewDomNode) {\n    super();\n    this._editorViewDomNode = editorViewDomNode;\n    this._globalMouseMoveMonitor = this._register(new GlobalMouseMoveMonitor());\n    this._keydownListener = null;\n  }\n\n  startMonitoring(initialElement, initialButtons, merger, mouseMoveCallback, onStopCallback) {\n    // Add a <<capture>> keydown event listener that will cancel the monitoring\n    // if something other than a modifier key is pressed\n    this._keydownListener = dom.addStandardDisposableListener(document, 'keydown', e => {\n      const kb = e.toKeybinding();\n\n      if (kb.isModifierKey()) {\n        // Allow modifier keys\n        return;\n      }\n\n      this._globalMouseMoveMonitor.stopMonitoring(true, e.browserEvent);\n    }, true);\n\n    const myMerger = (lastEvent, currentEvent) => {\n      return merger(lastEvent, new EditorMouseEvent(currentEvent, this._editorViewDomNode));\n    };\n\n    this._globalMouseMoveMonitor.startMonitoring(initialElement, initialButtons, myMerger, mouseMoveCallback, e => {\n      this._keydownListener.dispose();\n\n      onStopCallback(e);\n    });\n  }\n\n  stopMonitoring() {\n    this._globalMouseMoveMonitor.stopMonitoring(true);\n  }\n\n}\n/**\n * A helper to create dynamic css rules, bound to a class name.\n * Rules are reused.\n * Reference counting and delayed garbage collection ensure that no rules leak.\n*/\n\nexport class DynamicCssRules {\n  constructor(_editor) {\n    this._editor = _editor;\n    this._instanceId = ++DynamicCssRules._idPool;\n    this._counter = 0;\n    this._rules = new Map(); // We delay garbage collection so that hanging rules can be reused.\n\n    this._garbageCollectionScheduler = new RunOnceScheduler(() => this.garbageCollect(), 1000);\n  }\n\n  createClassNameRef(options) {\n    const rule = this.getOrCreateRule(options);\n    rule.increaseRefCount();\n    return {\n      className: rule.className,\n      dispose: () => {\n        rule.decreaseRefCount();\n\n        this._garbageCollectionScheduler.schedule();\n      }\n    };\n  }\n\n  getOrCreateRule(properties) {\n    const key = this.computeUniqueKey(properties);\n\n    let existingRule = this._rules.get(key);\n\n    if (!existingRule) {\n      const counter = this._counter++;\n      existingRule = new RefCountedCssRule(key, `dyn-rule-${this._instanceId}-${counter}`, dom.isInShadowDOM(this._editor.getContainerDomNode()) ? this._editor.getContainerDomNode() : undefined, properties);\n\n      this._rules.set(key, existingRule);\n    }\n\n    return existingRule;\n  }\n\n  computeUniqueKey(properties) {\n    return JSON.stringify(properties);\n  }\n\n  garbageCollect() {\n    for (const rule of this._rules.values()) {\n      if (!rule.hasReferences()) {\n        this._rules.delete(rule.key);\n\n        rule.dispose();\n      }\n    }\n  }\n\n}\nDynamicCssRules._idPool = 0;\n\nclass RefCountedCssRule {\n  constructor(key, className, _containerElement, properties) {\n    this.key = key;\n    this.className = className;\n    this.properties = properties;\n    this._referenceCount = 0;\n    this._styleElement = dom.createStyleSheet(_containerElement);\n    this._styleElement.textContent = this.getCssText(this.className, this.properties);\n  }\n\n  getCssText(className, properties) {\n    let str = `.${className} {`;\n\n    for (const prop in properties) {\n      const value = properties[prop];\n      let cssValue;\n\n      if (typeof value === 'object') {\n        cssValue = `var(${asCssVariableName(value.id)})`;\n      } else {\n        cssValue = value;\n      }\n\n      const cssPropName = camelToDashes(prop);\n      str += `\\n\\t${cssPropName}: ${cssValue};`;\n    }\n\n    str += `\\n}`;\n    return str;\n  }\n\n  dispose() {\n    this._styleElement.remove();\n  }\n\n  increaseRefCount() {\n    this._referenceCount++;\n  }\n\n  decreaseRefCount() {\n    this._referenceCount--;\n  }\n\n  hasReferences() {\n    return this._referenceCount > 0;\n  }\n\n}\n\nfunction camelToDashes(str) {\n  return str.replace(/(^[A-Z])/, ([first]) => first.toLowerCase()).replace(/([A-Z])/g, ([letter]) => `-${letter.toLowerCase()}`);\n}","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/browser/editorDom.js"],"names":["dom","GlobalMouseMoveMonitor","StandardMouseEvent","RunOnceScheduler","Disposable","asCssVariableName","PageCoordinates","constructor","x","y","_pageCoordinatesBrand","undefined","toClientCoordinates","ClientCoordinates","StandardWindow","scrollX","scrollY","clientX","clientY","_clientCoordinatesBrand","toPageCoordinates","EditorPagePosition","width","height","_editorPagePositionBrand","CoordinatesRelativeToEditor","_positionRelativeToEditorBrand","createEditorPagePosition","editorViewDomNode","editorPos","getDomNodePagePosition","left","top","createCoordinatesRelativeToEditor","editorPagePosition","pos","scaleX","offsetWidth","scaleY","offsetHeight","relativeX","relativeY","EditorMouseEvent","e","_editorMouseEventBrand","posx","posy","relativePos","EditorMouseEventFactory","_editorViewDomNode","_create","onContextMenu","target","callback","addDisposableListener","onMouseUp","onMouseDown","onMouseLeave","addDisposableNonBubblingMouseOutListener","onMouseMoveThrottled","merger","minimumTimeMs","myMerger","lastEvent","currentEvent","addDisposableThrottledListener","EditorPointerEventFactory","onPointerUp","onPointerDown","onPointerLeave","addDisposableNonBubblingPointerOutListener","onPointerMoveThrottled","GlobalEditorMouseMoveMonitor","_globalMouseMoveMonitor","_register","_keydownListener","startMonitoring","initialElement","initialButtons","mouseMoveCallback","onStopCallback","addStandardDisposableListener","document","kb","toKeybinding","isModifierKey","stopMonitoring","browserEvent","dispose","DynamicCssRules","_editor","_instanceId","_idPool","_counter","_rules","Map","_garbageCollectionScheduler","garbageCollect","createClassNameRef","options","rule","getOrCreateRule","increaseRefCount","className","decreaseRefCount","schedule","properties","key","computeUniqueKey","existingRule","get","counter","RefCountedCssRule","isInShadowDOM","getContainerDomNode","set","JSON","stringify","values","hasReferences","delete","_containerElement","_referenceCount","_styleElement","createStyleSheet","textContent","getCssText","str","prop","value","cssValue","id","cssPropName","camelToDashes","remove","replace","first","toLowerCase","letter"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as dom from '../../base/browser/dom.js';\nimport { GlobalMouseMoveMonitor } from '../../base/browser/globalMouseMoveMonitor.js';\nimport { StandardMouseEvent } from '../../base/browser/mouseEvent.js';\nimport { RunOnceScheduler } from '../../base/common/async.js';\nimport { Disposable } from '../../base/common/lifecycle.js';\nimport { asCssVariableName } from '../../platform/theme/common/colorRegistry.js';\n/**\n * Coordinates relative to the whole document (e.g. mouse event's pageX and pageY)\n */\nexport class PageCoordinates {\n    constructor(x, y) {\n        this.x = x;\n        this.y = y;\n        this._pageCoordinatesBrand = undefined;\n    }\n    toClientCoordinates() {\n        return new ClientCoordinates(this.x - dom.StandardWindow.scrollX, this.y - dom.StandardWindow.scrollY);\n    }\n}\n/**\n * Coordinates within the application's client area (i.e. origin is document's scroll position).\n *\n * For example, clicking in the top-left corner of the client area will\n * always result in a mouse event with a client.x value of 0, regardless\n * of whether the page is scrolled horizontally.\n */\nexport class ClientCoordinates {\n    constructor(clientX, clientY) {\n        this.clientX = clientX;\n        this.clientY = clientY;\n        this._clientCoordinatesBrand = undefined;\n    }\n    toPageCoordinates() {\n        return new PageCoordinates(this.clientX + dom.StandardWindow.scrollX, this.clientY + dom.StandardWindow.scrollY);\n    }\n}\n/**\n * The position of the editor in the page.\n */\nexport class EditorPagePosition {\n    constructor(x, y, width, height) {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n        this._editorPagePositionBrand = undefined;\n    }\n}\n/**\n * Coordinates relative to the the (top;left) of the editor that can be used safely with other internal editor metrics.\n * **NOTE**: This position is obtained by taking page coordinates and transforming them relative to the\n * editor's (top;left) position in a way in which scale transformations are taken into account.\n * **NOTE**: These coordinates could be negative if the mouse position is outside the editor.\n */\nexport class CoordinatesRelativeToEditor {\n    constructor(x, y) {\n        this.x = x;\n        this.y = y;\n        this._positionRelativeToEditorBrand = undefined;\n    }\n}\nexport function createEditorPagePosition(editorViewDomNode) {\n    const editorPos = dom.getDomNodePagePosition(editorViewDomNode);\n    return new EditorPagePosition(editorPos.left, editorPos.top, editorPos.width, editorPos.height);\n}\nexport function createCoordinatesRelativeToEditor(editorViewDomNode, editorPagePosition, pos) {\n    // The editor's page position is read from the DOM using getBoundingClientRect().\n    //\n    // getBoundingClientRect() returns the actual dimensions, while offsetWidth and offsetHeight\n    // reflect the unscaled size. We can use this difference to detect a transform:scale()\n    // and we will apply the transformation in inverse to get mouse coordinates that make sense inside the editor.\n    //\n    // This could be expanded to cover rotation as well maybe by walking the DOM up from `editorViewDomNode`\n    // and computing the effective transformation matrix using getComputedStyle(element).transform.\n    //\n    const scaleX = editorPagePosition.width / editorViewDomNode.offsetWidth;\n    const scaleY = editorPagePosition.height / editorViewDomNode.offsetHeight;\n    // Adjust mouse offsets if editor appears to be scaled via transforms\n    const relativeX = (pos.x - editorPagePosition.x) / scaleX;\n    const relativeY = (pos.y - editorPagePosition.y) / scaleY;\n    return new CoordinatesRelativeToEditor(relativeX, relativeY);\n}\nexport class EditorMouseEvent extends StandardMouseEvent {\n    constructor(e, editorViewDomNode) {\n        super(e);\n        this._editorMouseEventBrand = undefined;\n        this.pos = new PageCoordinates(this.posx, this.posy);\n        this.editorPos = createEditorPagePosition(editorViewDomNode);\n        this.relativePos = createCoordinatesRelativeToEditor(editorViewDomNode, this.editorPos, this.pos);\n    }\n}\nexport class EditorMouseEventFactory {\n    constructor(editorViewDomNode) {\n        this._editorViewDomNode = editorViewDomNode;\n    }\n    _create(e) {\n        return new EditorMouseEvent(e, this._editorViewDomNode);\n    }\n    onContextMenu(target, callback) {\n        return dom.addDisposableListener(target, 'contextmenu', (e) => {\n            callback(this._create(e));\n        });\n    }\n    onMouseUp(target, callback) {\n        return dom.addDisposableListener(target, 'mouseup', (e) => {\n            callback(this._create(e));\n        });\n    }\n    onMouseDown(target, callback) {\n        return dom.addDisposableListener(target, 'mousedown', (e) => {\n            callback(this._create(e));\n        });\n    }\n    onMouseLeave(target, callback) {\n        return dom.addDisposableNonBubblingMouseOutListener(target, (e) => {\n            callback(this._create(e));\n        });\n    }\n    onMouseMoveThrottled(target, callback, merger, minimumTimeMs) {\n        const myMerger = (lastEvent, currentEvent) => {\n            return merger(lastEvent, this._create(currentEvent));\n        };\n        return dom.addDisposableThrottledListener(target, 'mousemove', callback, myMerger, minimumTimeMs);\n    }\n}\nexport class EditorPointerEventFactory {\n    constructor(editorViewDomNode) {\n        this._editorViewDomNode = editorViewDomNode;\n    }\n    _create(e) {\n        return new EditorMouseEvent(e, this._editorViewDomNode);\n    }\n    onPointerUp(target, callback) {\n        return dom.addDisposableListener(target, 'pointerup', (e) => {\n            callback(this._create(e));\n        });\n    }\n    onPointerDown(target, callback) {\n        return dom.addDisposableListener(target, 'pointerdown', (e) => {\n            callback(this._create(e));\n        });\n    }\n    onPointerLeave(target, callback) {\n        return dom.addDisposableNonBubblingPointerOutListener(target, (e) => {\n            callback(this._create(e));\n        });\n    }\n    onPointerMoveThrottled(target, callback, merger, minimumTimeMs) {\n        const myMerger = (lastEvent, currentEvent) => {\n            return merger(lastEvent, this._create(currentEvent));\n        };\n        return dom.addDisposableThrottledListener(target, 'pointermove', callback, myMerger, minimumTimeMs);\n    }\n}\nexport class GlobalEditorMouseMoveMonitor extends Disposable {\n    constructor(editorViewDomNode) {\n        super();\n        this._editorViewDomNode = editorViewDomNode;\n        this._globalMouseMoveMonitor = this._register(new GlobalMouseMoveMonitor());\n        this._keydownListener = null;\n    }\n    startMonitoring(initialElement, initialButtons, merger, mouseMoveCallback, onStopCallback) {\n        // Add a <<capture>> keydown event listener that will cancel the monitoring\n        // if something other than a modifier key is pressed\n        this._keydownListener = dom.addStandardDisposableListener(document, 'keydown', (e) => {\n            const kb = e.toKeybinding();\n            if (kb.isModifierKey()) {\n                // Allow modifier keys\n                return;\n            }\n            this._globalMouseMoveMonitor.stopMonitoring(true, e.browserEvent);\n        }, true);\n        const myMerger = (lastEvent, currentEvent) => {\n            return merger(lastEvent, new EditorMouseEvent(currentEvent, this._editorViewDomNode));\n        };\n        this._globalMouseMoveMonitor.startMonitoring(initialElement, initialButtons, myMerger, mouseMoveCallback, (e) => {\n            this._keydownListener.dispose();\n            onStopCallback(e);\n        });\n    }\n    stopMonitoring() {\n        this._globalMouseMoveMonitor.stopMonitoring(true);\n    }\n}\n/**\n * A helper to create dynamic css rules, bound to a class name.\n * Rules are reused.\n * Reference counting and delayed garbage collection ensure that no rules leak.\n*/\nexport class DynamicCssRules {\n    constructor(_editor) {\n        this._editor = _editor;\n        this._instanceId = ++DynamicCssRules._idPool;\n        this._counter = 0;\n        this._rules = new Map();\n        // We delay garbage collection so that hanging rules can be reused.\n        this._garbageCollectionScheduler = new RunOnceScheduler(() => this.garbageCollect(), 1000);\n    }\n    createClassNameRef(options) {\n        const rule = this.getOrCreateRule(options);\n        rule.increaseRefCount();\n        return {\n            className: rule.className,\n            dispose: () => {\n                rule.decreaseRefCount();\n                this._garbageCollectionScheduler.schedule();\n            }\n        };\n    }\n    getOrCreateRule(properties) {\n        const key = this.computeUniqueKey(properties);\n        let existingRule = this._rules.get(key);\n        if (!existingRule) {\n            const counter = this._counter++;\n            existingRule = new RefCountedCssRule(key, `dyn-rule-${this._instanceId}-${counter}`, dom.isInShadowDOM(this._editor.getContainerDomNode())\n                ? this._editor.getContainerDomNode()\n                : undefined, properties);\n            this._rules.set(key, existingRule);\n        }\n        return existingRule;\n    }\n    computeUniqueKey(properties) {\n        return JSON.stringify(properties);\n    }\n    garbageCollect() {\n        for (const rule of this._rules.values()) {\n            if (!rule.hasReferences()) {\n                this._rules.delete(rule.key);\n                rule.dispose();\n            }\n        }\n    }\n}\nDynamicCssRules._idPool = 0;\nclass RefCountedCssRule {\n    constructor(key, className, _containerElement, properties) {\n        this.key = key;\n        this.className = className;\n        this.properties = properties;\n        this._referenceCount = 0;\n        this._styleElement = dom.createStyleSheet(_containerElement);\n        this._styleElement.textContent = this.getCssText(this.className, this.properties);\n    }\n    getCssText(className, properties) {\n        let str = `.${className} {`;\n        for (const prop in properties) {\n            const value = properties[prop];\n            let cssValue;\n            if (typeof value === 'object') {\n                cssValue = `var(${asCssVariableName(value.id)})`;\n            }\n            else {\n                cssValue = value;\n            }\n            const cssPropName = camelToDashes(prop);\n            str += `\\n\\t${cssPropName}: ${cssValue};`;\n        }\n        str += `\\n}`;\n        return str;\n    }\n    dispose() {\n        this._styleElement.remove();\n    }\n    increaseRefCount() {\n        this._referenceCount++;\n    }\n    decreaseRefCount() {\n        this._referenceCount--;\n    }\n    hasReferences() {\n        return this._referenceCount > 0;\n    }\n}\nfunction camelToDashes(str) {\n    return str.replace(/(^[A-Z])/, ([first]) => first.toLowerCase())\n        .replace(/([A-Z])/g, ([letter]) => `-${letter.toLowerCase()}`);\n}\n"]},"metadata":{},"sourceType":"module"}