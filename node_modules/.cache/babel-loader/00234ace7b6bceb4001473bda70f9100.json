{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport { InvisibleCharacters } from '../../../../base/common/strings.js';\nimport './unicodeHighlighter.css';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { inUntrustedWorkspace, unicodeHighlightConfigKeys } from '../../../common/config/editorOptions.js';\nimport { ModelDecorationOptions } from '../../../common/model/textModel.js';\nimport { UnicodeTextModelHighlighter } from '../../../common/languages/unicodeTextModelHighlighter.js';\nimport { IEditorWorkerService } from '../../../common/services/editorWorker.js';\nimport { ILanguageService } from '../../../common/services/language.js';\nimport { isModelDecorationInComment, isModelDecorationInString, isModelDecorationVisible } from '../../../common/viewModel/viewModelDecorations.js';\nimport { MarkdownHover, renderMarkdownHovers } from '../../hover/browser/markdownHoverParticipant.js';\nimport { BannerController } from './bannerController.js';\nimport * as nls from '../../../../nls.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { registerIcon } from '../../../../platform/theme/common/iconRegistry.js';\nimport { IWorkspaceTrustManagementService } from '../../../../platform/workspace/common/workspaceTrust.js';\nexport const warningIcon = registerIcon('extensions-warning-message', Codicon.warning, nls.localize('warningIcon', 'Icon shown with a warning message in the extensions editor.'));\nlet UnicodeHighlighter = class UnicodeHighlighter extends Disposable {\n  constructor(_editor, _editorWorkerService, _workspaceTrustService, instantiationService) {\n    super();\n    this._editor = _editor;\n    this._editorWorkerService = _editorWorkerService;\n    this._workspaceTrustService = _workspaceTrustService;\n    this._highlighter = null;\n    this._bannerClosed = false;\n\n    this._updateState = state => {\n      if (state && state.hasMore) {\n        if (this._bannerClosed) {\n          return;\n        } // This document contains many non-basic ASCII characters.\n\n\n        const max = Math.max(state.ambiguousCharacterCount, state.nonBasicAsciiCharacterCount, state.invisibleCharacterCount);\n        let data;\n\n        if (state.nonBasicAsciiCharacterCount >= max) {\n          data = {\n            message: nls.localize('unicodeHighlighting.thisDocumentHasManyNonBasicAsciiUnicodeCharacters', 'This document contains many non-basic ASCII unicode characters'),\n            command: new DisableHighlightingOfNonBasicAsciiCharactersAction()\n          };\n        } else if (state.ambiguousCharacterCount >= max) {\n          data = {\n            message: nls.localize('unicodeHighlighting.thisDocumentHasManyAmbiguousUnicodeCharacters', 'This document contains many ambiguous unicode characters'),\n            command: new DisableHighlightingOfAmbiguousCharactersAction()\n          };\n        } else if (state.invisibleCharacterCount >= max) {\n          data = {\n            message: nls.localize('unicodeHighlighting.thisDocumentHasManyInvisibleUnicodeCharacters', 'This document contains many invisible unicode characters'),\n            command: new DisableHighlightingOfInvisibleCharactersAction()\n          };\n        } else {\n          throw new Error('Unreachable');\n        }\n\n        this._bannerController.show({\n          id: 'unicodeHighlightBanner',\n          message: data.message,\n          icon: warningIcon,\n          actions: [{\n            label: data.command.shortLabel,\n            href: `command:${data.command.id}`\n          }],\n          onClose: () => {\n            this._bannerClosed = true;\n          }\n        });\n      } else {\n        this._bannerController.hide();\n      }\n    };\n\n    this._bannerController = this._register(instantiationService.createInstance(BannerController, _editor));\n\n    this._register(this._editor.onDidChangeModel(() => {\n      this._bannerClosed = false;\n\n      this._updateHighlighter();\n    }));\n\n    this._options = _editor.getOption(113\n    /* unicodeHighlighting */\n    );\n\n    this._register(_workspaceTrustService.onDidChangeTrust(e => {\n      this._updateHighlighter();\n    }));\n\n    this._register(_editor.onDidChangeConfiguration(e => {\n      if (e.hasChanged(113\n      /* unicodeHighlighting */\n      )) {\n        this._options = _editor.getOption(113\n        /* unicodeHighlighting */\n        );\n\n        this._updateHighlighter();\n      }\n    }));\n\n    this._updateHighlighter();\n  }\n\n  dispose() {\n    if (this._highlighter) {\n      this._highlighter.dispose();\n\n      this._highlighter = null;\n    }\n\n    super.dispose();\n  }\n\n  _updateHighlighter() {\n    this._updateState(null);\n\n    if (this._highlighter) {\n      this._highlighter.dispose();\n\n      this._highlighter = null;\n    }\n\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    const options = resolveOptions(this._workspaceTrustService.isWorkspaceTrusted(), this._options);\n\n    if ([options.nonBasicASCII, options.ambiguousCharacters, options.invisibleCharacters].every(option => option === false)) {\n      // Don't do anything if the feature is fully disabled\n      return;\n    }\n\n    const highlightOptions = {\n      nonBasicASCII: options.nonBasicASCII,\n      ambiguousCharacters: options.ambiguousCharacters,\n      invisibleCharacters: options.invisibleCharacters,\n      includeComments: options.includeComments,\n      includeStrings: options.includeStrings,\n      allowedCodePoints: Object.keys(options.allowedCharacters).map(c => c.codePointAt(0)),\n      allowedLocales: Object.keys(options.allowedLocales).map(locale => {\n        if (locale === '_os') {\n          let osLocale = new Intl.NumberFormat().resolvedOptions().locale;\n          return osLocale;\n        } else if (locale === '_vscode') {\n          return platform.language;\n        }\n\n        return locale;\n      })\n    };\n\n    if (this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)) {\n      this._highlighter = new DocumentUnicodeHighlighter(this._editor, highlightOptions, this._updateState, this._editorWorkerService);\n    } else {\n      this._highlighter = new ViewportUnicodeHighlighter(this._editor, highlightOptions, this._updateState);\n    }\n  }\n\n  getDecorationInfo(decorationId) {\n    if (this._highlighter) {\n      return this._highlighter.getDecorationInfo(decorationId);\n    }\n\n    return null;\n  }\n\n};\nUnicodeHighlighter.ID = 'editor.contrib.unicodeHighlighter';\nUnicodeHighlighter = __decorate([__param(1, IEditorWorkerService), __param(2, IWorkspaceTrustManagementService), __param(3, IInstantiationService)], UnicodeHighlighter);\nexport { UnicodeHighlighter };\n\nfunction resolveOptions(trusted, options) {\n  return {\n    nonBasicASCII: options.nonBasicASCII === inUntrustedWorkspace ? !trusted : options.nonBasicASCII,\n    ambiguousCharacters: options.ambiguousCharacters,\n    invisibleCharacters: options.invisibleCharacters,\n    includeComments: options.includeComments === inUntrustedWorkspace ? !trusted : options.includeComments,\n    includeStrings: options.includeStrings === inUntrustedWorkspace ? !trusted : options.includeStrings,\n    allowedCharacters: options.allowedCharacters,\n    allowedLocales: options.allowedLocales\n  };\n}\n\nlet DocumentUnicodeHighlighter = class DocumentUnicodeHighlighter extends Disposable {\n  constructor(_editor, _options, _updateState, _editorWorkerService) {\n    super();\n    this._editor = _editor;\n    this._options = _options;\n    this._updateState = _updateState;\n    this._editorWorkerService = _editorWorkerService;\n    this._model = this._editor.getModel();\n    this._decorationIds = new Set();\n    this._updateSoon = this._register(new RunOnceScheduler(() => this._update(), 250));\n\n    this._register(this._editor.onDidChangeModelContent(() => {\n      this._updateSoon.schedule();\n    }));\n\n    this._updateSoon.schedule();\n  }\n\n  dispose() {\n    this._decorationIds = new Set(this._model.deltaDecorations(Array.from(this._decorationIds), []));\n    super.dispose();\n  }\n\n  _update() {\n    if (this._model.isDisposed()) {\n      return;\n    }\n\n    if (!this._model.mightContainNonBasicASCII()) {\n      this._decorationIds = new Set(this._editor.deltaDecorations(Array.from(this._decorationIds), []));\n      return;\n    }\n\n    const modelVersionId = this._model.getVersionId();\n\n    this._editorWorkerService.computedUnicodeHighlights(this._model.uri, this._options).then(info => {\n      if (this._model.isDisposed()) {\n        return;\n      }\n\n      if (this._model.getVersionId() !== modelVersionId) {\n        // model changed in the meantime\n        return;\n      }\n\n      this._updateState(info);\n\n      const decorations = [];\n\n      if (!info.hasMore) {\n        // Don't show decoration if there are too many.\n        // In this case, a banner is shown.\n        for (const range of info.ranges) {\n          decorations.push({\n            range: range,\n            options: Decorations.instance.getDecorationFromOptions(this._options)\n          });\n        }\n      }\n\n      this._decorationIds = new Set(this._editor.deltaDecorations(Array.from(this._decorationIds), decorations));\n    });\n  }\n\n  getDecorationInfo(decorationId) {\n    if (!this._decorationIds.has(decorationId)) {\n      return null;\n    }\n\n    const model = this._editor.getModel();\n\n    const range = model.getDecorationRange(decorationId);\n    const decoration = {\n      range: range,\n      options: Decorations.instance.getDecorationFromOptions(this._options),\n      id: decorationId,\n      ownerId: 0\n    };\n\n    if (!isModelDecorationVisible(model, decoration)) {\n      return null;\n    }\n\n    const text = model.getValueInRange(range);\n    return {\n      reason: computeReason(text, this._options),\n      inComment: isModelDecorationInComment(model, decoration),\n      inString: isModelDecorationInString(model, decoration)\n    };\n  }\n\n};\nDocumentUnicodeHighlighter = __decorate([__param(3, IEditorWorkerService)], DocumentUnicodeHighlighter);\n\nclass ViewportUnicodeHighlighter extends Disposable {\n  constructor(_editor, _options, _updateState) {\n    super();\n    this._editor = _editor;\n    this._options = _options;\n    this._updateState = _updateState;\n    this._model = this._editor.getModel();\n    this._decorationIds = new Set();\n    this._updateSoon = this._register(new RunOnceScheduler(() => this._update(), 250));\n\n    this._register(this._editor.onDidLayoutChange(() => {\n      this._updateSoon.schedule();\n    }));\n\n    this._register(this._editor.onDidScrollChange(() => {\n      this._updateSoon.schedule();\n    }));\n\n    this._register(this._editor.onDidChangeHiddenAreas(() => {\n      this._updateSoon.schedule();\n    }));\n\n    this._register(this._editor.onDidChangeModelContent(() => {\n      this._updateSoon.schedule();\n    }));\n\n    this._updateSoon.schedule();\n  }\n\n  dispose() {\n    this._decorationIds = new Set(this._model.deltaDecorations(Array.from(this._decorationIds), []));\n    super.dispose();\n  }\n\n  _update() {\n    if (this._model.isDisposed()) {\n      return;\n    }\n\n    if (!this._model.mightContainNonBasicASCII()) {\n      this._decorationIds = new Set(this._editor.deltaDecorations(Array.from(this._decorationIds), []));\n      return;\n    }\n\n    const ranges = this._editor.getVisibleRanges();\n\n    const decorations = [];\n    const totalResult = {\n      ranges: [],\n      ambiguousCharacterCount: 0,\n      invisibleCharacterCount: 0,\n      nonBasicAsciiCharacterCount: 0,\n      hasMore: false\n    };\n\n    for (const range of ranges) {\n      const result = UnicodeTextModelHighlighter.computeUnicodeHighlights(this._model, this._options, range);\n\n      for (const r of result.ranges) {\n        totalResult.ranges.push(r);\n      }\n\n      totalResult.ambiguousCharacterCount += totalResult.ambiguousCharacterCount;\n      totalResult.invisibleCharacterCount += totalResult.invisibleCharacterCount;\n      totalResult.nonBasicAsciiCharacterCount += totalResult.nonBasicAsciiCharacterCount;\n      totalResult.hasMore = totalResult.hasMore || result.hasMore;\n    }\n\n    if (!totalResult.hasMore) {\n      // Don't show decorations if there are too many.\n      // A banner will be shown instead.\n      for (const range of totalResult.ranges) {\n        decorations.push({\n          range,\n          options: Decorations.instance.getDecorationFromOptions(this._options)\n        });\n      }\n    }\n\n    this._updateState(totalResult);\n\n    this._decorationIds = new Set(this._editor.deltaDecorations(Array.from(this._decorationIds), decorations));\n  }\n\n  getDecorationInfo(decorationId) {\n    if (!this._decorationIds.has(decorationId)) {\n      return null;\n    }\n\n    const model = this._editor.getModel();\n\n    const range = model.getDecorationRange(decorationId);\n    const text = model.getValueInRange(range);\n    const decoration = {\n      range: range,\n      options: Decorations.instance.getDecorationFromOptions(this._options),\n      id: decorationId,\n      ownerId: 0\n    };\n\n    if (!isModelDecorationVisible(model, decoration)) {\n      return null;\n    }\n\n    return {\n      reason: computeReason(text, this._options),\n      inComment: isModelDecorationInComment(model, decoration),\n      inString: isModelDecorationInString(model, decoration)\n    };\n  }\n\n}\n\nlet UnicodeHighlighterHoverParticipant = class UnicodeHighlighterHoverParticipant {\n  constructor(_editor, _languageService, _openerService) {\n    this._editor = _editor;\n    this._languageService = _languageService;\n    this._openerService = _openerService;\n  }\n\n  computeSync(anchor, lineDecorations) {\n    if (!this._editor.hasModel() || anchor.type !== 1\n    /* Range */\n    ) {\n      return [];\n    }\n\n    const model = this._editor.getModel();\n\n    const unicodeHighlighter = this._editor.getContribution(UnicodeHighlighter.ID);\n\n    if (!unicodeHighlighter) {\n      return [];\n    }\n\n    const result = [];\n    let index = 300;\n\n    for (const d of lineDecorations) {\n      const highlightInfo = unicodeHighlighter.getDecorationInfo(d.id);\n\n      if (!highlightInfo) {\n        continue;\n      }\n\n      const char = model.getValueInRange(d.range); // text refers to a single character.\n\n      const codePoint = char.codePointAt(0);\n      const codePointStr = formatCodePointMarkdown(codePoint);\n      let reason;\n\n      switch (highlightInfo.reason.kind) {\n        case 0\n        /* Ambiguous */\n        :\n          reason = nls.localize('unicodeHighlight.characterIsAmbiguous', 'The character {0} could be confused with the character {1}, which is more common in source code.', codePointStr, formatCodePointMarkdown(highlightInfo.reason.confusableWith.codePointAt(0)));\n          break;\n\n        case 1\n        /* Invisible */\n        :\n          reason = nls.localize('unicodeHighlight.characterIsInvisible', 'The character {0} is invisible.', codePointStr);\n          break;\n\n        case 2\n        /* NonBasicAscii */\n        :\n          reason = nls.localize('unicodeHighlight.characterIsNonBasicAscii', 'The character {0} is not a basic ASCII character.', codePointStr);\n          break;\n      }\n\n      const adjustSettingsArgs = {\n        codePoint: codePoint,\n        reason: highlightInfo.reason,\n        inComment: highlightInfo.inComment,\n        inString: highlightInfo.inString\n      };\n      const adjustSettings = nls.localize('unicodeHighlight.adjustSettings', 'Adjust settings');\n      const contents = [{\n        value: `${reason} [${adjustSettings}](command:${ShowExcludeOptions.ID}?${encodeURIComponent(JSON.stringify(adjustSettingsArgs))})`,\n        isTrusted: true\n      }];\n      result.push(new MarkdownHover(this, d.range, contents, index++));\n    }\n\n    return result;\n  }\n\n  renderHoverParts(context, hoverParts) {\n    return renderMarkdownHovers(context, hoverParts, this._editor, this._languageService, this._openerService);\n  }\n\n};\nUnicodeHighlighterHoverParticipant = __decorate([__param(1, ILanguageService), __param(2, IOpenerService)], UnicodeHighlighterHoverParticipant);\nexport { UnicodeHighlighterHoverParticipant };\n\nfunction codePointToHex(codePoint) {\n  return `U+${codePoint.toString(16).padStart(4, '0')}`;\n}\n\nfunction formatCodePointMarkdown(codePoint) {\n  let value = `\\`${codePointToHex(codePoint)}\\``;\n\n  if (!InvisibleCharacters.isInvisibleCharacter(codePoint)) {\n    // Don't render any control characters or any invisible characters, as they cannot be seen anyways.\n    value += ` \"${`${renderCodePointAsInlineCode(codePoint)}`}\"`;\n  }\n\n  return value;\n}\n\nfunction renderCodePointAsInlineCode(codePoint) {\n  if (codePoint === 96\n  /* BackTick */\n  ) {\n    return '`` ` ``';\n  }\n\n  return '`' + String.fromCodePoint(codePoint) + '`';\n}\n\nfunction computeReason(char, options) {\n  return UnicodeTextModelHighlighter.computeUnicodeHighlightReason(char, options);\n}\n\nclass Decorations {\n  constructor() {\n    this.map = new Map();\n  }\n\n  getDecorationFromOptions(options) {\n    return this.getDecoration(!options.includeComments, !options.includeStrings);\n  }\n\n  getDecoration(hideInComments, hideInStrings) {\n    const key = `${hideInComments}${hideInStrings}`;\n    let options = this.map.get(key);\n\n    if (!options) {\n      options = ModelDecorationOptions.createDynamic({\n        description: 'unicode-highlight',\n        stickiness: 1\n        /* NeverGrowsWhenTypingAtEdges */\n        ,\n        className: 'unicode-highlight',\n        showIfCollapsed: true,\n        overviewRuler: null,\n        minimap: null,\n        hideInCommentTokens: hideInComments,\n        hideInStringTokens: hideInStrings\n      });\n      this.map.set(key, options);\n    }\n\n    return options;\n  }\n\n}\n\nDecorations.instance = new Decorations();\nexport class DisableHighlightingInCommentsAction extends EditorAction {\n  constructor() {\n    super({\n      id: DisableHighlightingOfAmbiguousCharactersAction.ID,\n      label: nls.localize('action.unicodeHighlight.disableHighlightingInComments', 'Disable highlighting of characters in comments'),\n      alias: 'Disable highlighting of characters in comments',\n      precondition: undefined\n    });\n    this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingInComments.shortLabel', 'Disable Highlight In Comments');\n  }\n\n  run(accessor, editor, args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n\n      if (configurationService) {\n        this.runAction(configurationService);\n      }\n    });\n  }\n\n  runAction(configurationService) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield configurationService.updateValue(unicodeHighlightConfigKeys.includeComments, false, 1\n      /* USER */\n      );\n    });\n  }\n\n}\nexport class DisableHighlightingInStringsAction extends EditorAction {\n  constructor() {\n    super({\n      id: DisableHighlightingOfAmbiguousCharactersAction.ID,\n      label: nls.localize('action.unicodeHighlight.disableHighlightingInStrings', 'Disable highlighting of characters in strings'),\n      alias: 'Disable highlighting of characters in strings',\n      precondition: undefined\n    });\n    this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingInStrings.shortLabel', 'Disable Highlight In Strings');\n  }\n\n  run(accessor, editor, args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n\n      if (configurationService) {\n        this.runAction(configurationService);\n      }\n    });\n  }\n\n  runAction(configurationService) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield configurationService.updateValue(unicodeHighlightConfigKeys.includeStrings, false, 1\n      /* USER */\n      );\n    });\n  }\n\n}\nexport class DisableHighlightingOfAmbiguousCharactersAction extends EditorAction {\n  constructor() {\n    super({\n      id: DisableHighlightingOfAmbiguousCharactersAction.ID,\n      label: nls.localize('action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters', 'Disable highlighting of ambiguous characters'),\n      alias: 'Disable highlighting of ambiguous characters',\n      precondition: undefined\n    });\n    this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingOfAmbiguousCharacters.shortLabel', 'Disable Ambiguous Highlight');\n  }\n\n  run(accessor, editor, args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n\n      if (configurationService) {\n        this.runAction(configurationService);\n      }\n    });\n  }\n\n  runAction(configurationService) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield configurationService.updateValue(unicodeHighlightConfigKeys.ambiguousCharacters, false, 1\n      /* USER */\n      );\n    });\n  }\n\n}\nDisableHighlightingOfAmbiguousCharactersAction.ID = 'editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters';\nexport class DisableHighlightingOfInvisibleCharactersAction extends EditorAction {\n  constructor() {\n    super({\n      id: DisableHighlightingOfInvisibleCharactersAction.ID,\n      label: nls.localize('action.unicodeHighlight.disableHighlightingOfInvisibleCharacters', 'Disable highlighting of invisible characters'),\n      alias: 'Disable highlighting of invisible characters',\n      precondition: undefined\n    });\n    this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingOfInvisibleCharacters.shortLabel', 'Disable Invisible Highlight');\n  }\n\n  run(accessor, editor, args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n\n      if (configurationService) {\n        this.runAction(configurationService);\n      }\n    });\n  }\n\n  runAction(configurationService) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield configurationService.updateValue(unicodeHighlightConfigKeys.invisibleCharacters, false, 1\n      /* USER */\n      );\n    });\n  }\n\n}\nDisableHighlightingOfInvisibleCharactersAction.ID = 'editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters';\nexport class DisableHighlightingOfNonBasicAsciiCharactersAction extends EditorAction {\n  constructor() {\n    super({\n      id: DisableHighlightingOfNonBasicAsciiCharactersAction.ID,\n      label: nls.localize('action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters', 'Disable highlighting of non basic ASCII characters'),\n      alias: 'Disable highlighting of non basic ASCII characters',\n      precondition: undefined\n    });\n    this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters.shortLabel', 'Disable Non ASCII Highlight');\n  }\n\n  run(accessor, editor, args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n\n      if (configurationService) {\n        this.runAction(configurationService);\n      }\n    });\n  }\n\n  runAction(configurationService) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield configurationService.updateValue(unicodeHighlightConfigKeys.nonBasicASCII, false, 1\n      /* USER */\n      );\n    });\n  }\n\n}\nDisableHighlightingOfNonBasicAsciiCharactersAction.ID = 'editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters';\nexport class ShowExcludeOptions extends EditorAction {\n  constructor() {\n    super({\n      id: ShowExcludeOptions.ID,\n      label: nls.localize('action.unicodeHighlight.showExcludeOptions', \"Show Exclude Options\"),\n      alias: 'Show Exclude Options',\n      precondition: undefined\n    });\n  }\n\n  run(accessor, editor, args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const {\n        codePoint,\n        reason,\n        inString,\n        inComment\n      } = args;\n      const char = String.fromCodePoint(codePoint);\n      const quickPickService = accessor.get(IQuickInputService);\n      const configurationService = accessor.get(IConfigurationService);\n\n      function getExcludeCharFromBeingHighlightedLabel(codePoint) {\n        if (InvisibleCharacters.isInvisibleCharacter(codePoint)) {\n          return nls.localize('unicodeHighlight.excludeInvisibleCharFromBeingHighlighted', 'Exclude {0} (invisible character) from being highlighted', codePointToHex(codePoint));\n        }\n\n        return nls.localize('unicodeHighlight.excludeCharFromBeingHighlighted', 'Exclude {0} from being highlighted', `${codePointToHex(codePoint)} \"${char}\"`);\n      }\n\n      const options = [];\n\n      if (reason.kind === 0\n      /* Ambiguous */\n      ) {\n        for (const locale of reason.notAmbiguousInLocales) {\n          options.push({\n            label: nls.localize(\"unicodeHighlight.allowCommonCharactersInLanguage\", \"Allow unicode characters that are more common in the language \\\"{0}\\\".\", locale),\n            run: () => __awaiter(this, void 0, void 0, function* () {\n              excludeLocaleFromBeingHighlighted(configurationService, [locale]);\n            })\n          });\n        }\n      }\n\n      options.push({\n        label: getExcludeCharFromBeingHighlightedLabel(codePoint),\n        run: () => excludeCharFromBeingHighlighted(configurationService, [codePoint])\n      });\n\n      if (inComment) {\n        const action = new DisableHighlightingInCommentsAction();\n        options.push({\n          label: action.label,\n          run: () => __awaiter(this, void 0, void 0, function* () {\n            return action.runAction(configurationService);\n          })\n        });\n      } else if (inString) {\n        const action = new DisableHighlightingInStringsAction();\n        options.push({\n          label: action.label,\n          run: () => __awaiter(this, void 0, void 0, function* () {\n            return action.runAction(configurationService);\n          })\n        });\n      }\n\n      if (reason.kind === 0\n      /* Ambiguous */\n      ) {\n        const action = new DisableHighlightingOfAmbiguousCharactersAction();\n        options.push({\n          label: action.label,\n          run: () => __awaiter(this, void 0, void 0, function* () {\n            return action.runAction(configurationService);\n          })\n        });\n      } else if (reason.kind === 1\n      /* Invisible */\n      ) {\n        const action = new DisableHighlightingOfInvisibleCharactersAction();\n        options.push({\n          label: action.label,\n          run: () => __awaiter(this, void 0, void 0, function* () {\n            return action.runAction(configurationService);\n          })\n        });\n      } else if (reason.kind === 2\n      /* NonBasicAscii */\n      ) {\n        const action = new DisableHighlightingOfNonBasicAsciiCharactersAction();\n        options.push({\n          label: action.label,\n          run: () => __awaiter(this, void 0, void 0, function* () {\n            return action.runAction(configurationService);\n          })\n        });\n      } else {\n        expectNever(reason);\n      }\n\n      const result = yield quickPickService.pick(options, {\n        title: nls.localize('unicodeHighlight.configureUnicodeHighlightOptions', 'Configure Unicode Highlight Options')\n      });\n\n      if (result) {\n        yield result.run();\n      }\n    });\n  }\n\n}\nShowExcludeOptions.ID = 'editor.action.unicodeHighlight.showExcludeOptions';\n\nfunction excludeCharFromBeingHighlighted(configurationService, charCodes) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const existingValue = configurationService.getValue(unicodeHighlightConfigKeys.allowedCharacters);\n    let value;\n\n    if (typeof existingValue === 'object' && existingValue) {\n      value = existingValue;\n    } else {\n      value = {};\n    }\n\n    for (const charCode of charCodes) {\n      value[String.fromCodePoint(charCode)] = true;\n    }\n\n    yield configurationService.updateValue(unicodeHighlightConfigKeys.allowedCharacters, value, 1\n    /* USER */\n    );\n  });\n}\n\nfunction excludeLocaleFromBeingHighlighted(configurationService, locales) {\n  var _a;\n\n  return __awaiter(this, void 0, void 0, function* () {\n    const existingValue = (_a = configurationService.inspect(unicodeHighlightConfigKeys.allowedLocales).user) === null || _a === void 0 ? void 0 : _a.value;\n    let value;\n\n    if (typeof existingValue === 'object' && existingValue) {\n      // Copy value, as the existing value is read only\n      value = Object.assign({}, existingValue);\n    } else {\n      value = {};\n    }\n\n    for (const locale of locales) {\n      value[locale] = true;\n    }\n\n    yield configurationService.updateValue(unicodeHighlightConfigKeys.allowedLocales, value, 1\n    /* USER */\n    );\n  });\n}\n\nfunction expectNever(value) {\n  throw new Error(`Unexpected value: ${value}`);\n}\n\nregisterEditorAction(DisableHighlightingOfAmbiguousCharactersAction);\nregisterEditorAction(DisableHighlightingOfInvisibleCharactersAction);\nregisterEditorAction(DisableHighlightingOfNonBasicAsciiCharactersAction);\nregisterEditorAction(ShowExcludeOptions);\nregisterEditorContribution(UnicodeHighlighter.ID, UnicodeHighlighter);","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/unicodeHighlighter/browser/unicodeHighlighter.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","RunOnceScheduler","Codicon","Disposable","platform","InvisibleCharacters","EditorAction","registerEditorAction","registerEditorContribution","inUntrustedWorkspace","unicodeHighlightConfigKeys","ModelDecorationOptions","UnicodeTextModelHighlighter","IEditorWorkerService","ILanguageService","isModelDecorationInComment","isModelDecorationInString","isModelDecorationVisible","MarkdownHover","renderMarkdownHovers","BannerController","nls","IConfigurationService","IInstantiationService","IOpenerService","IQuickInputService","registerIcon","IWorkspaceTrustManagementService","warningIcon","warning","localize","UnicodeHighlighter","constructor","_editor","_editorWorkerService","_workspaceTrustService","instantiationService","_highlighter","_bannerClosed","_updateState","state","hasMore","max","Math","ambiguousCharacterCount","nonBasicAsciiCharacterCount","invisibleCharacterCount","data","message","command","DisableHighlightingOfNonBasicAsciiCharactersAction","DisableHighlightingOfAmbiguousCharactersAction","DisableHighlightingOfInvisibleCharactersAction","Error","_bannerController","show","id","icon","actions","label","shortLabel","href","onClose","hide","_register","createInstance","onDidChangeModel","_updateHighlighter","_options","getOption","onDidChangeTrust","onDidChangeConfiguration","hasChanged","dispose","hasModel","options","resolveOptions","isWorkspaceTrusted","nonBasicASCII","ambiguousCharacters","invisibleCharacters","every","option","highlightOptions","includeComments","includeStrings","allowedCodePoints","keys","allowedCharacters","map","codePointAt","allowedLocales","locale","osLocale","Intl","NumberFormat","resolvedOptions","language","canComputeUnicodeHighlights","getModel","uri","DocumentUnicodeHighlighter","ViewportUnicodeHighlighter","getDecorationInfo","decorationId","ID","trusted","_model","_decorationIds","Set","_updateSoon","_update","onDidChangeModelContent","schedule","deltaDecorations","Array","from","isDisposed","mightContainNonBasicASCII","modelVersionId","getVersionId","computedUnicodeHighlights","info","decorations","range","ranges","push","Decorations","instance","getDecorationFromOptions","has","model","getDecorationRange","decoration","ownerId","text","getValueInRange","reason","computeReason","inComment","inString","onDidLayoutChange","onDidScrollChange","onDidChangeHiddenAreas","getVisibleRanges","totalResult","computeUnicodeHighlights","UnicodeHighlighterHoverParticipant","_languageService","_openerService","computeSync","anchor","lineDecorations","type","unicodeHighlighter","getContribution","index","highlightInfo","char","codePoint","codePointStr","formatCodePointMarkdown","kind","confusableWith","adjustSettingsArgs","adjustSettings","contents","ShowExcludeOptions","encodeURIComponent","JSON","stringify","isTrusted","renderHoverParts","context","hoverParts","codePointToHex","toString","padStart","isInvisibleCharacter","renderCodePointAsInlineCode","String","fromCodePoint","computeUnicodeHighlightReason","Map","getDecoration","hideInComments","hideInStrings","get","createDynamic","description","stickiness","className","showIfCollapsed","overviewRuler","minimap","hideInCommentTokens","hideInStringTokens","set","DisableHighlightingInCommentsAction","alias","precondition","undefined","run","accessor","editor","args","configurationService","runAction","updateValue","DisableHighlightingInStringsAction","quickPickService","getExcludeCharFromBeingHighlightedLabel","notAmbiguousInLocales","excludeLocaleFromBeingHighlighted","excludeCharFromBeingHighlighted","action","expectNever","pick","title","charCodes","existingValue","getValue","charCode","locales","_a","inspect","user","assign"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport { InvisibleCharacters } from '../../../../base/common/strings.js';\nimport './unicodeHighlighter.css';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { inUntrustedWorkspace, unicodeHighlightConfigKeys } from '../../../common/config/editorOptions.js';\nimport { ModelDecorationOptions } from '../../../common/model/textModel.js';\nimport { UnicodeTextModelHighlighter } from '../../../common/languages/unicodeTextModelHighlighter.js';\nimport { IEditorWorkerService } from '../../../common/services/editorWorker.js';\nimport { ILanguageService } from '../../../common/services/language.js';\nimport { isModelDecorationInComment, isModelDecorationInString, isModelDecorationVisible } from '../../../common/viewModel/viewModelDecorations.js';\nimport { MarkdownHover, renderMarkdownHovers } from '../../hover/browser/markdownHoverParticipant.js';\nimport { BannerController } from './bannerController.js';\nimport * as nls from '../../../../nls.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { registerIcon } from '../../../../platform/theme/common/iconRegistry.js';\nimport { IWorkspaceTrustManagementService } from '../../../../platform/workspace/common/workspaceTrust.js';\nexport const warningIcon = registerIcon('extensions-warning-message', Codicon.warning, nls.localize('warningIcon', 'Icon shown with a warning message in the extensions editor.'));\nlet UnicodeHighlighter = class UnicodeHighlighter extends Disposable {\n    constructor(_editor, _editorWorkerService, _workspaceTrustService, instantiationService) {\n        super();\n        this._editor = _editor;\n        this._editorWorkerService = _editorWorkerService;\n        this._workspaceTrustService = _workspaceTrustService;\n        this._highlighter = null;\n        this._bannerClosed = false;\n        this._updateState = (state) => {\n            if (state && state.hasMore) {\n                if (this._bannerClosed) {\n                    return;\n                }\n                // This document contains many non-basic ASCII characters.\n                const max = Math.max(state.ambiguousCharacterCount, state.nonBasicAsciiCharacterCount, state.invisibleCharacterCount);\n                let data;\n                if (state.nonBasicAsciiCharacterCount >= max) {\n                    data = {\n                        message: nls.localize('unicodeHighlighting.thisDocumentHasManyNonBasicAsciiUnicodeCharacters', 'This document contains many non-basic ASCII unicode characters'),\n                        command: new DisableHighlightingOfNonBasicAsciiCharactersAction(),\n                    };\n                }\n                else if (state.ambiguousCharacterCount >= max) {\n                    data = {\n                        message: nls.localize('unicodeHighlighting.thisDocumentHasManyAmbiguousUnicodeCharacters', 'This document contains many ambiguous unicode characters'),\n                        command: new DisableHighlightingOfAmbiguousCharactersAction(),\n                    };\n                }\n                else if (state.invisibleCharacterCount >= max) {\n                    data = {\n                        message: nls.localize('unicodeHighlighting.thisDocumentHasManyInvisibleUnicodeCharacters', 'This document contains many invisible unicode characters'),\n                        command: new DisableHighlightingOfInvisibleCharactersAction(),\n                    };\n                }\n                else {\n                    throw new Error('Unreachable');\n                }\n                this._bannerController.show({\n                    id: 'unicodeHighlightBanner',\n                    message: data.message,\n                    icon: warningIcon,\n                    actions: [\n                        {\n                            label: data.command.shortLabel,\n                            href: `command:${data.command.id}`\n                        }\n                    ],\n                    onClose: () => {\n                        this._bannerClosed = true;\n                    },\n                });\n            }\n            else {\n                this._bannerController.hide();\n            }\n        };\n        this._bannerController = this._register(instantiationService.createInstance(BannerController, _editor));\n        this._register(this._editor.onDidChangeModel(() => {\n            this._bannerClosed = false;\n            this._updateHighlighter();\n        }));\n        this._options = _editor.getOption(113 /* unicodeHighlighting */);\n        this._register(_workspaceTrustService.onDidChangeTrust(e => {\n            this._updateHighlighter();\n        }));\n        this._register(_editor.onDidChangeConfiguration(e => {\n            if (e.hasChanged(113 /* unicodeHighlighting */)) {\n                this._options = _editor.getOption(113 /* unicodeHighlighting */);\n                this._updateHighlighter();\n            }\n        }));\n        this._updateHighlighter();\n    }\n    dispose() {\n        if (this._highlighter) {\n            this._highlighter.dispose();\n            this._highlighter = null;\n        }\n        super.dispose();\n    }\n    _updateHighlighter() {\n        this._updateState(null);\n        if (this._highlighter) {\n            this._highlighter.dispose();\n            this._highlighter = null;\n        }\n        if (!this._editor.hasModel()) {\n            return;\n        }\n        const options = resolveOptions(this._workspaceTrustService.isWorkspaceTrusted(), this._options);\n        if ([\n            options.nonBasicASCII,\n            options.ambiguousCharacters,\n            options.invisibleCharacters,\n        ].every((option) => option === false)) {\n            // Don't do anything if the feature is fully disabled\n            return;\n        }\n        const highlightOptions = {\n            nonBasicASCII: options.nonBasicASCII,\n            ambiguousCharacters: options.ambiguousCharacters,\n            invisibleCharacters: options.invisibleCharacters,\n            includeComments: options.includeComments,\n            includeStrings: options.includeStrings,\n            allowedCodePoints: Object.keys(options.allowedCharacters).map(c => c.codePointAt(0)),\n            allowedLocales: Object.keys(options.allowedLocales).map(locale => {\n                if (locale === '_os') {\n                    let osLocale = new Intl.NumberFormat().resolvedOptions().locale;\n                    return osLocale;\n                }\n                else if (locale === '_vscode') {\n                    return platform.language;\n                }\n                return locale;\n            }),\n        };\n        if (this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)) {\n            this._highlighter = new DocumentUnicodeHighlighter(this._editor, highlightOptions, this._updateState, this._editorWorkerService);\n        }\n        else {\n            this._highlighter = new ViewportUnicodeHighlighter(this._editor, highlightOptions, this._updateState);\n        }\n    }\n    getDecorationInfo(decorationId) {\n        if (this._highlighter) {\n            return this._highlighter.getDecorationInfo(decorationId);\n        }\n        return null;\n    }\n};\nUnicodeHighlighter.ID = 'editor.contrib.unicodeHighlighter';\nUnicodeHighlighter = __decorate([\n    __param(1, IEditorWorkerService),\n    __param(2, IWorkspaceTrustManagementService),\n    __param(3, IInstantiationService)\n], UnicodeHighlighter);\nexport { UnicodeHighlighter };\nfunction resolveOptions(trusted, options) {\n    return {\n        nonBasicASCII: options.nonBasicASCII === inUntrustedWorkspace ? !trusted : options.nonBasicASCII,\n        ambiguousCharacters: options.ambiguousCharacters,\n        invisibleCharacters: options.invisibleCharacters,\n        includeComments: options.includeComments === inUntrustedWorkspace ? !trusted : options.includeComments,\n        includeStrings: options.includeStrings === inUntrustedWorkspace ? !trusted : options.includeStrings,\n        allowedCharacters: options.allowedCharacters,\n        allowedLocales: options.allowedLocales,\n    };\n}\nlet DocumentUnicodeHighlighter = class DocumentUnicodeHighlighter extends Disposable {\n    constructor(_editor, _options, _updateState, _editorWorkerService) {\n        super();\n        this._editor = _editor;\n        this._options = _options;\n        this._updateState = _updateState;\n        this._editorWorkerService = _editorWorkerService;\n        this._model = this._editor.getModel();\n        this._decorationIds = new Set();\n        this._updateSoon = this._register(new RunOnceScheduler(() => this._update(), 250));\n        this._register(this._editor.onDidChangeModelContent(() => {\n            this._updateSoon.schedule();\n        }));\n        this._updateSoon.schedule();\n    }\n    dispose() {\n        this._decorationIds = new Set(this._model.deltaDecorations(Array.from(this._decorationIds), []));\n        super.dispose();\n    }\n    _update() {\n        if (this._model.isDisposed()) {\n            return;\n        }\n        if (!this._model.mightContainNonBasicASCII()) {\n            this._decorationIds = new Set(this._editor.deltaDecorations(Array.from(this._decorationIds), []));\n            return;\n        }\n        const modelVersionId = this._model.getVersionId();\n        this._editorWorkerService\n            .computedUnicodeHighlights(this._model.uri, this._options)\n            .then((info) => {\n            if (this._model.isDisposed()) {\n                return;\n            }\n            if (this._model.getVersionId() !== modelVersionId) {\n                // model changed in the meantime\n                return;\n            }\n            this._updateState(info);\n            const decorations = [];\n            if (!info.hasMore) {\n                // Don't show decoration if there are too many.\n                // In this case, a banner is shown.\n                for (const range of info.ranges) {\n                    decorations.push({\n                        range: range,\n                        options: Decorations.instance.getDecorationFromOptions(this._options),\n                    });\n                }\n            }\n            this._decorationIds = new Set(this._editor.deltaDecorations(Array.from(this._decorationIds), decorations));\n        });\n    }\n    getDecorationInfo(decorationId) {\n        if (!this._decorationIds.has(decorationId)) {\n            return null;\n        }\n        const model = this._editor.getModel();\n        const range = model.getDecorationRange(decorationId);\n        const decoration = {\n            range: range,\n            options: Decorations.instance.getDecorationFromOptions(this._options),\n            id: decorationId,\n            ownerId: 0,\n        };\n        if (!isModelDecorationVisible(model, decoration)) {\n            return null;\n        }\n        const text = model.getValueInRange(range);\n        return {\n            reason: computeReason(text, this._options),\n            inComment: isModelDecorationInComment(model, decoration),\n            inString: isModelDecorationInString(model, decoration),\n        };\n    }\n};\nDocumentUnicodeHighlighter = __decorate([\n    __param(3, IEditorWorkerService)\n], DocumentUnicodeHighlighter);\nclass ViewportUnicodeHighlighter extends Disposable {\n    constructor(_editor, _options, _updateState) {\n        super();\n        this._editor = _editor;\n        this._options = _options;\n        this._updateState = _updateState;\n        this._model = this._editor.getModel();\n        this._decorationIds = new Set();\n        this._updateSoon = this._register(new RunOnceScheduler(() => this._update(), 250));\n        this._register(this._editor.onDidLayoutChange(() => {\n            this._updateSoon.schedule();\n        }));\n        this._register(this._editor.onDidScrollChange(() => {\n            this._updateSoon.schedule();\n        }));\n        this._register(this._editor.onDidChangeHiddenAreas(() => {\n            this._updateSoon.schedule();\n        }));\n        this._register(this._editor.onDidChangeModelContent(() => {\n            this._updateSoon.schedule();\n        }));\n        this._updateSoon.schedule();\n    }\n    dispose() {\n        this._decorationIds = new Set(this._model.deltaDecorations(Array.from(this._decorationIds), []));\n        super.dispose();\n    }\n    _update() {\n        if (this._model.isDisposed()) {\n            return;\n        }\n        if (!this._model.mightContainNonBasicASCII()) {\n            this._decorationIds = new Set(this._editor.deltaDecorations(Array.from(this._decorationIds), []));\n            return;\n        }\n        const ranges = this._editor.getVisibleRanges();\n        const decorations = [];\n        const totalResult = {\n            ranges: [],\n            ambiguousCharacterCount: 0,\n            invisibleCharacterCount: 0,\n            nonBasicAsciiCharacterCount: 0,\n            hasMore: false,\n        };\n        for (const range of ranges) {\n            const result = UnicodeTextModelHighlighter.computeUnicodeHighlights(this._model, this._options, range);\n            for (const r of result.ranges) {\n                totalResult.ranges.push(r);\n            }\n            totalResult.ambiguousCharacterCount += totalResult.ambiguousCharacterCount;\n            totalResult.invisibleCharacterCount += totalResult.invisibleCharacterCount;\n            totalResult.nonBasicAsciiCharacterCount += totalResult.nonBasicAsciiCharacterCount;\n            totalResult.hasMore = totalResult.hasMore || result.hasMore;\n        }\n        if (!totalResult.hasMore) {\n            // Don't show decorations if there are too many.\n            // A banner will be shown instead.\n            for (const range of totalResult.ranges) {\n                decorations.push({ range, options: Decorations.instance.getDecorationFromOptions(this._options) });\n            }\n        }\n        this._updateState(totalResult);\n        this._decorationIds = new Set(this._editor.deltaDecorations(Array.from(this._decorationIds), decorations));\n    }\n    getDecorationInfo(decorationId) {\n        if (!this._decorationIds.has(decorationId)) {\n            return null;\n        }\n        const model = this._editor.getModel();\n        const range = model.getDecorationRange(decorationId);\n        const text = model.getValueInRange(range);\n        const decoration = {\n            range: range,\n            options: Decorations.instance.getDecorationFromOptions(this._options),\n            id: decorationId,\n            ownerId: 0,\n        };\n        if (!isModelDecorationVisible(model, decoration)) {\n            return null;\n        }\n        return {\n            reason: computeReason(text, this._options),\n            inComment: isModelDecorationInComment(model, decoration),\n            inString: isModelDecorationInString(model, decoration),\n        };\n    }\n}\nlet UnicodeHighlighterHoverParticipant = class UnicodeHighlighterHoverParticipant {\n    constructor(_editor, _languageService, _openerService) {\n        this._editor = _editor;\n        this._languageService = _languageService;\n        this._openerService = _openerService;\n    }\n    computeSync(anchor, lineDecorations) {\n        if (!this._editor.hasModel() || anchor.type !== 1 /* Range */) {\n            return [];\n        }\n        const model = this._editor.getModel();\n        const unicodeHighlighter = this._editor.getContribution(UnicodeHighlighter.ID);\n        if (!unicodeHighlighter) {\n            return [];\n        }\n        const result = [];\n        let index = 300;\n        for (const d of lineDecorations) {\n            const highlightInfo = unicodeHighlighter.getDecorationInfo(d.id);\n            if (!highlightInfo) {\n                continue;\n            }\n            const char = model.getValueInRange(d.range);\n            // text refers to a single character.\n            const codePoint = char.codePointAt(0);\n            const codePointStr = formatCodePointMarkdown(codePoint);\n            let reason;\n            switch (highlightInfo.reason.kind) {\n                case 0 /* Ambiguous */:\n                    reason = nls.localize('unicodeHighlight.characterIsAmbiguous', 'The character {0} could be confused with the character {1}, which is more common in source code.', codePointStr, formatCodePointMarkdown(highlightInfo.reason.confusableWith.codePointAt(0)));\n                    break;\n                case 1 /* Invisible */:\n                    reason = nls.localize('unicodeHighlight.characterIsInvisible', 'The character {0} is invisible.', codePointStr);\n                    break;\n                case 2 /* NonBasicAscii */:\n                    reason = nls.localize('unicodeHighlight.characterIsNonBasicAscii', 'The character {0} is not a basic ASCII character.', codePointStr);\n                    break;\n            }\n            const adjustSettingsArgs = {\n                codePoint: codePoint,\n                reason: highlightInfo.reason,\n                inComment: highlightInfo.inComment,\n                inString: highlightInfo.inString,\n            };\n            const adjustSettings = nls.localize('unicodeHighlight.adjustSettings', 'Adjust settings');\n            const contents = [{\n                    value: `${reason} [${adjustSettings}](command:${ShowExcludeOptions.ID}?${encodeURIComponent(JSON.stringify(adjustSettingsArgs))})`,\n                    isTrusted: true,\n                }];\n            result.push(new MarkdownHover(this, d.range, contents, index++));\n        }\n        return result;\n    }\n    renderHoverParts(context, hoverParts) {\n        return renderMarkdownHovers(context, hoverParts, this._editor, this._languageService, this._openerService);\n    }\n};\nUnicodeHighlighterHoverParticipant = __decorate([\n    __param(1, ILanguageService),\n    __param(2, IOpenerService)\n], UnicodeHighlighterHoverParticipant);\nexport { UnicodeHighlighterHoverParticipant };\nfunction codePointToHex(codePoint) {\n    return `U+${codePoint.toString(16).padStart(4, '0')}`;\n}\nfunction formatCodePointMarkdown(codePoint) {\n    let value = `\\`${codePointToHex(codePoint)}\\``;\n    if (!InvisibleCharacters.isInvisibleCharacter(codePoint)) {\n        // Don't render any control characters or any invisible characters, as they cannot be seen anyways.\n        value += ` \"${`${renderCodePointAsInlineCode(codePoint)}`}\"`;\n    }\n    return value;\n}\nfunction renderCodePointAsInlineCode(codePoint) {\n    if (codePoint === 96 /* BackTick */) {\n        return '`` ` ``';\n    }\n    return '`' + String.fromCodePoint(codePoint) + '`';\n}\nfunction computeReason(char, options) {\n    return UnicodeTextModelHighlighter.computeUnicodeHighlightReason(char, options);\n}\nclass Decorations {\n    constructor() {\n        this.map = new Map();\n    }\n    getDecorationFromOptions(options) {\n        return this.getDecoration(!options.includeComments, !options.includeStrings);\n    }\n    getDecoration(hideInComments, hideInStrings) {\n        const key = `${hideInComments}${hideInStrings}`;\n        let options = this.map.get(key);\n        if (!options) {\n            options = ModelDecorationOptions.createDynamic({\n                description: 'unicode-highlight',\n                stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\n                className: 'unicode-highlight',\n                showIfCollapsed: true,\n                overviewRuler: null,\n                minimap: null,\n                hideInCommentTokens: hideInComments,\n                hideInStringTokens: hideInStrings,\n            });\n            this.map.set(key, options);\n        }\n        return options;\n    }\n}\nDecorations.instance = new Decorations();\nexport class DisableHighlightingInCommentsAction extends EditorAction {\n    constructor() {\n        super({\n            id: DisableHighlightingOfAmbiguousCharactersAction.ID,\n            label: nls.localize('action.unicodeHighlight.disableHighlightingInComments', 'Disable highlighting of characters in comments'),\n            alias: 'Disable highlighting of characters in comments',\n            precondition: undefined\n        });\n        this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingInComments.shortLabel', 'Disable Highlight In Comments');\n    }\n    run(accessor, editor, args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n            if (configurationService) {\n                this.runAction(configurationService);\n            }\n        });\n    }\n    runAction(configurationService) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield configurationService.updateValue(unicodeHighlightConfigKeys.includeComments, false, 1 /* USER */);\n        });\n    }\n}\nexport class DisableHighlightingInStringsAction extends EditorAction {\n    constructor() {\n        super({\n            id: DisableHighlightingOfAmbiguousCharactersAction.ID,\n            label: nls.localize('action.unicodeHighlight.disableHighlightingInStrings', 'Disable highlighting of characters in strings'),\n            alias: 'Disable highlighting of characters in strings',\n            precondition: undefined\n        });\n        this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingInStrings.shortLabel', 'Disable Highlight In Strings');\n    }\n    run(accessor, editor, args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n            if (configurationService) {\n                this.runAction(configurationService);\n            }\n        });\n    }\n    runAction(configurationService) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield configurationService.updateValue(unicodeHighlightConfigKeys.includeStrings, false, 1 /* USER */);\n        });\n    }\n}\nexport class DisableHighlightingOfAmbiguousCharactersAction extends EditorAction {\n    constructor() {\n        super({\n            id: DisableHighlightingOfAmbiguousCharactersAction.ID,\n            label: nls.localize('action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters', 'Disable highlighting of ambiguous characters'),\n            alias: 'Disable highlighting of ambiguous characters',\n            precondition: undefined\n        });\n        this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingOfAmbiguousCharacters.shortLabel', 'Disable Ambiguous Highlight');\n    }\n    run(accessor, editor, args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n            if (configurationService) {\n                this.runAction(configurationService);\n            }\n        });\n    }\n    runAction(configurationService) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield configurationService.updateValue(unicodeHighlightConfigKeys.ambiguousCharacters, false, 1 /* USER */);\n        });\n    }\n}\nDisableHighlightingOfAmbiguousCharactersAction.ID = 'editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters';\nexport class DisableHighlightingOfInvisibleCharactersAction extends EditorAction {\n    constructor() {\n        super({\n            id: DisableHighlightingOfInvisibleCharactersAction.ID,\n            label: nls.localize('action.unicodeHighlight.disableHighlightingOfInvisibleCharacters', 'Disable highlighting of invisible characters'),\n            alias: 'Disable highlighting of invisible characters',\n            precondition: undefined\n        });\n        this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingOfInvisibleCharacters.shortLabel', 'Disable Invisible Highlight');\n    }\n    run(accessor, editor, args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n            if (configurationService) {\n                this.runAction(configurationService);\n            }\n        });\n    }\n    runAction(configurationService) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield configurationService.updateValue(unicodeHighlightConfigKeys.invisibleCharacters, false, 1 /* USER */);\n        });\n    }\n}\nDisableHighlightingOfInvisibleCharactersAction.ID = 'editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters';\nexport class DisableHighlightingOfNonBasicAsciiCharactersAction extends EditorAction {\n    constructor() {\n        super({\n            id: DisableHighlightingOfNonBasicAsciiCharactersAction.ID,\n            label: nls.localize('action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters', 'Disable highlighting of non basic ASCII characters'),\n            alias: 'Disable highlighting of non basic ASCII characters',\n            precondition: undefined\n        });\n        this.shortLabel = nls.localize('unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters.shortLabel', 'Disable Non ASCII Highlight');\n    }\n    run(accessor, editor, args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let configurationService = accessor === null || accessor === void 0 ? void 0 : accessor.get(IConfigurationService);\n            if (configurationService) {\n                this.runAction(configurationService);\n            }\n        });\n    }\n    runAction(configurationService) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield configurationService.updateValue(unicodeHighlightConfigKeys.nonBasicASCII, false, 1 /* USER */);\n        });\n    }\n}\nDisableHighlightingOfNonBasicAsciiCharactersAction.ID = 'editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters';\nexport class ShowExcludeOptions extends EditorAction {\n    constructor() {\n        super({\n            id: ShowExcludeOptions.ID,\n            label: nls.localize('action.unicodeHighlight.showExcludeOptions', \"Show Exclude Options\"),\n            alias: 'Show Exclude Options',\n            precondition: undefined\n        });\n    }\n    run(accessor, editor, args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { codePoint, reason, inString, inComment } = args;\n            const char = String.fromCodePoint(codePoint);\n            const quickPickService = accessor.get(IQuickInputService);\n            const configurationService = accessor.get(IConfigurationService);\n            function getExcludeCharFromBeingHighlightedLabel(codePoint) {\n                if (InvisibleCharacters.isInvisibleCharacter(codePoint)) {\n                    return nls.localize('unicodeHighlight.excludeInvisibleCharFromBeingHighlighted', 'Exclude {0} (invisible character) from being highlighted', codePointToHex(codePoint));\n                }\n                return nls.localize('unicodeHighlight.excludeCharFromBeingHighlighted', 'Exclude {0} from being highlighted', `${codePointToHex(codePoint)} \"${char}\"`);\n            }\n            const options = [];\n            if (reason.kind === 0 /* Ambiguous */) {\n                for (const locale of reason.notAmbiguousInLocales) {\n                    options.push({\n                        label: nls.localize(\"unicodeHighlight.allowCommonCharactersInLanguage\", \"Allow unicode characters that are more common in the language \\\"{0}\\\".\", locale),\n                        run: () => __awaiter(this, void 0, void 0, function* () {\n                            excludeLocaleFromBeingHighlighted(configurationService, [locale]);\n                        }),\n                    });\n                }\n            }\n            options.push({\n                label: getExcludeCharFromBeingHighlightedLabel(codePoint),\n                run: () => excludeCharFromBeingHighlighted(configurationService, [codePoint])\n            });\n            if (inComment) {\n                const action = new DisableHighlightingInCommentsAction();\n                options.push({ label: action.label, run: () => __awaiter(this, void 0, void 0, function* () { return action.runAction(configurationService); }) });\n            }\n            else if (inString) {\n                const action = new DisableHighlightingInStringsAction();\n                options.push({ label: action.label, run: () => __awaiter(this, void 0, void 0, function* () { return action.runAction(configurationService); }) });\n            }\n            if (reason.kind === 0 /* Ambiguous */) {\n                const action = new DisableHighlightingOfAmbiguousCharactersAction();\n                options.push({ label: action.label, run: () => __awaiter(this, void 0, void 0, function* () { return action.runAction(configurationService); }) });\n            }\n            else if (reason.kind === 1 /* Invisible */) {\n                const action = new DisableHighlightingOfInvisibleCharactersAction();\n                options.push({ label: action.label, run: () => __awaiter(this, void 0, void 0, function* () { return action.runAction(configurationService); }) });\n            }\n            else if (reason.kind === 2 /* NonBasicAscii */) {\n                const action = new DisableHighlightingOfNonBasicAsciiCharactersAction();\n                options.push({ label: action.label, run: () => __awaiter(this, void 0, void 0, function* () { return action.runAction(configurationService); }) });\n            }\n            else {\n                expectNever(reason);\n            }\n            const result = yield quickPickService.pick(options, { title: nls.localize('unicodeHighlight.configureUnicodeHighlightOptions', 'Configure Unicode Highlight Options') });\n            if (result) {\n                yield result.run();\n            }\n        });\n    }\n}\nShowExcludeOptions.ID = 'editor.action.unicodeHighlight.showExcludeOptions';\nfunction excludeCharFromBeingHighlighted(configurationService, charCodes) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const existingValue = configurationService.getValue(unicodeHighlightConfigKeys.allowedCharacters);\n        let value;\n        if ((typeof existingValue === 'object') && existingValue) {\n            value = existingValue;\n        }\n        else {\n            value = {};\n        }\n        for (const charCode of charCodes) {\n            value[String.fromCodePoint(charCode)] = true;\n        }\n        yield configurationService.updateValue(unicodeHighlightConfigKeys.allowedCharacters, value, 1 /* USER */);\n    });\n}\nfunction excludeLocaleFromBeingHighlighted(configurationService, locales) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function* () {\n        const existingValue = (_a = configurationService.inspect(unicodeHighlightConfigKeys.allowedLocales).user) === null || _a === void 0 ? void 0 : _a.value;\n        let value;\n        if ((typeof existingValue === 'object') && existingValue) {\n            // Copy value, as the existing value is read only\n            value = Object.assign({}, existingValue);\n        }\n        else {\n            value = {};\n        }\n        for (const locale of locales) {\n            value[locale] = true;\n        }\n        yield configurationService.updateValue(unicodeHighlightConfigKeys.allowedLocales, value, 1 /* USER */);\n    });\n}\nfunction expectNever(value) {\n    throw new Error(`Unexpected value: ${value}`);\n}\nregisterEditorAction(DisableHighlightingOfAmbiguousCharactersAction);\nregisterEditorAction(DisableHighlightingOfInvisibleCharactersAction);\nregisterEditorAction(DisableHighlightingOfNonBasicAsciiCharactersAction);\nregisterEditorAction(ShowExcludeOptions);\nregisterEditorContribution(UnicodeHighlighter.ID, UnicodeHighlighter);\n"]},"metadata":{},"sourceType":"module"}