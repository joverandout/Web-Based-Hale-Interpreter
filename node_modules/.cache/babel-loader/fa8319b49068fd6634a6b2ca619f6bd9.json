{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { GlobalMouseMoveMonitor, standardMouseMoveMerger } from '../../../../base/browser/globalMouseMoveMonitor.js';\nimport { Gesture } from '../../../../base/browser/touch.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport './lightBulbWidget.css';\nimport { computeIndentLevel } from '../../../common/model/utils.js';\nimport * as nls from '../../../../nls.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { editorBackground, editorLightBulbAutoFixForeground, editorLightBulbForeground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\nvar LightBulbState;\n\n(function (LightBulbState) {\n  LightBulbState.Hidden = {\n    type: 0\n    /* Hidden */\n\n  };\n\n  class Showing {\n    constructor(actions, trigger, editorPosition, widgetPosition) {\n      this.actions = actions;\n      this.trigger = trigger;\n      this.editorPosition = editorPosition;\n      this.widgetPosition = widgetPosition;\n      this.type = 1\n      /* Showing */\n      ;\n    }\n\n  }\n\n  LightBulbState.Showing = Showing;\n})(LightBulbState || (LightBulbState = {}));\n\nlet LightBulbWidget = class LightBulbWidget extends Disposable {\n  constructor(_editor, _quickFixActionId, _preferredFixActionId, _keybindingService) {\n    super();\n    this._editor = _editor;\n    this._quickFixActionId = _quickFixActionId;\n    this._preferredFixActionId = _preferredFixActionId;\n    this._keybindingService = _keybindingService;\n    this._onClick = this._register(new Emitter());\n    this.onClick = this._onClick.event;\n    this._state = LightBulbState.Hidden;\n    this._domNode = document.createElement('div');\n    this._domNode.className = Codicon.lightBulb.classNames;\n\n    this._editor.addContentWidget(this);\n\n    this._register(this._editor.onDidChangeModelContent(_ => {\n      // cancel when the line in question has been removed\n      const editorModel = this._editor.getModel();\n\n      if (this.state.type !== 1\n      /* Showing */\n      || !editorModel || this.state.editorPosition.lineNumber >= editorModel.getLineCount()) {\n        this.hide();\n      }\n    }));\n\n    Gesture.ignoreTarget(this._domNode);\n\n    this._register(dom.addStandardDisposableGenericMouseDownListner(this._domNode, e => {\n      if (this.state.type !== 1\n      /* Showing */\n      ) {\n        return;\n      } // Make sure that focus / cursor location is not lost when clicking widget icon\n\n\n      this._editor.focus();\n\n      e.preventDefault(); // a bit of extra work to make sure the menu\n      // doesn't cover the line-text\n\n      const {\n        top,\n        height\n      } = dom.getDomNodePagePosition(this._domNode);\n\n      const lineHeight = this._editor.getOption(59\n      /* lineHeight */\n      );\n\n      let pad = Math.floor(lineHeight / 3);\n\n      if (this.state.widgetPosition.position !== null && this.state.widgetPosition.position.lineNumber < this.state.editorPosition.lineNumber) {\n        pad += lineHeight;\n      }\n\n      this._onClick.fire({\n        x: e.posx,\n        y: top + height + pad,\n        actions: this.state.actions,\n        trigger: this.state.trigger\n      });\n    }));\n\n    this._register(dom.addDisposableListener(this._domNode, 'mouseenter', e => {\n      if ((e.buttons & 1) !== 1) {\n        return;\n      } // mouse enters lightbulb while the primary/left button\n      // is being pressed -> hide the lightbulb and block future\n      // showings until mouse is released\n\n\n      this.hide();\n      const monitor = new GlobalMouseMoveMonitor();\n      monitor.startMonitoring(e.target, e.buttons, standardMouseMoveMerger, () => {}, () => {\n        monitor.dispose();\n      });\n    }));\n\n    this._register(this._editor.onDidChangeConfiguration(e => {\n      // hide when told to do so\n      if (e.hasChanged(57\n      /* lightbulb */\n      ) && !this._editor.getOption(57\n      /* lightbulb */\n      ).enabled) {\n        this.hide();\n      }\n    }));\n\n    this._updateLightBulbTitleAndIcon();\n\n    this._register(this._keybindingService.onDidUpdateKeybindings(this._updateLightBulbTitleAndIcon, this));\n  }\n\n  dispose() {\n    super.dispose();\n\n    this._editor.removeContentWidget(this);\n  }\n\n  getId() {\n    return 'LightBulbWidget';\n  }\n\n  getDomNode() {\n    return this._domNode;\n  }\n\n  getPosition() {\n    return this._state.type === 1\n    /* Showing */\n    ? this._state.widgetPosition : null;\n  }\n\n  update(actions, trigger, atPosition) {\n    if (actions.validActions.length <= 0) {\n      return this.hide();\n    }\n\n    const options = this._editor.getOptions();\n\n    if (!options.get(57\n    /* lightbulb */\n    ).enabled) {\n      return this.hide();\n    }\n\n    const model = this._editor.getModel();\n\n    if (!model) {\n      return this.hide();\n    }\n\n    const {\n      lineNumber,\n      column\n    } = model.validatePosition(atPosition);\n    const tabSize = model.getOptions().tabSize;\n    const fontInfo = options.get(44\n    /* fontInfo */\n    );\n    const lineContent = model.getLineContent(lineNumber);\n    const indent = computeIndentLevel(lineContent, tabSize);\n    const lineHasSpace = fontInfo.spaceWidth * indent > 22;\n\n    const isFolded = lineNumber => {\n      return lineNumber > 2 && this._editor.getTopForLineNumber(lineNumber) === this._editor.getTopForLineNumber(lineNumber - 1);\n    };\n\n    let effectiveLineNumber = lineNumber;\n\n    if (!lineHasSpace) {\n      if (lineNumber > 1 && !isFolded(lineNumber - 1)) {\n        effectiveLineNumber -= 1;\n      } else if (!isFolded(lineNumber + 1)) {\n        effectiveLineNumber += 1;\n      } else if (column * fontInfo.spaceWidth < 22) {\n        // cannot show lightbulb above/below and showing\n        // it inline would overlay the cursor...\n        return this.hide();\n      }\n    }\n\n    this.state = new LightBulbState.Showing(actions, trigger, atPosition, {\n      position: {\n        lineNumber: effectiveLineNumber,\n        column: 1\n      },\n      preference: LightBulbWidget._posPref\n    });\n\n    this._editor.layoutContentWidget(this);\n  }\n\n  hide() {\n    this.state = LightBulbState.Hidden;\n\n    this._editor.layoutContentWidget(this);\n  }\n\n  get state() {\n    return this._state;\n  }\n\n  set state(value) {\n    this._state = value;\n\n    this._updateLightBulbTitleAndIcon();\n  }\n\n  _updateLightBulbTitleAndIcon() {\n    if (this.state.type === 1\n    /* Showing */\n    && this.state.actions.hasAutoFix) {\n      // update icon\n      this._domNode.classList.remove(...Codicon.lightBulb.classNamesArray);\n\n      this._domNode.classList.add(...Codicon.lightbulbAutofix.classNamesArray);\n\n      const preferredKb = this._keybindingService.lookupKeybinding(this._preferredFixActionId);\n\n      if (preferredKb) {\n        this.title = nls.localize('preferredcodeActionWithKb', \"Show Code Actions. Preferred Quick Fix Available ({0})\", preferredKb.getLabel());\n        return;\n      }\n    } // update icon\n\n\n    this._domNode.classList.remove(...Codicon.lightbulbAutofix.classNamesArray);\n\n    this._domNode.classList.add(...Codicon.lightBulb.classNamesArray);\n\n    const kb = this._keybindingService.lookupKeybinding(this._quickFixActionId);\n\n    if (kb) {\n      this.title = nls.localize('codeActionWithKb', \"Show Code Actions ({0})\", kb.getLabel());\n    } else {\n      this.title = nls.localize('codeAction', \"Show Code Actions\");\n    }\n  }\n\n  set title(value) {\n    this._domNode.title = value;\n  }\n\n};\nLightBulbWidget._posPref = [0\n/* EXACT */\n];\nLightBulbWidget = __decorate([__param(3, IKeybindingService)], LightBulbWidget);\nexport { LightBulbWidget };\nregisterThemingParticipant((theme, collector) => {\n  var _a;\n\n  const editorBackgroundColor = (_a = theme.getColor(editorBackground)) === null || _a === void 0 ? void 0 : _a.transparent(0.7); // Lightbulb Icon\n\n  const editorLightBulbForegroundColor = theme.getColor(editorLightBulbForeground);\n\n  if (editorLightBulbForegroundColor) {\n    collector.addRule(`\n\t\t.monaco-editor .contentWidgets ${Codicon.lightBulb.cssSelector} {\n\t\t\tcolor: ${editorLightBulbForegroundColor};\n\t\t\tbackground-color: ${editorBackgroundColor};\n\t\t}`);\n  } // Lightbulb Auto Fix Icon\n\n\n  const editorLightBulbAutoFixForegroundColor = theme.getColor(editorLightBulbAutoFixForeground);\n\n  if (editorLightBulbAutoFixForegroundColor) {\n    collector.addRule(`\n\t\t.monaco-editor .contentWidgets ${Codicon.lightbulbAutofix.cssSelector} {\n\t\t\tcolor: ${editorLightBulbAutoFixForegroundColor};\n\t\t\tbackground-color: ${editorBackgroundColor};\n\t\t}`);\n  }\n});","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/browser/lightBulbWidget.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","dom","GlobalMouseMoveMonitor","standardMouseMoveMerger","Gesture","Codicon","Emitter","Disposable","computeIndentLevel","nls","IKeybindingService","editorBackground","editorLightBulbAutoFixForeground","editorLightBulbForeground","registerThemingParticipant","LightBulbState","Hidden","type","Showing","constructor","actions","trigger","editorPosition","widgetPosition","LightBulbWidget","_editor","_quickFixActionId","_preferredFixActionId","_keybindingService","_onClick","_register","onClick","event","_state","_domNode","document","createElement","className","lightBulb","classNames","addContentWidget","onDidChangeModelContent","_","editorModel","getModel","state","lineNumber","getLineCount","hide","ignoreTarget","addStandardDisposableGenericMouseDownListner","e","focus","preventDefault","top","height","getDomNodePagePosition","lineHeight","getOption","pad","Math","floor","position","fire","x","posx","y","addDisposableListener","buttons","monitor","startMonitoring","dispose","onDidChangeConfiguration","hasChanged","enabled","_updateLightBulbTitleAndIcon","onDidUpdateKeybindings","removeContentWidget","getId","getDomNode","getPosition","update","atPosition","validActions","options","getOptions","get","model","column","validatePosition","tabSize","fontInfo","lineContent","getLineContent","indent","lineHasSpace","spaceWidth","isFolded","getTopForLineNumber","effectiveLineNumber","preference","_posPref","layoutContentWidget","value","hasAutoFix","classList","remove","classNamesArray","add","lightbulbAutofix","preferredKb","lookupKeybinding","title","localize","getLabel","kb","theme","collector","_a","editorBackgroundColor","getColor","transparent","editorLightBulbForegroundColor","addRule","cssSelector","editorLightBulbAutoFixForegroundColor"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport * as dom from '../../../../base/browser/dom.js';\nimport { GlobalMouseMoveMonitor, standardMouseMoveMerger } from '../../../../base/browser/globalMouseMoveMonitor.js';\nimport { Gesture } from '../../../../base/browser/touch.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport './lightBulbWidget.css';\nimport { computeIndentLevel } from '../../../common/model/utils.js';\nimport * as nls from '../../../../nls.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { editorBackground, editorLightBulbAutoFixForeground, editorLightBulbForeground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\nvar LightBulbState;\n(function (LightBulbState) {\n    LightBulbState.Hidden = { type: 0 /* Hidden */ };\n    class Showing {\n        constructor(actions, trigger, editorPosition, widgetPosition) {\n            this.actions = actions;\n            this.trigger = trigger;\n            this.editorPosition = editorPosition;\n            this.widgetPosition = widgetPosition;\n            this.type = 1 /* Showing */;\n        }\n    }\n    LightBulbState.Showing = Showing;\n})(LightBulbState || (LightBulbState = {}));\nlet LightBulbWidget = class LightBulbWidget extends Disposable {\n    constructor(_editor, _quickFixActionId, _preferredFixActionId, _keybindingService) {\n        super();\n        this._editor = _editor;\n        this._quickFixActionId = _quickFixActionId;\n        this._preferredFixActionId = _preferredFixActionId;\n        this._keybindingService = _keybindingService;\n        this._onClick = this._register(new Emitter());\n        this.onClick = this._onClick.event;\n        this._state = LightBulbState.Hidden;\n        this._domNode = document.createElement('div');\n        this._domNode.className = Codicon.lightBulb.classNames;\n        this._editor.addContentWidget(this);\n        this._register(this._editor.onDidChangeModelContent(_ => {\n            // cancel when the line in question has been removed\n            const editorModel = this._editor.getModel();\n            if (this.state.type !== 1 /* Showing */ || !editorModel || this.state.editorPosition.lineNumber >= editorModel.getLineCount()) {\n                this.hide();\n            }\n        }));\n        Gesture.ignoreTarget(this._domNode);\n        this._register(dom.addStandardDisposableGenericMouseDownListner(this._domNode, e => {\n            if (this.state.type !== 1 /* Showing */) {\n                return;\n            }\n            // Make sure that focus / cursor location is not lost when clicking widget icon\n            this._editor.focus();\n            e.preventDefault();\n            // a bit of extra work to make sure the menu\n            // doesn't cover the line-text\n            const { top, height } = dom.getDomNodePagePosition(this._domNode);\n            const lineHeight = this._editor.getOption(59 /* lineHeight */);\n            let pad = Math.floor(lineHeight / 3);\n            if (this.state.widgetPosition.position !== null && this.state.widgetPosition.position.lineNumber < this.state.editorPosition.lineNumber) {\n                pad += lineHeight;\n            }\n            this._onClick.fire({\n                x: e.posx,\n                y: top + height + pad,\n                actions: this.state.actions,\n                trigger: this.state.trigger,\n            });\n        }));\n        this._register(dom.addDisposableListener(this._domNode, 'mouseenter', (e) => {\n            if ((e.buttons & 1) !== 1) {\n                return;\n            }\n            // mouse enters lightbulb while the primary/left button\n            // is being pressed -> hide the lightbulb and block future\n            // showings until mouse is released\n            this.hide();\n            const monitor = new GlobalMouseMoveMonitor();\n            monitor.startMonitoring(e.target, e.buttons, standardMouseMoveMerger, () => { }, () => {\n                monitor.dispose();\n            });\n        }));\n        this._register(this._editor.onDidChangeConfiguration(e => {\n            // hide when told to do so\n            if (e.hasChanged(57 /* lightbulb */) && !this._editor.getOption(57 /* lightbulb */).enabled) {\n                this.hide();\n            }\n        }));\n        this._updateLightBulbTitleAndIcon();\n        this._register(this._keybindingService.onDidUpdateKeybindings(this._updateLightBulbTitleAndIcon, this));\n    }\n    dispose() {\n        super.dispose();\n        this._editor.removeContentWidget(this);\n    }\n    getId() {\n        return 'LightBulbWidget';\n    }\n    getDomNode() {\n        return this._domNode;\n    }\n    getPosition() {\n        return this._state.type === 1 /* Showing */ ? this._state.widgetPosition : null;\n    }\n    update(actions, trigger, atPosition) {\n        if (actions.validActions.length <= 0) {\n            return this.hide();\n        }\n        const options = this._editor.getOptions();\n        if (!options.get(57 /* lightbulb */).enabled) {\n            return this.hide();\n        }\n        const model = this._editor.getModel();\n        if (!model) {\n            return this.hide();\n        }\n        const { lineNumber, column } = model.validatePosition(atPosition);\n        const tabSize = model.getOptions().tabSize;\n        const fontInfo = options.get(44 /* fontInfo */);\n        const lineContent = model.getLineContent(lineNumber);\n        const indent = computeIndentLevel(lineContent, tabSize);\n        const lineHasSpace = fontInfo.spaceWidth * indent > 22;\n        const isFolded = (lineNumber) => {\n            return lineNumber > 2 && this._editor.getTopForLineNumber(lineNumber) === this._editor.getTopForLineNumber(lineNumber - 1);\n        };\n        let effectiveLineNumber = lineNumber;\n        if (!lineHasSpace) {\n            if (lineNumber > 1 && !isFolded(lineNumber - 1)) {\n                effectiveLineNumber -= 1;\n            }\n            else if (!isFolded(lineNumber + 1)) {\n                effectiveLineNumber += 1;\n            }\n            else if (column * fontInfo.spaceWidth < 22) {\n                // cannot show lightbulb above/below and showing\n                // it inline would overlay the cursor...\n                return this.hide();\n            }\n        }\n        this.state = new LightBulbState.Showing(actions, trigger, atPosition, {\n            position: { lineNumber: effectiveLineNumber, column: 1 },\n            preference: LightBulbWidget._posPref\n        });\n        this._editor.layoutContentWidget(this);\n    }\n    hide() {\n        this.state = LightBulbState.Hidden;\n        this._editor.layoutContentWidget(this);\n    }\n    get state() { return this._state; }\n    set state(value) {\n        this._state = value;\n        this._updateLightBulbTitleAndIcon();\n    }\n    _updateLightBulbTitleAndIcon() {\n        if (this.state.type === 1 /* Showing */ && this.state.actions.hasAutoFix) {\n            // update icon\n            this._domNode.classList.remove(...Codicon.lightBulb.classNamesArray);\n            this._domNode.classList.add(...Codicon.lightbulbAutofix.classNamesArray);\n            const preferredKb = this._keybindingService.lookupKeybinding(this._preferredFixActionId);\n            if (preferredKb) {\n                this.title = nls.localize('preferredcodeActionWithKb', \"Show Code Actions. Preferred Quick Fix Available ({0})\", preferredKb.getLabel());\n                return;\n            }\n        }\n        // update icon\n        this._domNode.classList.remove(...Codicon.lightbulbAutofix.classNamesArray);\n        this._domNode.classList.add(...Codicon.lightBulb.classNamesArray);\n        const kb = this._keybindingService.lookupKeybinding(this._quickFixActionId);\n        if (kb) {\n            this.title = nls.localize('codeActionWithKb', \"Show Code Actions ({0})\", kb.getLabel());\n        }\n        else {\n            this.title = nls.localize('codeAction', \"Show Code Actions\");\n        }\n    }\n    set title(value) {\n        this._domNode.title = value;\n    }\n};\nLightBulbWidget._posPref = [0 /* EXACT */];\nLightBulbWidget = __decorate([\n    __param(3, IKeybindingService)\n], LightBulbWidget);\nexport { LightBulbWidget };\nregisterThemingParticipant((theme, collector) => {\n    var _a;\n    const editorBackgroundColor = (_a = theme.getColor(editorBackground)) === null || _a === void 0 ? void 0 : _a.transparent(0.7);\n    // Lightbulb Icon\n    const editorLightBulbForegroundColor = theme.getColor(editorLightBulbForeground);\n    if (editorLightBulbForegroundColor) {\n        collector.addRule(`\n\t\t.monaco-editor .contentWidgets ${Codicon.lightBulb.cssSelector} {\n\t\t\tcolor: ${editorLightBulbForegroundColor};\n\t\t\tbackground-color: ${editorBackgroundColor};\n\t\t}`);\n    }\n    // Lightbulb Auto Fix Icon\n    const editorLightBulbAutoFixForegroundColor = theme.getColor(editorLightBulbAutoFixForeground);\n    if (editorLightBulbAutoFixForegroundColor) {\n        collector.addRule(`\n\t\t.monaco-editor .contentWidgets ${Codicon.lightbulbAutofix.cssSelector} {\n\t\t\tcolor: ${editorLightBulbAutoFixForegroundColor};\n\t\t\tbackground-color: ${editorBackgroundColor};\n\t\t}`);\n    }\n});\n"]},"metadata":{},"sourceType":"module"}