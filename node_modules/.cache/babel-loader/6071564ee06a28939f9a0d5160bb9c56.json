{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { getDomNodePagePosition } from '../../../../base/browser/dom.js';\nimport { Action, Separator } from '../../../../base/common/actions.js';\nimport { canceled } from '../../../../base/common/errors.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { Position } from '../../../common/core/position.js';\nimport { CodeActionProviderRegistry } from '../../../common/languages.js';\nimport { codeActionCommandId, CodeActionItem, fixAllCommandId, organizeImportsCommandId, refactorCommandId, sourceActionCommandId } from './codeAction.js';\nimport { CodeActionCommandArgs, CodeActionKind } from './types.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\n\nclass CodeActionAction extends Action {\n  constructor(action, callback) {\n    super(action.command ? action.command.id : action.title, stripNewlines(action.title), undefined, !action.disabled, callback);\n    this.action = action;\n  }\n\n}\n\nfunction stripNewlines(str) {\n  return str.replace(/\\r\\n|\\r|\\n/g, ' ');\n}\n\nlet CodeActionMenu = class CodeActionMenu extends Disposable {\n  constructor(_editor, _delegate, _contextMenuService, keybindingService) {\n    super();\n    this._editor = _editor;\n    this._delegate = _delegate;\n    this._contextMenuService = _contextMenuService;\n    this._visible = false;\n    this._showingActions = this._register(new MutableDisposable());\n    this._keybindingResolver = new CodeActionKeybindingResolver({\n      getKeybindings: () => keybindingService.getKeybindings()\n    });\n  }\n\n  get isVisible() {\n    return this._visible;\n  }\n\n  show(trigger, codeActions, at, options) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const actionsToShow = options.includeDisabledActions ? codeActions.allActions : codeActions.validActions;\n\n      if (!actionsToShow.length) {\n        this._visible = false;\n        return;\n      }\n\n      if (!this._editor.getDomNode()) {\n        // cancel when editor went off-dom\n        this._visible = false;\n        throw canceled();\n      }\n\n      this._visible = true;\n      this._showingActions.value = codeActions;\n      const menuActions = this.getMenuActions(trigger, actionsToShow, codeActions.documentation);\n      const anchor = Position.isIPosition(at) ? this._toCoords(at) : at || {\n        x: 0,\n        y: 0\n      };\n\n      const resolver = this._keybindingResolver.getResolver();\n\n      const useShadowDOM = this._editor.getOption(115\n      /* useShadowDOM */\n      );\n\n      this._contextMenuService.showContextMenu({\n        domForShadowRoot: useShadowDOM ? this._editor.getDomNode() : undefined,\n        getAnchor: () => anchor,\n        getActions: () => menuActions,\n        onHide: () => {\n          this._visible = false;\n\n          this._editor.focus();\n        },\n        autoSelectFirstItem: true,\n        getKeyBinding: action => action instanceof CodeActionAction ? resolver(action.action) : undefined\n      });\n    });\n  }\n\n  getMenuActions(trigger, actionsToShow, documentation) {\n    var _a, _b;\n\n    const toCodeActionAction = item => new CodeActionAction(item.action, () => this._delegate.onSelectCodeAction(item));\n\n    const result = actionsToShow.map(toCodeActionAction);\n    const allDocumentation = [...documentation];\n\n    const model = this._editor.getModel();\n\n    if (model && result.length) {\n      for (const provider of CodeActionProviderRegistry.all(model)) {\n        if (provider._getAdditionalMenuItems) {\n          allDocumentation.push(...provider._getAdditionalMenuItems({\n            trigger: trigger.type,\n            only: (_b = (_a = trigger.filter) === null || _a === void 0 ? void 0 : _a.include) === null || _b === void 0 ? void 0 : _b.value\n          }, actionsToShow.map(item => item.action)));\n        }\n      }\n    }\n\n    if (allDocumentation.length) {\n      result.push(new Separator(), ...allDocumentation.map(command => toCodeActionAction(new CodeActionItem({\n        title: command.title,\n        command: command\n      }, undefined))));\n    }\n\n    return result;\n  }\n\n  _toCoords(position) {\n    if (!this._editor.hasModel()) {\n      return {\n        x: 0,\n        y: 0\n      };\n    }\n\n    this._editor.revealPosition(position, 1\n    /* Immediate */\n    );\n\n    this._editor.render(); // Translate to absolute editor position\n\n\n    const cursorCoords = this._editor.getScrolledVisiblePosition(position);\n\n    const editorCoords = getDomNodePagePosition(this._editor.getDomNode());\n    const x = editorCoords.left + cursorCoords.left;\n    const y = editorCoords.top + cursorCoords.top + cursorCoords.height;\n    return {\n      x,\n      y\n    };\n  }\n\n};\nCodeActionMenu = __decorate([__param(2, IContextMenuService), __param(3, IKeybindingService)], CodeActionMenu);\nexport { CodeActionMenu };\nexport class CodeActionKeybindingResolver {\n  constructor(_keybindingProvider) {\n    this._keybindingProvider = _keybindingProvider;\n  }\n\n  getResolver() {\n    // Lazy since we may not actually ever read the value\n    const allCodeActionBindings = new Lazy(() => this._keybindingProvider.getKeybindings().filter(item => CodeActionKeybindingResolver.codeActionCommands.indexOf(item.command) >= 0).filter(item => item.resolvedKeybinding).map(item => {\n      // Special case these commands since they come built-in with VS Code and don't use 'commandArgs'\n      let commandArgs = item.commandArgs;\n\n      if (item.command === organizeImportsCommandId) {\n        commandArgs = {\n          kind: CodeActionKind.SourceOrganizeImports.value\n        };\n      } else if (item.command === fixAllCommandId) {\n        commandArgs = {\n          kind: CodeActionKind.SourceFixAll.value\n        };\n      }\n\n      return Object.assign({\n        resolvedKeybinding: item.resolvedKeybinding\n      }, CodeActionCommandArgs.fromUser(commandArgs, {\n        kind: CodeActionKind.None,\n        apply: \"never\"\n        /* Never */\n\n      }));\n    }));\n    return action => {\n      if (action.kind) {\n        const binding = this.bestKeybindingForCodeAction(action, allCodeActionBindings.getValue());\n        return binding === null || binding === void 0 ? void 0 : binding.resolvedKeybinding;\n      }\n\n      return undefined;\n    };\n  }\n\n  bestKeybindingForCodeAction(action, candidates) {\n    if (!action.kind) {\n      return undefined;\n    }\n\n    const kind = new CodeActionKind(action.kind);\n    return candidates.filter(candidate => candidate.kind.contains(kind)).filter(candidate => {\n      if (candidate.preferred) {\n        // If the candidate keybinding only applies to preferred actions, the this action must also be preferred\n        return action.isPreferred;\n      }\n\n      return true;\n    }).reduceRight((currentBest, candidate) => {\n      if (!currentBest) {\n        return candidate;\n      } // Select the more specific binding\n\n\n      return currentBest.kind.contains(candidate.kind) ? candidate : currentBest;\n    }, undefined);\n  }\n\n}\nCodeActionKeybindingResolver.codeActionCommands = [refactorCommandId, codeActionCommandId, sourceActionCommandId, organizeImportsCommandId, fixAllCommandId];","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/browser/codeActionMenu.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","getDomNodePagePosition","Action","Separator","canceled","Lazy","Disposable","MutableDisposable","Position","CodeActionProviderRegistry","codeActionCommandId","CodeActionItem","fixAllCommandId","organizeImportsCommandId","refactorCommandId","sourceActionCommandId","CodeActionCommandArgs","CodeActionKind","IContextMenuService","IKeybindingService","CodeActionAction","constructor","action","callback","command","id","title","stripNewlines","undefined","disabled","str","replace","CodeActionMenu","_editor","_delegate","_contextMenuService","keybindingService","_visible","_showingActions","_register","_keybindingResolver","CodeActionKeybindingResolver","getKeybindings","isVisible","show","trigger","codeActions","at","options","actionsToShow","includeDisabledActions","allActions","validActions","getDomNode","menuActions","getMenuActions","documentation","anchor","isIPosition","_toCoords","x","y","resolver","getResolver","useShadowDOM","getOption","showContextMenu","domForShadowRoot","getAnchor","getActions","onHide","focus","autoSelectFirstItem","getKeyBinding","_a","_b","toCodeActionAction","item","onSelectCodeAction","map","allDocumentation","model","getModel","provider","all","_getAdditionalMenuItems","push","type","only","filter","include","position","hasModel","revealPosition","render","cursorCoords","getScrolledVisiblePosition","editorCoords","left","top","height","_keybindingProvider","allCodeActionBindings","codeActionCommands","indexOf","resolvedKeybinding","commandArgs","kind","SourceOrganizeImports","SourceFixAll","assign","fromUser","None","binding","bestKeybindingForCodeAction","getValue","candidates","candidate","contains","preferred","isPreferred","reduceRight","currentBest"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { getDomNodePagePosition } from '../../../../base/browser/dom.js';\nimport { Action, Separator } from '../../../../base/common/actions.js';\nimport { canceled } from '../../../../base/common/errors.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { Position } from '../../../common/core/position.js';\nimport { CodeActionProviderRegistry } from '../../../common/languages.js';\nimport { codeActionCommandId, CodeActionItem, fixAllCommandId, organizeImportsCommandId, refactorCommandId, sourceActionCommandId } from './codeAction.js';\nimport { CodeActionCommandArgs, CodeActionKind } from './types.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nclass CodeActionAction extends Action {\n    constructor(action, callback) {\n        super(action.command ? action.command.id : action.title, stripNewlines(action.title), undefined, !action.disabled, callback);\n        this.action = action;\n    }\n}\nfunction stripNewlines(str) {\n    return str.replace(/\\r\\n|\\r|\\n/g, ' ');\n}\nlet CodeActionMenu = class CodeActionMenu extends Disposable {\n    constructor(_editor, _delegate, _contextMenuService, keybindingService) {\n        super();\n        this._editor = _editor;\n        this._delegate = _delegate;\n        this._contextMenuService = _contextMenuService;\n        this._visible = false;\n        this._showingActions = this._register(new MutableDisposable());\n        this._keybindingResolver = new CodeActionKeybindingResolver({\n            getKeybindings: () => keybindingService.getKeybindings()\n        });\n    }\n    get isVisible() {\n        return this._visible;\n    }\n    show(trigger, codeActions, at, options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const actionsToShow = options.includeDisabledActions ? codeActions.allActions : codeActions.validActions;\n            if (!actionsToShow.length) {\n                this._visible = false;\n                return;\n            }\n            if (!this._editor.getDomNode()) {\n                // cancel when editor went off-dom\n                this._visible = false;\n                throw canceled();\n            }\n            this._visible = true;\n            this._showingActions.value = codeActions;\n            const menuActions = this.getMenuActions(trigger, actionsToShow, codeActions.documentation);\n            const anchor = Position.isIPosition(at) ? this._toCoords(at) : at || { x: 0, y: 0 };\n            const resolver = this._keybindingResolver.getResolver();\n            const useShadowDOM = this._editor.getOption(115 /* useShadowDOM */);\n            this._contextMenuService.showContextMenu({\n                domForShadowRoot: useShadowDOM ? this._editor.getDomNode() : undefined,\n                getAnchor: () => anchor,\n                getActions: () => menuActions,\n                onHide: () => {\n                    this._visible = false;\n                    this._editor.focus();\n                },\n                autoSelectFirstItem: true,\n                getKeyBinding: action => action instanceof CodeActionAction ? resolver(action.action) : undefined,\n            });\n        });\n    }\n    getMenuActions(trigger, actionsToShow, documentation) {\n        var _a, _b;\n        const toCodeActionAction = (item) => new CodeActionAction(item.action, () => this._delegate.onSelectCodeAction(item));\n        const result = actionsToShow\n            .map(toCodeActionAction);\n        const allDocumentation = [...documentation];\n        const model = this._editor.getModel();\n        if (model && result.length) {\n            for (const provider of CodeActionProviderRegistry.all(model)) {\n                if (provider._getAdditionalMenuItems) {\n                    allDocumentation.push(...provider._getAdditionalMenuItems({ trigger: trigger.type, only: (_b = (_a = trigger.filter) === null || _a === void 0 ? void 0 : _a.include) === null || _b === void 0 ? void 0 : _b.value }, actionsToShow.map(item => item.action)));\n                }\n            }\n        }\n        if (allDocumentation.length) {\n            result.push(new Separator(), ...allDocumentation.map(command => toCodeActionAction(new CodeActionItem({\n                title: command.title,\n                command: command,\n            }, undefined))));\n        }\n        return result;\n    }\n    _toCoords(position) {\n        if (!this._editor.hasModel()) {\n            return { x: 0, y: 0 };\n        }\n        this._editor.revealPosition(position, 1 /* Immediate */);\n        this._editor.render();\n        // Translate to absolute editor position\n        const cursorCoords = this._editor.getScrolledVisiblePosition(position);\n        const editorCoords = getDomNodePagePosition(this._editor.getDomNode());\n        const x = editorCoords.left + cursorCoords.left;\n        const y = editorCoords.top + cursorCoords.top + cursorCoords.height;\n        return { x, y };\n    }\n};\nCodeActionMenu = __decorate([\n    __param(2, IContextMenuService),\n    __param(3, IKeybindingService)\n], CodeActionMenu);\nexport { CodeActionMenu };\nexport class CodeActionKeybindingResolver {\n    constructor(_keybindingProvider) {\n        this._keybindingProvider = _keybindingProvider;\n    }\n    getResolver() {\n        // Lazy since we may not actually ever read the value\n        const allCodeActionBindings = new Lazy(() => this._keybindingProvider.getKeybindings()\n            .filter(item => CodeActionKeybindingResolver.codeActionCommands.indexOf(item.command) >= 0)\n            .filter(item => item.resolvedKeybinding)\n            .map((item) => {\n            // Special case these commands since they come built-in with VS Code and don't use 'commandArgs'\n            let commandArgs = item.commandArgs;\n            if (item.command === organizeImportsCommandId) {\n                commandArgs = { kind: CodeActionKind.SourceOrganizeImports.value };\n            }\n            else if (item.command === fixAllCommandId) {\n                commandArgs = { kind: CodeActionKind.SourceFixAll.value };\n            }\n            return Object.assign({ resolvedKeybinding: item.resolvedKeybinding }, CodeActionCommandArgs.fromUser(commandArgs, {\n                kind: CodeActionKind.None,\n                apply: \"never\" /* Never */\n            }));\n        }));\n        return (action) => {\n            if (action.kind) {\n                const binding = this.bestKeybindingForCodeAction(action, allCodeActionBindings.getValue());\n                return binding === null || binding === void 0 ? void 0 : binding.resolvedKeybinding;\n            }\n            return undefined;\n        };\n    }\n    bestKeybindingForCodeAction(action, candidates) {\n        if (!action.kind) {\n            return undefined;\n        }\n        const kind = new CodeActionKind(action.kind);\n        return candidates\n            .filter(candidate => candidate.kind.contains(kind))\n            .filter(candidate => {\n            if (candidate.preferred) {\n                // If the candidate keybinding only applies to preferred actions, the this action must also be preferred\n                return action.isPreferred;\n            }\n            return true;\n        })\n            .reduceRight((currentBest, candidate) => {\n            if (!currentBest) {\n                return candidate;\n            }\n            // Select the more specific binding\n            return currentBest.kind.contains(candidate.kind) ? candidate : currentBest;\n        }, undefined);\n    }\n}\nCodeActionKeybindingResolver.codeActionCommands = [\n    refactorCommandId,\n    codeActionCommandId,\n    sourceActionCommandId,\n    organizeImportsCommandId,\n    fixAllCommandId\n];\n"]},"metadata":{},"sourceType":"module"}