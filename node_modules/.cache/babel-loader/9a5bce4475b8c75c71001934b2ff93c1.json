{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\n\nvar _CodeActionModel_isDisposed;\n\nimport { createCancelablePromise, TimeoutTimer } from '../../../../base/common/async.js';\nimport { isCancellationError } from '../../../../base/common/errors.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { Range } from '../../../common/core/range.js';\nimport { CodeActionProviderRegistry } from '../../../common/languages.js';\nimport { RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Progress } from '../../../../platform/progress/common/progress.js';\nimport { getCodeActions } from './codeAction.js';\nexport const SUPPORTED_CODE_ACTIONS = new RawContextKey('supportedCodeAction', '');\n\nclass CodeActionOracle extends Disposable {\n  constructor(_editor, _markerService, _signalChange, _delay = 250) {\n    super();\n    this._editor = _editor;\n    this._markerService = _markerService;\n    this._signalChange = _signalChange;\n    this._delay = _delay;\n    this._autoTriggerTimer = this._register(new TimeoutTimer());\n\n    this._register(this._markerService.onMarkerChanged(e => this._onMarkerChanges(e)));\n\n    this._register(this._editor.onDidChangeCursorPosition(() => this._onCursorChange()));\n  }\n\n  trigger(trigger) {\n    const selection = this._getRangeOfSelectionUnlessWhitespaceEnclosed(trigger);\n\n    return this._createEventAndSignalChange(trigger, selection);\n  }\n\n  _onMarkerChanges(resources) {\n    const model = this._editor.getModel();\n\n    if (!model) {\n      return;\n    }\n\n    if (resources.some(resource => isEqual(resource, model.uri))) {\n      this._autoTriggerTimer.cancelAndSet(() => {\n        this.trigger({\n          type: 2\n          /* Auto */\n\n        });\n      }, this._delay);\n    }\n  }\n\n  _onCursorChange() {\n    this._autoTriggerTimer.cancelAndSet(() => {\n      this.trigger({\n        type: 2\n        /* Auto */\n\n      });\n    }, this._delay);\n  }\n\n  _getRangeOfMarker(selection) {\n    const model = this._editor.getModel();\n\n    if (!model) {\n      return undefined;\n    }\n\n    for (const marker of this._markerService.read({\n      resource: model.uri\n    })) {\n      const markerRange = model.validateRange(marker);\n\n      if (Range.intersectRanges(markerRange, selection)) {\n        return Range.lift(markerRange);\n      }\n    }\n\n    return undefined;\n  }\n\n  _getRangeOfSelectionUnlessWhitespaceEnclosed(trigger) {\n    if (!this._editor.hasModel()) {\n      return undefined;\n    }\n\n    const model = this._editor.getModel();\n\n    const selection = this._editor.getSelection();\n\n    if (selection.isEmpty() && trigger.type === 2\n    /* Auto */\n    ) {\n      const {\n        lineNumber,\n        column\n      } = selection.getPosition();\n      const line = model.getLineContent(lineNumber);\n\n      if (line.length === 0) {\n        // empty line\n        return undefined;\n      } else if (column === 1) {\n        // look only right\n        if (/\\s/.test(line[0])) {\n          return undefined;\n        }\n      } else if (column === model.getLineMaxColumn(lineNumber)) {\n        // look only left\n        if (/\\s/.test(line[line.length - 1])) {\n          return undefined;\n        }\n      } else {\n        // look left and right\n        if (/\\s/.test(line[column - 2]) && /\\s/.test(line[column - 1])) {\n          return undefined;\n        }\n      }\n    }\n\n    return selection;\n  }\n\n  _createEventAndSignalChange(trigger, selection) {\n    const model = this._editor.getModel();\n\n    if (!selection || !model) {\n      // cancel\n      this._signalChange(undefined);\n\n      return undefined;\n    }\n\n    const markerRange = this._getRangeOfMarker(selection);\n\n    const position = markerRange ? markerRange.getStartPosition() : selection.getStartPosition();\n    const e = {\n      trigger,\n      selection,\n      position\n    };\n\n    this._signalChange(e);\n\n    return e;\n  }\n\n}\n\nexport var CodeActionsState;\n\n(function (CodeActionsState) {\n  CodeActionsState.Empty = {\n    type: 0\n    /* Empty */\n\n  };\n\n  class Triggered {\n    constructor(trigger, rangeOrSelection, position, _cancellablePromise) {\n      this.trigger = trigger;\n      this.rangeOrSelection = rangeOrSelection;\n      this.position = position;\n      this._cancellablePromise = _cancellablePromise;\n      this.type = 1\n      /* Triggered */\n      ;\n      this.actions = _cancellablePromise.catch(e => {\n        if (isCancellationError(e)) {\n          return emptyCodeActionSet;\n        }\n\n        throw e;\n      });\n    }\n\n    cancel() {\n      this._cancellablePromise.cancel();\n    }\n\n  }\n\n  CodeActionsState.Triggered = Triggered;\n})(CodeActionsState || (CodeActionsState = {}));\n\nconst emptyCodeActionSet = {\n  allActions: [],\n  validActions: [],\n  dispose: () => {},\n  documentation: [],\n  hasAutoFix: false\n};\nexport class CodeActionModel extends Disposable {\n  constructor(_editor, _markerService, contextKeyService, _progressService) {\n    super();\n    this._editor = _editor;\n    this._markerService = _markerService;\n    this._progressService = _progressService;\n    this._codeActionOracle = this._register(new MutableDisposable());\n    this._state = CodeActionsState.Empty;\n    this._onDidChangeState = this._register(new Emitter());\n    this.onDidChangeState = this._onDidChangeState.event;\n\n    _CodeActionModel_isDisposed.set(this, false);\n\n    this._supportedCodeActions = SUPPORTED_CODE_ACTIONS.bindTo(contextKeyService);\n\n    this._register(this._editor.onDidChangeModel(() => this._update()));\n\n    this._register(this._editor.onDidChangeModelLanguage(() => this._update()));\n\n    this._register(CodeActionProviderRegistry.onDidChange(() => this._update()));\n\n    this._update();\n  }\n\n  dispose() {\n    if (__classPrivateFieldGet(this, _CodeActionModel_isDisposed, \"f\")) {\n      return;\n    }\n\n    __classPrivateFieldSet(this, _CodeActionModel_isDisposed, true, \"f\");\n\n    super.dispose();\n    this.setState(CodeActionsState.Empty, true);\n  }\n\n  _update() {\n    if (__classPrivateFieldGet(this, _CodeActionModel_isDisposed, \"f\")) {\n      return;\n    }\n\n    this._codeActionOracle.value = undefined;\n    this.setState(CodeActionsState.Empty);\n\n    const model = this._editor.getModel();\n\n    if (model && CodeActionProviderRegistry.has(model) && !this._editor.getOption(81\n    /* readOnly */\n    )) {\n      const supportedActions = [];\n\n      for (const provider of CodeActionProviderRegistry.all(model)) {\n        if (Array.isArray(provider.providedCodeActionKinds)) {\n          supportedActions.push(...provider.providedCodeActionKinds);\n        }\n      }\n\n      this._supportedCodeActions.set(supportedActions.join(' '));\n\n      this._codeActionOracle.value = new CodeActionOracle(this._editor, this._markerService, trigger => {\n        var _a;\n\n        if (!trigger) {\n          this.setState(CodeActionsState.Empty);\n          return;\n        }\n\n        const actions = createCancelablePromise(token => getCodeActions(model, trigger.selection, trigger.trigger, Progress.None, token));\n\n        if (trigger.trigger.type === 1\n        /* Invoke */\n        ) {\n          (_a = this._progressService) === null || _a === void 0 ? void 0 : _a.showWhile(actions, 250);\n        }\n\n        this.setState(new CodeActionsState.Triggered(trigger.trigger, trigger.selection, trigger.position, actions));\n      }, undefined);\n\n      this._codeActionOracle.value.trigger({\n        type: 2\n        /* Auto */\n\n      });\n    } else {\n      this._supportedCodeActions.reset();\n    }\n  }\n\n  trigger(trigger) {\n    if (this._codeActionOracle.value) {\n      this._codeActionOracle.value.trigger(trigger);\n    }\n  }\n\n  setState(newState, skipNotify) {\n    if (newState === this._state) {\n      return;\n    } // Cancel old request\n\n\n    if (this._state.type === 1\n    /* Triggered */\n    ) {\n      this._state.cancel();\n    }\n\n    this._state = newState;\n\n    if (!skipNotify && !__classPrivateFieldGet(this, _CodeActionModel_isDisposed, \"f\")) {\n      this._onDidChangeState.fire(newState);\n    }\n  }\n\n}\n_CodeActionModel_isDisposed = new WeakMap();","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/browser/codeActionModel.js"],"names":["__classPrivateFieldGet","receiver","state","kind","f","TypeError","has","call","value","get","__classPrivateFieldSet","set","_CodeActionModel_isDisposed","createCancelablePromise","TimeoutTimer","isCancellationError","Emitter","Disposable","MutableDisposable","isEqual","Range","CodeActionProviderRegistry","RawContextKey","Progress","getCodeActions","SUPPORTED_CODE_ACTIONS","CodeActionOracle","constructor","_editor","_markerService","_signalChange","_delay","_autoTriggerTimer","_register","onMarkerChanged","e","_onMarkerChanges","onDidChangeCursorPosition","_onCursorChange","trigger","selection","_getRangeOfSelectionUnlessWhitespaceEnclosed","_createEventAndSignalChange","resources","model","getModel","some","resource","uri","cancelAndSet","type","_getRangeOfMarker","undefined","marker","read","markerRange","validateRange","intersectRanges","lift","hasModel","getSelection","isEmpty","lineNumber","column","getPosition","line","getLineContent","length","test","getLineMaxColumn","position","getStartPosition","CodeActionsState","Empty","Triggered","rangeOrSelection","_cancellablePromise","actions","catch","emptyCodeActionSet","cancel","allActions","validActions","dispose","documentation","hasAutoFix","CodeActionModel","contextKeyService","_progressService","_codeActionOracle","_state","_onDidChangeState","onDidChangeState","event","_supportedCodeActions","bindTo","onDidChangeModel","_update","onDidChangeModelLanguage","onDidChange","setState","getOption","supportedActions","provider","all","Array","isArray","providedCodeActionKinds","push","join","_a","token","None","showWhile","reset","newState","skipNotify","fire","WeakMap"],"mappings":"AAAA;AACA;AACA;AACA;AACA,IAAIA,sBAAsB,GAAI,QAAQ,KAAKA,sBAAd,IAAyC,UAAUC,QAAV,EAAoBC,KAApB,EAA2BC,IAA3B,EAAiCC,CAAjC,EAAoC;AACtG,MAAID,IAAI,KAAK,GAAT,IAAgB,CAACC,CAArB,EAAwB,MAAM,IAAIC,SAAJ,CAAc,+CAAd,CAAN;AACxB,MAAI,OAAOH,KAAP,KAAiB,UAAjB,GAA8BD,QAAQ,KAAKC,KAAb,IAAsB,CAACE,CAArD,GAAyD,CAACF,KAAK,CAACI,GAAN,CAAUL,QAAV,CAA9D,EAAmF,MAAM,IAAII,SAAJ,CAAc,0EAAd,CAAN;AACnF,SAAOF,IAAI,KAAK,GAAT,GAAeC,CAAf,GAAmBD,IAAI,KAAK,GAAT,GAAeC,CAAC,CAACG,IAAF,CAAON,QAAP,CAAf,GAAkCG,CAAC,GAAGA,CAAC,CAACI,KAAL,GAAaN,KAAK,CAACO,GAAN,CAAUR,QAAV,CAA1E;AACH,CAJD;;AAKA,IAAIS,sBAAsB,GAAI,QAAQ,KAAKA,sBAAd,IAAyC,UAAUT,QAAV,EAAoBC,KAApB,EAA2BM,KAA3B,EAAkCL,IAAlC,EAAwCC,CAAxC,EAA2C;AAC7G,MAAID,IAAI,KAAK,GAAb,EAAkB,MAAM,IAAIE,SAAJ,CAAc,gCAAd,CAAN;AAClB,MAAIF,IAAI,KAAK,GAAT,IAAgB,CAACC,CAArB,EAAwB,MAAM,IAAIC,SAAJ,CAAc,+CAAd,CAAN;AACxB,MAAI,OAAOH,KAAP,KAAiB,UAAjB,GAA8BD,QAAQ,KAAKC,KAAb,IAAsB,CAACE,CAArD,GAAyD,CAACF,KAAK,CAACI,GAAN,CAAUL,QAAV,CAA9D,EAAmF,MAAM,IAAII,SAAJ,CAAc,yEAAd,CAAN;AACnF,SAAQF,IAAI,KAAK,GAAT,GAAeC,CAAC,CAACG,IAAF,CAAON,QAAP,EAAiBO,KAAjB,CAAf,GAAyCJ,CAAC,GAAGA,CAAC,CAACI,KAAF,GAAUA,KAAb,GAAqBN,KAAK,CAACS,GAAN,CAAUV,QAAV,EAAoBO,KAApB,CAAhE,EAA6FA,KAApG;AACH,CALD;;AAMA,IAAII,2BAAJ;;AACA,SAASC,uBAAT,EAAkCC,YAAlC,QAAsD,kCAAtD;AACA,SAASC,mBAAT,QAAoC,mCAApC;AACA,SAASC,OAAT,QAAwB,kCAAxB;AACA,SAASC,UAAT,EAAqBC,iBAArB,QAA8C,sCAA9C;AACA,SAASC,OAAT,QAAwB,sCAAxB;AACA,SAASC,KAAT,QAAsB,+BAAtB;AACA,SAASC,0BAAT,QAA2C,8BAA3C;AACA,SAASC,aAAT,QAA8B,sDAA9B;AACA,SAASC,QAAT,QAAyB,kDAAzB;AACA,SAASC,cAAT,QAA+B,iBAA/B;AACA,OAAO,MAAMC,sBAAsB,GAAG,IAAIH,aAAJ,CAAkB,qBAAlB,EAAyC,EAAzC,CAA/B;;AACP,MAAMI,gBAAN,SAA+BT,UAA/B,CAA0C;AACtCU,EAAAA,WAAW,CAACC,OAAD,EAAUC,cAAV,EAA0BC,aAA1B,EAAyCC,MAAM,GAAG,GAAlD,EAAuD;AAC9D;AACA,SAAKH,OAAL,GAAeA,OAAf;AACA,SAAKC,cAAL,GAAsBA,cAAtB;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKC,iBAAL,GAAyB,KAAKC,SAAL,CAAe,IAAInB,YAAJ,EAAf,CAAzB;;AACA,SAAKmB,SAAL,CAAe,KAAKJ,cAAL,CAAoBK,eAApB,CAAoCC,CAAC,IAAI,KAAKC,gBAAL,CAAsBD,CAAtB,CAAzC,CAAf;;AACA,SAAKF,SAAL,CAAe,KAAKL,OAAL,CAAaS,yBAAb,CAAuC,MAAM,KAAKC,eAAL,EAA7C,CAAf;AACH;;AACDC,EAAAA,OAAO,CAACA,OAAD,EAAU;AACb,UAAMC,SAAS,GAAG,KAAKC,4CAAL,CAAkDF,OAAlD,CAAlB;;AACA,WAAO,KAAKG,2BAAL,CAAiCH,OAAjC,EAA0CC,SAA1C,CAAP;AACH;;AACDJ,EAAAA,gBAAgB,CAACO,SAAD,EAAY;AACxB,UAAMC,KAAK,GAAG,KAAKhB,OAAL,CAAaiB,QAAb,EAAd;;AACA,QAAI,CAACD,KAAL,EAAY;AACR;AACH;;AACD,QAAID,SAAS,CAACG,IAAV,CAAeC,QAAQ,IAAI5B,OAAO,CAAC4B,QAAD,EAAWH,KAAK,CAACI,GAAjB,CAAlC,CAAJ,EAA8D;AAC1D,WAAKhB,iBAAL,CAAuBiB,YAAvB,CAAoC,MAAM;AACtC,aAAKV,OAAL,CAAa;AAAEW,UAAAA,IAAI,EAAE;AAAE;;AAAV,SAAb;AACH,OAFD,EAEG,KAAKnB,MAFR;AAGH;AACJ;;AACDO,EAAAA,eAAe,GAAG;AACd,SAAKN,iBAAL,CAAuBiB,YAAvB,CAAoC,MAAM;AACtC,WAAKV,OAAL,CAAa;AAAEW,QAAAA,IAAI,EAAE;AAAE;;AAAV,OAAb;AACH,KAFD,EAEG,KAAKnB,MAFR;AAGH;;AACDoB,EAAAA,iBAAiB,CAACX,SAAD,EAAY;AACzB,UAAMI,KAAK,GAAG,KAAKhB,OAAL,CAAaiB,QAAb,EAAd;;AACA,QAAI,CAACD,KAAL,EAAY;AACR,aAAOQ,SAAP;AACH;;AACD,SAAK,MAAMC,MAAX,IAAqB,KAAKxB,cAAL,CAAoByB,IAApB,CAAyB;AAAEP,MAAAA,QAAQ,EAAEH,KAAK,CAACI;AAAlB,KAAzB,CAArB,EAAwE;AACpE,YAAMO,WAAW,GAAGX,KAAK,CAACY,aAAN,CAAoBH,MAApB,CAApB;;AACA,UAAIjC,KAAK,CAACqC,eAAN,CAAsBF,WAAtB,EAAmCf,SAAnC,CAAJ,EAAmD;AAC/C,eAAOpB,KAAK,CAACsC,IAAN,CAAWH,WAAX,CAAP;AACH;AACJ;;AACD,WAAOH,SAAP;AACH;;AACDX,EAAAA,4CAA4C,CAACF,OAAD,EAAU;AAClD,QAAI,CAAC,KAAKX,OAAL,CAAa+B,QAAb,EAAL,EAA8B;AAC1B,aAAOP,SAAP;AACH;;AACD,UAAMR,KAAK,GAAG,KAAKhB,OAAL,CAAaiB,QAAb,EAAd;;AACA,UAAML,SAAS,GAAG,KAAKZ,OAAL,CAAagC,YAAb,EAAlB;;AACA,QAAIpB,SAAS,CAACqB,OAAV,MAAuBtB,OAAO,CAACW,IAAR,KAAiB;AAAE;AAA9C,MAA0D;AACtD,YAAM;AAAEY,QAAAA,UAAF;AAAcC,QAAAA;AAAd,UAAyBvB,SAAS,CAACwB,WAAV,EAA/B;AACA,YAAMC,IAAI,GAAGrB,KAAK,CAACsB,cAAN,CAAqBJ,UAArB,CAAb;;AACA,UAAIG,IAAI,CAACE,MAAL,KAAgB,CAApB,EAAuB;AACnB;AACA,eAAOf,SAAP;AACH,OAHD,MAIK,IAAIW,MAAM,KAAK,CAAf,EAAkB;AACnB;AACA,YAAI,KAAKK,IAAL,CAAUH,IAAI,CAAC,CAAD,CAAd,CAAJ,EAAwB;AACpB,iBAAOb,SAAP;AACH;AACJ,OALI,MAMA,IAAIW,MAAM,KAAKnB,KAAK,CAACyB,gBAAN,CAAuBP,UAAvB,CAAf,EAAmD;AACpD;AACA,YAAI,KAAKM,IAAL,CAAUH,IAAI,CAACA,IAAI,CAACE,MAAL,GAAc,CAAf,CAAd,CAAJ,EAAsC;AAClC,iBAAOf,SAAP;AACH;AACJ,OALI,MAMA;AACD;AACA,YAAI,KAAKgB,IAAL,CAAUH,IAAI,CAACF,MAAM,GAAG,CAAV,CAAd,KAA+B,KAAKK,IAAL,CAAUH,IAAI,CAACF,MAAM,GAAG,CAAV,CAAd,CAAnC,EAAgE;AAC5D,iBAAOX,SAAP;AACH;AACJ;AACJ;;AACD,WAAOZ,SAAP;AACH;;AACDE,EAAAA,2BAA2B,CAACH,OAAD,EAAUC,SAAV,EAAqB;AAC5C,UAAMI,KAAK,GAAG,KAAKhB,OAAL,CAAaiB,QAAb,EAAd;;AACA,QAAI,CAACL,SAAD,IAAc,CAACI,KAAnB,EAA0B;AACtB;AACA,WAAKd,aAAL,CAAmBsB,SAAnB;;AACA,aAAOA,SAAP;AACH;;AACD,UAAMG,WAAW,GAAG,KAAKJ,iBAAL,CAAuBX,SAAvB,CAApB;;AACA,UAAM8B,QAAQ,GAAGf,WAAW,GAAGA,WAAW,CAACgB,gBAAZ,EAAH,GAAoC/B,SAAS,CAAC+B,gBAAV,EAAhE;AACA,UAAMpC,CAAC,GAAG;AACNI,MAAAA,OADM;AAENC,MAAAA,SAFM;AAGN8B,MAAAA;AAHM,KAAV;;AAKA,SAAKxC,aAAL,CAAmBK,CAAnB;;AACA,WAAOA,CAAP;AACH;;AA9FqC;;AAgG1C,OAAO,IAAIqC,gBAAJ;;AACP,CAAC,UAAUA,gBAAV,EAA4B;AACzBA,EAAAA,gBAAgB,CAACC,KAAjB,GAAyB;AAAEvB,IAAAA,IAAI,EAAE;AAAE;;AAAV,GAAzB;;AACA,QAAMwB,SAAN,CAAgB;AACZ/C,IAAAA,WAAW,CAACY,OAAD,EAAUoC,gBAAV,EAA4BL,QAA5B,EAAsCM,mBAAtC,EAA2D;AAClE,WAAKrC,OAAL,GAAeA,OAAf;AACA,WAAKoC,gBAAL,GAAwBA,gBAAxB;AACA,WAAKL,QAAL,GAAgBA,QAAhB;AACA,WAAKM,mBAAL,GAA2BA,mBAA3B;AACA,WAAK1B,IAAL,GAAY;AAAE;AAAd;AACA,WAAK2B,OAAL,GAAeD,mBAAmB,CAACE,KAApB,CAA2B3C,CAAD,IAAO;AAC5C,YAAIpB,mBAAmB,CAACoB,CAAD,CAAvB,EAA4B;AACxB,iBAAO4C,kBAAP;AACH;;AACD,cAAM5C,CAAN;AACH,OALc,CAAf;AAMH;;AACD6C,IAAAA,MAAM,GAAG;AACL,WAAKJ,mBAAL,CAAyBI,MAAzB;AACH;;AAhBW;;AAkBhBR,EAAAA,gBAAgB,CAACE,SAAjB,GAA6BA,SAA7B;AACH,CArBD,EAqBGF,gBAAgB,KAAKA,gBAAgB,GAAG,EAAxB,CArBnB;;AAsBA,MAAMO,kBAAkB,GAAG;AACvBE,EAAAA,UAAU,EAAE,EADW;AAEvBC,EAAAA,YAAY,EAAE,EAFS;AAGvBC,EAAAA,OAAO,EAAE,MAAM,CAAG,CAHK;AAIvBC,EAAAA,aAAa,EAAE,EAJQ;AAKvBC,EAAAA,UAAU,EAAE;AALW,CAA3B;AAOA,OAAO,MAAMC,eAAN,SAA8BrE,UAA9B,CAAyC;AAC5CU,EAAAA,WAAW,CAACC,OAAD,EAAUC,cAAV,EAA0B0D,iBAA1B,EAA6CC,gBAA7C,EAA+D;AACtE;AACA,SAAK5D,OAAL,GAAeA,OAAf;AACA,SAAKC,cAAL,GAAsBA,cAAtB;AACA,SAAK2D,gBAAL,GAAwBA,gBAAxB;AACA,SAAKC,iBAAL,GAAyB,KAAKxD,SAAL,CAAe,IAAIf,iBAAJ,EAAf,CAAzB;AACA,SAAKwE,MAAL,GAAclB,gBAAgB,CAACC,KAA/B;AACA,SAAKkB,iBAAL,GAAyB,KAAK1D,SAAL,CAAe,IAAIjB,OAAJ,EAAf,CAAzB;AACA,SAAK4E,gBAAL,GAAwB,KAAKD,iBAAL,CAAuBE,KAA/C;;AACAjF,IAAAA,2BAA2B,CAACD,GAA5B,CAAgC,IAAhC,EAAsC,KAAtC;;AACA,SAAKmF,qBAAL,GAA6BrE,sBAAsB,CAACsE,MAAvB,CAA8BR,iBAA9B,CAA7B;;AACA,SAAKtD,SAAL,CAAe,KAAKL,OAAL,CAAaoE,gBAAb,CAA8B,MAAM,KAAKC,OAAL,EAApC,CAAf;;AACA,SAAKhE,SAAL,CAAe,KAAKL,OAAL,CAAasE,wBAAb,CAAsC,MAAM,KAAKD,OAAL,EAA5C,CAAf;;AACA,SAAKhE,SAAL,CAAeZ,0BAA0B,CAAC8E,WAA3B,CAAuC,MAAM,KAAKF,OAAL,EAA7C,CAAf;;AACA,SAAKA,OAAL;AACH;;AACDd,EAAAA,OAAO,GAAG;AACN,QAAInF,sBAAsB,CAAC,IAAD,EAAOY,2BAAP,EAAoC,GAApC,CAA1B,EAAoE;AAChE;AACH;;AACDF,IAAAA,sBAAsB,CAAC,IAAD,EAAOE,2BAAP,EAAoC,IAApC,EAA0C,GAA1C,CAAtB;;AACA,UAAMuE,OAAN;AACA,SAAKiB,QAAL,CAAc5B,gBAAgB,CAACC,KAA/B,EAAsC,IAAtC;AACH;;AACDwB,EAAAA,OAAO,GAAG;AACN,QAAIjG,sBAAsB,CAAC,IAAD,EAAOY,2BAAP,EAAoC,GAApC,CAA1B,EAAoE;AAChE;AACH;;AACD,SAAK6E,iBAAL,CAAuBjF,KAAvB,GAA+B4C,SAA/B;AACA,SAAKgD,QAAL,CAAc5B,gBAAgB,CAACC,KAA/B;;AACA,UAAM7B,KAAK,GAAG,KAAKhB,OAAL,CAAaiB,QAAb,EAAd;;AACA,QAAID,KAAK,IACFvB,0BAA0B,CAACf,GAA3B,CAA+BsC,KAA/B,CADH,IAEG,CAAC,KAAKhB,OAAL,CAAayE,SAAb,CAAuB;AAAG;AAA1B,KAFR,EAEmD;AAC/C,YAAMC,gBAAgB,GAAG,EAAzB;;AACA,WAAK,MAAMC,QAAX,IAAuBlF,0BAA0B,CAACmF,GAA3B,CAA+B5D,KAA/B,CAAvB,EAA8D;AAC1D,YAAI6D,KAAK,CAACC,OAAN,CAAcH,QAAQ,CAACI,uBAAvB,CAAJ,EAAqD;AACjDL,UAAAA,gBAAgB,CAACM,IAAjB,CAAsB,GAAGL,QAAQ,CAACI,uBAAlC;AACH;AACJ;;AACD,WAAKb,qBAAL,CAA2BnF,GAA3B,CAA+B2F,gBAAgB,CAACO,IAAjB,CAAsB,GAAtB,CAA/B;;AACA,WAAKpB,iBAAL,CAAuBjF,KAAvB,GAA+B,IAAIkB,gBAAJ,CAAqB,KAAKE,OAA1B,EAAmC,KAAKC,cAAxC,EAAwDU,OAAO,IAAI;AAC9F,YAAIuE,EAAJ;;AACA,YAAI,CAACvE,OAAL,EAAc;AACV,eAAK6D,QAAL,CAAc5B,gBAAgB,CAACC,KAA/B;AACA;AACH;;AACD,cAAMI,OAAO,GAAGhE,uBAAuB,CAACkG,KAAK,IAAIvF,cAAc,CAACoB,KAAD,EAAQL,OAAO,CAACC,SAAhB,EAA2BD,OAAO,CAACA,OAAnC,EAA4ChB,QAAQ,CAACyF,IAArD,EAA2DD,KAA3D,CAAxB,CAAvC;;AACA,YAAIxE,OAAO,CAACA,OAAR,CAAgBW,IAAhB,KAAyB;AAAE;AAA/B,UAA6C;AACzC,WAAC4D,EAAE,GAAG,KAAKtB,gBAAX,MAAiC,IAAjC,IAAyCsB,EAAE,KAAK,KAAK,CAArD,GAAyD,KAAK,CAA9D,GAAkEA,EAAE,CAACG,SAAH,CAAapC,OAAb,EAAsB,GAAtB,CAAlE;AACH;;AACD,aAAKuB,QAAL,CAAc,IAAI5B,gBAAgB,CAACE,SAArB,CAA+BnC,OAAO,CAACA,OAAvC,EAAgDA,OAAO,CAACC,SAAxD,EAAmED,OAAO,CAAC+B,QAA3E,EAAqFO,OAArF,CAAd;AACH,OAX8B,EAW5BzB,SAX4B,CAA/B;;AAYA,WAAKqC,iBAAL,CAAuBjF,KAAvB,CAA6B+B,OAA7B,CAAqC;AAAEW,QAAAA,IAAI,EAAE;AAAE;;AAAV,OAArC;AACH,KAvBD,MAwBK;AACD,WAAK4C,qBAAL,CAA2BoB,KAA3B;AACH;AACJ;;AACD3E,EAAAA,OAAO,CAACA,OAAD,EAAU;AACb,QAAI,KAAKkD,iBAAL,CAAuBjF,KAA3B,EAAkC;AAC9B,WAAKiF,iBAAL,CAAuBjF,KAAvB,CAA6B+B,OAA7B,CAAqCA,OAArC;AACH;AACJ;;AACD6D,EAAAA,QAAQ,CAACe,QAAD,EAAWC,UAAX,EAAuB;AAC3B,QAAID,QAAQ,KAAK,KAAKzB,MAAtB,EAA8B;AAC1B;AACH,KAH0B,CAI3B;;;AACA,QAAI,KAAKA,MAAL,CAAYxC,IAAZ,KAAqB;AAAE;AAA3B,MAA4C;AACxC,WAAKwC,MAAL,CAAYV,MAAZ;AACH;;AACD,SAAKU,MAAL,GAAcyB,QAAd;;AACA,QAAI,CAACC,UAAD,IAAe,CAACpH,sBAAsB,CAAC,IAAD,EAAOY,2BAAP,EAAoC,GAApC,CAA1C,EAAoF;AAChF,WAAK+E,iBAAL,CAAuB0B,IAAvB,CAA4BF,QAA5B;AACH;AACJ;;AA7E2C;AA+EhDvG,2BAA2B,GAAG,IAAI0G,OAAJ,EAA9B","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar _CodeActionModel_isDisposed;\nimport { createCancelablePromise, TimeoutTimer } from '../../../../base/common/async.js';\nimport { isCancellationError } from '../../../../base/common/errors.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { Range } from '../../../common/core/range.js';\nimport { CodeActionProviderRegistry } from '../../../common/languages.js';\nimport { RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Progress } from '../../../../platform/progress/common/progress.js';\nimport { getCodeActions } from './codeAction.js';\nexport const SUPPORTED_CODE_ACTIONS = new RawContextKey('supportedCodeAction', '');\nclass CodeActionOracle extends Disposable {\n    constructor(_editor, _markerService, _signalChange, _delay = 250) {\n        super();\n        this._editor = _editor;\n        this._markerService = _markerService;\n        this._signalChange = _signalChange;\n        this._delay = _delay;\n        this._autoTriggerTimer = this._register(new TimeoutTimer());\n        this._register(this._markerService.onMarkerChanged(e => this._onMarkerChanges(e)));\n        this._register(this._editor.onDidChangeCursorPosition(() => this._onCursorChange()));\n    }\n    trigger(trigger) {\n        const selection = this._getRangeOfSelectionUnlessWhitespaceEnclosed(trigger);\n        return this._createEventAndSignalChange(trigger, selection);\n    }\n    _onMarkerChanges(resources) {\n        const model = this._editor.getModel();\n        if (!model) {\n            return;\n        }\n        if (resources.some(resource => isEqual(resource, model.uri))) {\n            this._autoTriggerTimer.cancelAndSet(() => {\n                this.trigger({ type: 2 /* Auto */ });\n            }, this._delay);\n        }\n    }\n    _onCursorChange() {\n        this._autoTriggerTimer.cancelAndSet(() => {\n            this.trigger({ type: 2 /* Auto */ });\n        }, this._delay);\n    }\n    _getRangeOfMarker(selection) {\n        const model = this._editor.getModel();\n        if (!model) {\n            return undefined;\n        }\n        for (const marker of this._markerService.read({ resource: model.uri })) {\n            const markerRange = model.validateRange(marker);\n            if (Range.intersectRanges(markerRange, selection)) {\n                return Range.lift(markerRange);\n            }\n        }\n        return undefined;\n    }\n    _getRangeOfSelectionUnlessWhitespaceEnclosed(trigger) {\n        if (!this._editor.hasModel()) {\n            return undefined;\n        }\n        const model = this._editor.getModel();\n        const selection = this._editor.getSelection();\n        if (selection.isEmpty() && trigger.type === 2 /* Auto */) {\n            const { lineNumber, column } = selection.getPosition();\n            const line = model.getLineContent(lineNumber);\n            if (line.length === 0) {\n                // empty line\n                return undefined;\n            }\n            else if (column === 1) {\n                // look only right\n                if (/\\s/.test(line[0])) {\n                    return undefined;\n                }\n            }\n            else if (column === model.getLineMaxColumn(lineNumber)) {\n                // look only left\n                if (/\\s/.test(line[line.length - 1])) {\n                    return undefined;\n                }\n            }\n            else {\n                // look left and right\n                if (/\\s/.test(line[column - 2]) && /\\s/.test(line[column - 1])) {\n                    return undefined;\n                }\n            }\n        }\n        return selection;\n    }\n    _createEventAndSignalChange(trigger, selection) {\n        const model = this._editor.getModel();\n        if (!selection || !model) {\n            // cancel\n            this._signalChange(undefined);\n            return undefined;\n        }\n        const markerRange = this._getRangeOfMarker(selection);\n        const position = markerRange ? markerRange.getStartPosition() : selection.getStartPosition();\n        const e = {\n            trigger,\n            selection,\n            position\n        };\n        this._signalChange(e);\n        return e;\n    }\n}\nexport var CodeActionsState;\n(function (CodeActionsState) {\n    CodeActionsState.Empty = { type: 0 /* Empty */ };\n    class Triggered {\n        constructor(trigger, rangeOrSelection, position, _cancellablePromise) {\n            this.trigger = trigger;\n            this.rangeOrSelection = rangeOrSelection;\n            this.position = position;\n            this._cancellablePromise = _cancellablePromise;\n            this.type = 1 /* Triggered */;\n            this.actions = _cancellablePromise.catch((e) => {\n                if (isCancellationError(e)) {\n                    return emptyCodeActionSet;\n                }\n                throw e;\n            });\n        }\n        cancel() {\n            this._cancellablePromise.cancel();\n        }\n    }\n    CodeActionsState.Triggered = Triggered;\n})(CodeActionsState || (CodeActionsState = {}));\nconst emptyCodeActionSet = {\n    allActions: [],\n    validActions: [],\n    dispose: () => { },\n    documentation: [],\n    hasAutoFix: false\n};\nexport class CodeActionModel extends Disposable {\n    constructor(_editor, _markerService, contextKeyService, _progressService) {\n        super();\n        this._editor = _editor;\n        this._markerService = _markerService;\n        this._progressService = _progressService;\n        this._codeActionOracle = this._register(new MutableDisposable());\n        this._state = CodeActionsState.Empty;\n        this._onDidChangeState = this._register(new Emitter());\n        this.onDidChangeState = this._onDidChangeState.event;\n        _CodeActionModel_isDisposed.set(this, false);\n        this._supportedCodeActions = SUPPORTED_CODE_ACTIONS.bindTo(contextKeyService);\n        this._register(this._editor.onDidChangeModel(() => this._update()));\n        this._register(this._editor.onDidChangeModelLanguage(() => this._update()));\n        this._register(CodeActionProviderRegistry.onDidChange(() => this._update()));\n        this._update();\n    }\n    dispose() {\n        if (__classPrivateFieldGet(this, _CodeActionModel_isDisposed, \"f\")) {\n            return;\n        }\n        __classPrivateFieldSet(this, _CodeActionModel_isDisposed, true, \"f\");\n        super.dispose();\n        this.setState(CodeActionsState.Empty, true);\n    }\n    _update() {\n        if (__classPrivateFieldGet(this, _CodeActionModel_isDisposed, \"f\")) {\n            return;\n        }\n        this._codeActionOracle.value = undefined;\n        this.setState(CodeActionsState.Empty);\n        const model = this._editor.getModel();\n        if (model\n            && CodeActionProviderRegistry.has(model)\n            && !this._editor.getOption(81 /* readOnly */)) {\n            const supportedActions = [];\n            for (const provider of CodeActionProviderRegistry.all(model)) {\n                if (Array.isArray(provider.providedCodeActionKinds)) {\n                    supportedActions.push(...provider.providedCodeActionKinds);\n                }\n            }\n            this._supportedCodeActions.set(supportedActions.join(' '));\n            this._codeActionOracle.value = new CodeActionOracle(this._editor, this._markerService, trigger => {\n                var _a;\n                if (!trigger) {\n                    this.setState(CodeActionsState.Empty);\n                    return;\n                }\n                const actions = createCancelablePromise(token => getCodeActions(model, trigger.selection, trigger.trigger, Progress.None, token));\n                if (trigger.trigger.type === 1 /* Invoke */) {\n                    (_a = this._progressService) === null || _a === void 0 ? void 0 : _a.showWhile(actions, 250);\n                }\n                this.setState(new CodeActionsState.Triggered(trigger.trigger, trigger.selection, trigger.position, actions));\n            }, undefined);\n            this._codeActionOracle.value.trigger({ type: 2 /* Auto */ });\n        }\n        else {\n            this._supportedCodeActions.reset();\n        }\n    }\n    trigger(trigger) {\n        if (this._codeActionOracle.value) {\n            this._codeActionOracle.value.trigger(trigger);\n        }\n    }\n    setState(newState, skipNotify) {\n        if (newState === this._state) {\n            return;\n        }\n        // Cancel old request\n        if (this._state.type === 1 /* Triggered */) {\n            this._state.cancel();\n        }\n        this._state = newState;\n        if (!skipNotify && !__classPrivateFieldGet(this, _CodeActionModel_isDisposed, \"f\")) {\n            this._onDidChangeState.fire(newState);\n        }\n    }\n}\n_CodeActionModel_isDisposed = new WeakMap();\n"]},"metadata":{},"sourceType":"module"}