{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\n\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\n\nvar _CodeActionUi_disposed;\n\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { MessageController } from '../../message/browser/messageController.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { CodeActionMenu } from './codeActionMenu.js';\nimport { LightBulbWidget } from './lightBulbWidget.js';\nlet CodeActionUi = class CodeActionUi extends Disposable {\n  constructor(_editor, quickFixActionId, preferredFixActionId, delegate, instantiationService) {\n    super();\n    this._editor = _editor;\n    this.delegate = delegate;\n    this._activeCodeActions = this._register(new MutableDisposable());\n\n    _CodeActionUi_disposed.set(this, false);\n\n    this._codeActionWidget = new Lazy(() => {\n      return this._register(instantiationService.createInstance(CodeActionMenu, this._editor, {\n        onSelectCodeAction: action => __awaiter(this, void 0, void 0, function* () {\n          this.delegate.applyCodeAction(action,\n          /* retrigger */\n          true);\n        })\n      }));\n    });\n    this._lightBulbWidget = new Lazy(() => {\n      const widget = this._register(instantiationService.createInstance(LightBulbWidget, this._editor, quickFixActionId, preferredFixActionId));\n\n      this._register(widget.onClick(e => this.showCodeActionList(e.trigger, e.actions, e, {\n        includeDisabledActions: false\n      })));\n\n      return widget;\n    });\n  }\n\n  dispose() {\n    __classPrivateFieldSet(this, _CodeActionUi_disposed, true, \"f\");\n\n    super.dispose();\n  }\n\n  update(newState) {\n    var _a, _b, _c, _d, _e;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      if (newState.type !== 1\n      /* Triggered */\n      ) {\n        (_a = this._lightBulbWidget.rawValue) === null || _a === void 0 ? void 0 : _a.hide();\n        return;\n      }\n\n      let actions;\n\n      try {\n        actions = yield newState.actions;\n      } catch (e) {\n        onUnexpectedError(e);\n        return;\n      }\n\n      if (__classPrivateFieldGet(this, _CodeActionUi_disposed, \"f\")) {\n        return;\n      }\n\n      this._lightBulbWidget.getValue().update(actions, newState.trigger, newState.position);\n\n      if (newState.trigger.type === 1\n      /* Invoke */\n      ) {\n        if ((_b = newState.trigger.filter) === null || _b === void 0 ? void 0 : _b.include) {\n          // Triggered for specific scope\n          // Check to see if we want to auto apply.\n          const validActionToApply = this.tryGetValidActionToApply(newState.trigger, actions);\n\n          if (validActionToApply) {\n            try {\n              this._lightBulbWidget.getValue().hide();\n\n              yield this.delegate.applyCodeAction(validActionToApply, false);\n            } finally {\n              actions.dispose();\n            }\n\n            return;\n          } // Check to see if there is an action that we would have applied were it not invalid\n\n\n          if (newState.trigger.context) {\n            const invalidAction = this.getInvalidActionThatWouldHaveBeenApplied(newState.trigger, actions);\n\n            if (invalidAction && invalidAction.action.disabled) {\n              (_c = MessageController.get(this._editor)) === null || _c === void 0 ? void 0 : _c.showMessage(invalidAction.action.disabled, newState.trigger.context.position);\n              actions.dispose();\n              return;\n            }\n          }\n        }\n\n        const includeDisabledActions = !!((_d = newState.trigger.filter) === null || _d === void 0 ? void 0 : _d.include);\n\n        if (newState.trigger.context) {\n          if (!actions.allActions.length || !includeDisabledActions && !actions.validActions.length) {\n            (_e = MessageController.get(this._editor)) === null || _e === void 0 ? void 0 : _e.showMessage(newState.trigger.context.notAvailableMessage, newState.trigger.context.position);\n            this._activeCodeActions.value = actions;\n            actions.dispose();\n            return;\n          }\n        }\n\n        this._activeCodeActions.value = actions;\n\n        this._codeActionWidget.getValue().show(newState.trigger, actions, newState.position, {\n          includeDisabledActions\n        });\n      } else {\n        // auto magically triggered\n        if (this._codeActionWidget.getValue().isVisible) {\n          // TODO: Figure out if we should update the showing menu?\n          actions.dispose();\n        } else {\n          this._activeCodeActions.value = actions;\n        }\n      }\n    });\n  }\n\n  getInvalidActionThatWouldHaveBeenApplied(trigger, actions) {\n    if (!actions.allActions.length) {\n      return undefined;\n    }\n\n    if (trigger.autoApply === \"first\"\n    /* First */\n    && actions.validActions.length === 0 || trigger.autoApply === \"ifSingle\"\n    /* IfSingle */\n    && actions.allActions.length === 1) {\n      return actions.allActions.find(({\n        action\n      }) => action.disabled);\n    }\n\n    return undefined;\n  }\n\n  tryGetValidActionToApply(trigger, actions) {\n    if (!actions.validActions.length) {\n      return undefined;\n    }\n\n    if (trigger.autoApply === \"first\"\n    /* First */\n    && actions.validActions.length > 0 || trigger.autoApply === \"ifSingle\"\n    /* IfSingle */\n    && actions.validActions.length === 1) {\n      return actions.validActions[0];\n    }\n\n    return undefined;\n  }\n\n  showCodeActionList(trigger, actions, at, options) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this._codeActionWidget.getValue().show(trigger, actions, at, options);\n    });\n  }\n\n};\n_CodeActionUi_disposed = new WeakMap();\nCodeActionUi = __decorate([__param(4, IInstantiationService)], CodeActionUi);\nexport { CodeActionUi };","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/browser/codeActionUi.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__classPrivateFieldSet","receiver","state","kind","f","TypeError","has","call","set","__classPrivateFieldGet","get","_CodeActionUi_disposed","onUnexpectedError","Lazy","Disposable","MutableDisposable","MessageController","IInstantiationService","CodeActionMenu","LightBulbWidget","CodeActionUi","constructor","_editor","quickFixActionId","preferredFixActionId","delegate","instantiationService","_activeCodeActions","_register","_codeActionWidget","createInstance","onSelectCodeAction","action","applyCodeAction","_lightBulbWidget","widget","onClick","showCodeActionList","trigger","actions","includeDisabledActions","dispose","update","newState","_a","_b","_c","_d","_e","type","rawValue","hide","getValue","position","filter","include","validActionToApply","tryGetValidActionToApply","context","invalidAction","getInvalidActionThatWouldHaveBeenApplied","disabled","showMessage","allActions","validActions","notAvailableMessage","show","isVisible","undefined","autoApply","find","at","options","WeakMap"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _CodeActionUi_disposed;\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { MessageController } from '../../message/browser/messageController.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { CodeActionMenu } from './codeActionMenu.js';\nimport { LightBulbWidget } from './lightBulbWidget.js';\nlet CodeActionUi = class CodeActionUi extends Disposable {\n    constructor(_editor, quickFixActionId, preferredFixActionId, delegate, instantiationService) {\n        super();\n        this._editor = _editor;\n        this.delegate = delegate;\n        this._activeCodeActions = this._register(new MutableDisposable());\n        _CodeActionUi_disposed.set(this, false);\n        this._codeActionWidget = new Lazy(() => {\n            return this._register(instantiationService.createInstance(CodeActionMenu, this._editor, {\n                onSelectCodeAction: (action) => __awaiter(this, void 0, void 0, function* () {\n                    this.delegate.applyCodeAction(action, /* retrigger */ true);\n                })\n            }));\n        });\n        this._lightBulbWidget = new Lazy(() => {\n            const widget = this._register(instantiationService.createInstance(LightBulbWidget, this._editor, quickFixActionId, preferredFixActionId));\n            this._register(widget.onClick(e => this.showCodeActionList(e.trigger, e.actions, e, { includeDisabledActions: false })));\n            return widget;\n        });\n    }\n    dispose() {\n        __classPrivateFieldSet(this, _CodeActionUi_disposed, true, \"f\");\n        super.dispose();\n    }\n    update(newState) {\n        var _a, _b, _c, _d, _e;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (newState.type !== 1 /* Triggered */) {\n                (_a = this._lightBulbWidget.rawValue) === null || _a === void 0 ? void 0 : _a.hide();\n                return;\n            }\n            let actions;\n            try {\n                actions = yield newState.actions;\n            }\n            catch (e) {\n                onUnexpectedError(e);\n                return;\n            }\n            if (__classPrivateFieldGet(this, _CodeActionUi_disposed, \"f\")) {\n                return;\n            }\n            this._lightBulbWidget.getValue().update(actions, newState.trigger, newState.position);\n            if (newState.trigger.type === 1 /* Invoke */) {\n                if ((_b = newState.trigger.filter) === null || _b === void 0 ? void 0 : _b.include) { // Triggered for specific scope\n                    // Check to see if we want to auto apply.\n                    const validActionToApply = this.tryGetValidActionToApply(newState.trigger, actions);\n                    if (validActionToApply) {\n                        try {\n                            this._lightBulbWidget.getValue().hide();\n                            yield this.delegate.applyCodeAction(validActionToApply, false);\n                        }\n                        finally {\n                            actions.dispose();\n                        }\n                        return;\n                    }\n                    // Check to see if there is an action that we would have applied were it not invalid\n                    if (newState.trigger.context) {\n                        const invalidAction = this.getInvalidActionThatWouldHaveBeenApplied(newState.trigger, actions);\n                        if (invalidAction && invalidAction.action.disabled) {\n                            (_c = MessageController.get(this._editor)) === null || _c === void 0 ? void 0 : _c.showMessage(invalidAction.action.disabled, newState.trigger.context.position);\n                            actions.dispose();\n                            return;\n                        }\n                    }\n                }\n                const includeDisabledActions = !!((_d = newState.trigger.filter) === null || _d === void 0 ? void 0 : _d.include);\n                if (newState.trigger.context) {\n                    if (!actions.allActions.length || !includeDisabledActions && !actions.validActions.length) {\n                        (_e = MessageController.get(this._editor)) === null || _e === void 0 ? void 0 : _e.showMessage(newState.trigger.context.notAvailableMessage, newState.trigger.context.position);\n                        this._activeCodeActions.value = actions;\n                        actions.dispose();\n                        return;\n                    }\n                }\n                this._activeCodeActions.value = actions;\n                this._codeActionWidget.getValue().show(newState.trigger, actions, newState.position, { includeDisabledActions });\n            }\n            else {\n                // auto magically triggered\n                if (this._codeActionWidget.getValue().isVisible) {\n                    // TODO: Figure out if we should update the showing menu?\n                    actions.dispose();\n                }\n                else {\n                    this._activeCodeActions.value = actions;\n                }\n            }\n        });\n    }\n    getInvalidActionThatWouldHaveBeenApplied(trigger, actions) {\n        if (!actions.allActions.length) {\n            return undefined;\n        }\n        if ((trigger.autoApply === \"first\" /* First */ && actions.validActions.length === 0)\n            || (trigger.autoApply === \"ifSingle\" /* IfSingle */ && actions.allActions.length === 1)) {\n            return actions.allActions.find(({ action }) => action.disabled);\n        }\n        return undefined;\n    }\n    tryGetValidActionToApply(trigger, actions) {\n        if (!actions.validActions.length) {\n            return undefined;\n        }\n        if ((trigger.autoApply === \"first\" /* First */ && actions.validActions.length > 0)\n            || (trigger.autoApply === \"ifSingle\" /* IfSingle */ && actions.validActions.length === 1)) {\n            return actions.validActions[0];\n        }\n        return undefined;\n    }\n    showCodeActionList(trigger, actions, at, options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this._codeActionWidget.getValue().show(trigger, actions, at, options);\n        });\n    }\n};\n_CodeActionUi_disposed = new WeakMap();\nCodeActionUi = __decorate([\n    __param(4, IInstantiationService)\n], CodeActionUi);\nexport { CodeActionUi };\n"]},"metadata":{},"sourceType":"module"}