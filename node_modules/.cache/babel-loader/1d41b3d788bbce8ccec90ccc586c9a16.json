{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { defaultGenerator } from '../../../../base/common/idGenerator.js';\nimport { dispose } from '../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { basename, extUri } from '../../../../base/common/resources.js';\nimport * as strings from '../../../../base/common/strings.js';\nimport { Range } from '../../../common/core/range.js';\nimport { localize } from '../../../../nls.js';\nexport class OneReference {\n  constructor(isProviderFirst, parent, link, _rangeCallback) {\n    this.isProviderFirst = isProviderFirst;\n    this.parent = parent;\n    this.link = link;\n    this._rangeCallback = _rangeCallback;\n    this.id = defaultGenerator.nextId();\n  }\n\n  get uri() {\n    return this.link.uri;\n  }\n\n  get range() {\n    var _a, _b;\n\n    return (_b = (_a = this._range) !== null && _a !== void 0 ? _a : this.link.targetSelectionRange) !== null && _b !== void 0 ? _b : this.link.range;\n  }\n\n  set range(value) {\n    this._range = value;\n\n    this._rangeCallback(this);\n  }\n\n  get ariaMessage() {\n    var _a;\n\n    const preview = (_a = this.parent.getPreview(this)) === null || _a === void 0 ? void 0 : _a.preview(this.range);\n\n    if (!preview) {\n      return localize('aria.oneReference', \"symbol in {0} on line {1} at column {2}\", basename(this.uri), this.range.startLineNumber, this.range.startColumn);\n    } else {\n      return localize({\n        key: 'aria.oneReference.preview',\n        comment: ['Placeholders are: 0: filename, 1:line number, 2: column number, 3: preview snippet of source code']\n      }, \"symbol in {0} on line {1} at column {2}, {3}\", basename(this.uri), this.range.startLineNumber, this.range.startColumn, preview.value);\n    }\n  }\n\n}\nexport class FilePreview {\n  constructor(_modelReference) {\n    this._modelReference = _modelReference;\n  }\n\n  dispose() {\n    this._modelReference.dispose();\n  }\n\n  preview(range, n = 8) {\n    const model = this._modelReference.object.textEditorModel;\n\n    if (!model) {\n      return undefined;\n    }\n\n    const {\n      startLineNumber,\n      startColumn,\n      endLineNumber,\n      endColumn\n    } = range;\n    const word = model.getWordUntilPosition({\n      lineNumber: startLineNumber,\n      column: startColumn - n\n    });\n    const beforeRange = new Range(startLineNumber, word.startColumn, startLineNumber, startColumn);\n    const afterRange = new Range(endLineNumber, endColumn, endLineNumber, 1073741824\n    /* MAX_SAFE_SMALL_INTEGER */\n    );\n    const before = model.getValueInRange(beforeRange).replace(/^\\s+/, '');\n    const inside = model.getValueInRange(range);\n    const after = model.getValueInRange(afterRange).replace(/\\s+$/, '');\n    return {\n      value: before + inside + after,\n      highlight: {\n        start: before.length,\n        end: before.length + inside.length\n      }\n    };\n  }\n\n}\nexport class FileReferences {\n  constructor(parent, uri) {\n    this.parent = parent;\n    this.uri = uri;\n    this.children = [];\n    this._previews = new ResourceMap();\n  }\n\n  dispose() {\n    dispose(this._previews.values());\n\n    this._previews.clear();\n  }\n\n  getPreview(child) {\n    return this._previews.get(child.uri);\n  }\n\n  get ariaMessage() {\n    const len = this.children.length;\n\n    if (len === 1) {\n      return localize('aria.fileReferences.1', \"1 symbol in {0}, full path {1}\", basename(this.uri), this.uri.fsPath);\n    } else {\n      return localize('aria.fileReferences.N', \"{0} symbols in {1}, full path {2}\", len, basename(this.uri), this.uri.fsPath);\n    }\n  }\n\n  resolve(textModelResolverService) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._previews.size !== 0) {\n        return this;\n      }\n\n      for (let child of this.children) {\n        if (this._previews.has(child.uri)) {\n          continue;\n        }\n\n        try {\n          const ref = yield textModelResolverService.createModelReference(child.uri);\n\n          this._previews.set(child.uri, new FilePreview(ref));\n        } catch (err) {\n          onUnexpectedError(err);\n        }\n      }\n\n      return this;\n    });\n  }\n\n}\nexport class ReferencesModel {\n  constructor(links, title) {\n    this.groups = [];\n    this.references = [];\n    this._onDidChangeReferenceRange = new Emitter();\n    this.onDidChangeReferenceRange = this._onDidChangeReferenceRange.event;\n    this._links = links;\n    this._title = title; // grouping and sorting\n\n    const [providersFirst] = links;\n    links.sort(ReferencesModel._compareReferences);\n    let current;\n\n    for (let link of links) {\n      if (!current || !extUri.isEqual(current.uri, link.uri, true)) {\n        // new group\n        current = new FileReferences(this, link.uri);\n        this.groups.push(current);\n      } // append, check for equality first!\n\n\n      if (current.children.length === 0 || ReferencesModel._compareReferences(link, current.children[current.children.length - 1]) !== 0) {\n        const oneRef = new OneReference(providersFirst === link, current, link, ref => this._onDidChangeReferenceRange.fire(ref));\n        this.references.push(oneRef);\n        current.children.push(oneRef);\n      }\n    }\n  }\n\n  dispose() {\n    dispose(this.groups);\n\n    this._onDidChangeReferenceRange.dispose();\n\n    this.groups.length = 0;\n  }\n\n  clone() {\n    return new ReferencesModel(this._links, this._title);\n  }\n\n  get title() {\n    return this._title;\n  }\n\n  get isEmpty() {\n    return this.groups.length === 0;\n  }\n\n  get ariaMessage() {\n    if (this.isEmpty) {\n      return localize('aria.result.0', \"No results found\");\n    } else if (this.references.length === 1) {\n      return localize('aria.result.1', \"Found 1 symbol in {0}\", this.references[0].uri.fsPath);\n    } else if (this.groups.length === 1) {\n      return localize('aria.result.n1', \"Found {0} symbols in {1}\", this.references.length, this.groups[0].uri.fsPath);\n    } else {\n      return localize('aria.result.nm', \"Found {0} symbols in {1} files\", this.references.length, this.groups.length);\n    }\n  }\n\n  nextOrPreviousReference(reference, next) {\n    let {\n      parent\n    } = reference;\n    let idx = parent.children.indexOf(reference);\n    let childCount = parent.children.length;\n    let groupCount = parent.parent.groups.length;\n\n    if (groupCount === 1 || next && idx + 1 < childCount || !next && idx > 0) {\n      // cycling within one file\n      if (next) {\n        idx = (idx + 1) % childCount;\n      } else {\n        idx = (idx + childCount - 1) % childCount;\n      }\n\n      return parent.children[idx];\n    }\n\n    idx = parent.parent.groups.indexOf(parent);\n\n    if (next) {\n      idx = (idx + 1) % groupCount;\n      return parent.parent.groups[idx].children[0];\n    } else {\n      idx = (idx + groupCount - 1) % groupCount;\n      return parent.parent.groups[idx].children[parent.parent.groups[idx].children.length - 1];\n    }\n  }\n\n  nearestReference(resource, position) {\n    const nearest = this.references.map((ref, idx) => {\n      return {\n        idx,\n        prefixLen: strings.commonPrefixLength(ref.uri.toString(), resource.toString()),\n        offsetDist: Math.abs(ref.range.startLineNumber - position.lineNumber) * 100 + Math.abs(ref.range.startColumn - position.column)\n      };\n    }).sort((a, b) => {\n      if (a.prefixLen > b.prefixLen) {\n        return -1;\n      } else if (a.prefixLen < b.prefixLen) {\n        return 1;\n      } else if (a.offsetDist < b.offsetDist) {\n        return -1;\n      } else if (a.offsetDist > b.offsetDist) {\n        return 1;\n      } else {\n        return 0;\n      }\n    })[0];\n\n    if (nearest) {\n      return this.references[nearest.idx];\n    }\n\n    return undefined;\n  }\n\n  referenceAt(resource, position) {\n    for (const ref of this.references) {\n      if (ref.uri.toString() === resource.toString()) {\n        if (Range.containsPosition(ref.range, position)) {\n          return ref;\n        }\n      }\n    }\n\n    return undefined;\n  }\n\n  firstReference() {\n    for (const ref of this.references) {\n      if (ref.isProviderFirst) {\n        return ref;\n      }\n    }\n\n    return this.references[0];\n  }\n\n  static _compareReferences(a, b) {\n    return extUri.compare(a.uri, b.uri) || Range.compareRangesUsingStarts(a.range, b.range);\n  }\n\n}","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/gotoSymbol/browser/referencesModel.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","onUnexpectedError","Emitter","defaultGenerator","dispose","ResourceMap","basename","extUri","strings","Range","localize","OneReference","constructor","isProviderFirst","parent","link","_rangeCallback","id","nextId","uri","range","_a","_b","_range","targetSelectionRange","ariaMessage","preview","getPreview","startLineNumber","startColumn","key","comment","FilePreview","_modelReference","n","model","object","textEditorModel","undefined","endLineNumber","endColumn","word","getWordUntilPosition","lineNumber","column","beforeRange","afterRange","before","getValueInRange","replace","inside","after","highlight","start","length","end","FileReferences","children","_previews","values","clear","child","get","len","fsPath","textModelResolverService","size","has","ref","createModelReference","set","err","ReferencesModel","links","title","groups","references","_onDidChangeReferenceRange","onDidChangeReferenceRange","event","_links","_title","providersFirst","sort","_compareReferences","current","isEqual","push","oneRef","fire","clone","isEmpty","nextOrPreviousReference","reference","idx","indexOf","childCount","groupCount","nearestReference","resource","position","nearest","map","prefixLen","commonPrefixLength","toString","offsetDist","Math","abs","a","b","referenceAt","containsPosition","firstReference","compare","compareRangesUsingStarts"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { defaultGenerator } from '../../../../base/common/idGenerator.js';\nimport { dispose } from '../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { basename, extUri } from '../../../../base/common/resources.js';\nimport * as strings from '../../../../base/common/strings.js';\nimport { Range } from '../../../common/core/range.js';\nimport { localize } from '../../../../nls.js';\nexport class OneReference {\n    constructor(isProviderFirst, parent, link, _rangeCallback) {\n        this.isProviderFirst = isProviderFirst;\n        this.parent = parent;\n        this.link = link;\n        this._rangeCallback = _rangeCallback;\n        this.id = defaultGenerator.nextId();\n    }\n    get uri() {\n        return this.link.uri;\n    }\n    get range() {\n        var _a, _b;\n        return (_b = (_a = this._range) !== null && _a !== void 0 ? _a : this.link.targetSelectionRange) !== null && _b !== void 0 ? _b : this.link.range;\n    }\n    set range(value) {\n        this._range = value;\n        this._rangeCallback(this);\n    }\n    get ariaMessage() {\n        var _a;\n        const preview = (_a = this.parent.getPreview(this)) === null || _a === void 0 ? void 0 : _a.preview(this.range);\n        if (!preview) {\n            return localize('aria.oneReference', \"symbol in {0} on line {1} at column {2}\", basename(this.uri), this.range.startLineNumber, this.range.startColumn);\n        }\n        else {\n            return localize({ key: 'aria.oneReference.preview', comment: ['Placeholders are: 0: filename, 1:line number, 2: column number, 3: preview snippet of source code'] }, \"symbol in {0} on line {1} at column {2}, {3}\", basename(this.uri), this.range.startLineNumber, this.range.startColumn, preview.value);\n        }\n    }\n}\nexport class FilePreview {\n    constructor(_modelReference) {\n        this._modelReference = _modelReference;\n    }\n    dispose() {\n        this._modelReference.dispose();\n    }\n    preview(range, n = 8) {\n        const model = this._modelReference.object.textEditorModel;\n        if (!model) {\n            return undefined;\n        }\n        const { startLineNumber, startColumn, endLineNumber, endColumn } = range;\n        const word = model.getWordUntilPosition({ lineNumber: startLineNumber, column: startColumn - n });\n        const beforeRange = new Range(startLineNumber, word.startColumn, startLineNumber, startColumn);\n        const afterRange = new Range(endLineNumber, endColumn, endLineNumber, 1073741824 /* MAX_SAFE_SMALL_INTEGER */);\n        const before = model.getValueInRange(beforeRange).replace(/^\\s+/, '');\n        const inside = model.getValueInRange(range);\n        const after = model.getValueInRange(afterRange).replace(/\\s+$/, '');\n        return {\n            value: before + inside + after,\n            highlight: { start: before.length, end: before.length + inside.length }\n        };\n    }\n}\nexport class FileReferences {\n    constructor(parent, uri) {\n        this.parent = parent;\n        this.uri = uri;\n        this.children = [];\n        this._previews = new ResourceMap();\n    }\n    dispose() {\n        dispose(this._previews.values());\n        this._previews.clear();\n    }\n    getPreview(child) {\n        return this._previews.get(child.uri);\n    }\n    get ariaMessage() {\n        const len = this.children.length;\n        if (len === 1) {\n            return localize('aria.fileReferences.1', \"1 symbol in {0}, full path {1}\", basename(this.uri), this.uri.fsPath);\n        }\n        else {\n            return localize('aria.fileReferences.N', \"{0} symbols in {1}, full path {2}\", len, basename(this.uri), this.uri.fsPath);\n        }\n    }\n    resolve(textModelResolverService) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._previews.size !== 0) {\n                return this;\n            }\n            for (let child of this.children) {\n                if (this._previews.has(child.uri)) {\n                    continue;\n                }\n                try {\n                    const ref = yield textModelResolverService.createModelReference(child.uri);\n                    this._previews.set(child.uri, new FilePreview(ref));\n                }\n                catch (err) {\n                    onUnexpectedError(err);\n                }\n            }\n            return this;\n        });\n    }\n}\nexport class ReferencesModel {\n    constructor(links, title) {\n        this.groups = [];\n        this.references = [];\n        this._onDidChangeReferenceRange = new Emitter();\n        this.onDidChangeReferenceRange = this._onDidChangeReferenceRange.event;\n        this._links = links;\n        this._title = title;\n        // grouping and sorting\n        const [providersFirst] = links;\n        links.sort(ReferencesModel._compareReferences);\n        let current;\n        for (let link of links) {\n            if (!current || !extUri.isEqual(current.uri, link.uri, true)) {\n                // new group\n                current = new FileReferences(this, link.uri);\n                this.groups.push(current);\n            }\n            // append, check for equality first!\n            if (current.children.length === 0 || ReferencesModel._compareReferences(link, current.children[current.children.length - 1]) !== 0) {\n                const oneRef = new OneReference(providersFirst === link, current, link, ref => this._onDidChangeReferenceRange.fire(ref));\n                this.references.push(oneRef);\n                current.children.push(oneRef);\n            }\n        }\n    }\n    dispose() {\n        dispose(this.groups);\n        this._onDidChangeReferenceRange.dispose();\n        this.groups.length = 0;\n    }\n    clone() {\n        return new ReferencesModel(this._links, this._title);\n    }\n    get title() {\n        return this._title;\n    }\n    get isEmpty() {\n        return this.groups.length === 0;\n    }\n    get ariaMessage() {\n        if (this.isEmpty) {\n            return localize('aria.result.0', \"No results found\");\n        }\n        else if (this.references.length === 1) {\n            return localize('aria.result.1', \"Found 1 symbol in {0}\", this.references[0].uri.fsPath);\n        }\n        else if (this.groups.length === 1) {\n            return localize('aria.result.n1', \"Found {0} symbols in {1}\", this.references.length, this.groups[0].uri.fsPath);\n        }\n        else {\n            return localize('aria.result.nm', \"Found {0} symbols in {1} files\", this.references.length, this.groups.length);\n        }\n    }\n    nextOrPreviousReference(reference, next) {\n        let { parent } = reference;\n        let idx = parent.children.indexOf(reference);\n        let childCount = parent.children.length;\n        let groupCount = parent.parent.groups.length;\n        if (groupCount === 1 || next && idx + 1 < childCount || !next && idx > 0) {\n            // cycling within one file\n            if (next) {\n                idx = (idx + 1) % childCount;\n            }\n            else {\n                idx = (idx + childCount - 1) % childCount;\n            }\n            return parent.children[idx];\n        }\n        idx = parent.parent.groups.indexOf(parent);\n        if (next) {\n            idx = (idx + 1) % groupCount;\n            return parent.parent.groups[idx].children[0];\n        }\n        else {\n            idx = (idx + groupCount - 1) % groupCount;\n            return parent.parent.groups[idx].children[parent.parent.groups[idx].children.length - 1];\n        }\n    }\n    nearestReference(resource, position) {\n        const nearest = this.references.map((ref, idx) => {\n            return {\n                idx,\n                prefixLen: strings.commonPrefixLength(ref.uri.toString(), resource.toString()),\n                offsetDist: Math.abs(ref.range.startLineNumber - position.lineNumber) * 100 + Math.abs(ref.range.startColumn - position.column)\n            };\n        }).sort((a, b) => {\n            if (a.prefixLen > b.prefixLen) {\n                return -1;\n            }\n            else if (a.prefixLen < b.prefixLen) {\n                return 1;\n            }\n            else if (a.offsetDist < b.offsetDist) {\n                return -1;\n            }\n            else if (a.offsetDist > b.offsetDist) {\n                return 1;\n            }\n            else {\n                return 0;\n            }\n        })[0];\n        if (nearest) {\n            return this.references[nearest.idx];\n        }\n        return undefined;\n    }\n    referenceAt(resource, position) {\n        for (const ref of this.references) {\n            if (ref.uri.toString() === resource.toString()) {\n                if (Range.containsPosition(ref.range, position)) {\n                    return ref;\n                }\n            }\n        }\n        return undefined;\n    }\n    firstReference() {\n        for (const ref of this.references) {\n            if (ref.isProviderFirst) {\n                return ref;\n            }\n        }\n        return this.references[0];\n    }\n    static _compareReferences(a, b) {\n        return extUri.compare(a.uri, b.uri) || Range.compareRangesUsingStarts(a.range, b.range);\n    }\n}\n"]},"metadata":{},"sourceType":"module"}