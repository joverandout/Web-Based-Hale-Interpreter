{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { ActionViewItem } from '../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { Separator, SubmenuAction } from '../../../../base/common/actions.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { isIOS } from '../../../../base/common/platform.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport * as nls from '../../../../nls.js';\nimport { IMenuService, MenuId, SubmenuItemAction } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService, IContextViewService } from '../../../../platform/contextview/browser/contextView.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nlet ContextMenuController = class ContextMenuController {\n  constructor(editor, _contextMenuService, _contextViewService, _contextKeyService, _keybindingService, _menuService) {\n    this._contextMenuService = _contextMenuService;\n    this._contextViewService = _contextViewService;\n    this._contextKeyService = _contextKeyService;\n    this._keybindingService = _keybindingService;\n    this._menuService = _menuService;\n    this._toDispose = new DisposableStore();\n    this._contextMenuIsBeingShownCount = 0;\n    this._editor = editor;\n\n    this._toDispose.add(this._editor.onContextMenu(e => this._onContextMenu(e)));\n\n    this._toDispose.add(this._editor.onMouseWheel(e => {\n      if (this._contextMenuIsBeingShownCount > 0) {\n        const view = this._contextViewService.getContextViewElement();\n\n        const target = e.srcElement; // Event triggers on shadow root host first\n        // Check if the context view is under this host before hiding it #103169\n\n        if (!(target.shadowRoot && dom.getShadowRoot(view) === target.shadowRoot)) {\n          this._contextViewService.hideContextView();\n        }\n      }\n    }));\n\n    this._toDispose.add(this._editor.onKeyDown(e => {\n      if (e.keyCode === 58\n      /* ContextMenu */\n      ) {\n        // Chrome is funny like that\n        e.preventDefault();\n        e.stopPropagation();\n        this.showContextMenu();\n      }\n    }));\n  }\n\n  static get(editor) {\n    return editor.getContribution(ContextMenuController.ID);\n  }\n\n  _onContextMenu(e) {\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    if (!this._editor.getOption(20\n    /* contextmenu */\n    )) {\n      this._editor.focus(); // Ensure the cursor is at the position of the mouse click\n\n\n      if (e.target.position && !this._editor.getSelection().containsPosition(e.target.position)) {\n        this._editor.setPosition(e.target.position);\n      }\n\n      return; // Context menu is turned off through configuration\n    }\n\n    if (e.target.type === 12\n    /* OVERLAY_WIDGET */\n    ) {\n      return; // allow native menu on widgets to support right click on input field for example in find\n    }\n\n    if (e.target.type === 6\n    /* CONTENT_TEXT */\n    && e.target.detail.injectedText) {\n      return; // allow native menu on injected text\n    }\n\n    e.event.preventDefault();\n    e.event.stopPropagation();\n\n    if (e.target.type !== 6\n    /* CONTENT_TEXT */\n    && e.target.type !== 7\n    /* CONTENT_EMPTY */\n    && e.target.type !== 1\n    /* TEXTAREA */\n    ) {\n      return; // only support mouse click into text or native context menu key for now\n    } // Ensure the editor gets focus if it hasn't, so the right events are being sent to other contributions\n\n\n    this._editor.focus(); // Ensure the cursor is at the position of the mouse click\n\n\n    if (e.target.position) {\n      let hasSelectionAtPosition = false;\n\n      for (const selection of this._editor.getSelections()) {\n        if (selection.containsPosition(e.target.position)) {\n          hasSelectionAtPosition = true;\n          break;\n        }\n      }\n\n      if (!hasSelectionAtPosition) {\n        this._editor.setPosition(e.target.position);\n      }\n    } // Unless the user triggerd the context menu through Shift+F10, use the mouse position as menu position\n\n\n    let anchor = null;\n\n    if (e.target.type !== 1\n    /* TEXTAREA */\n    ) {\n      anchor = {\n        x: e.event.posx - 1,\n        width: 2,\n        y: e.event.posy - 1,\n        height: 2\n      };\n    } // Show the context menu\n\n\n    this.showContextMenu(anchor);\n  }\n\n  showContextMenu(anchor) {\n    if (!this._editor.getOption(20\n    /* contextmenu */\n    )) {\n      return; // Context menu is turned off through configuration\n    }\n\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    if (!this._contextMenuService) {\n      this._editor.focus();\n\n      return; // We need the context menu service to function\n    } // Find actions available for menu\n\n\n    const menuActions = this._getMenuActions(this._editor.getModel(), this._editor.isSimpleWidget ? MenuId.SimpleEditorContext : MenuId.EditorContext); // Show menu if we have actions to show\n\n\n    if (menuActions.length > 0) {\n      this._doShowContextMenu(menuActions, anchor);\n    }\n  }\n\n  _getMenuActions(model, menuId) {\n    const result = []; // get menu groups\n\n    const menu = this._menuService.createMenu(menuId, this._contextKeyService);\n\n    const groups = menu.getActions({\n      arg: model.uri\n    });\n    menu.dispose(); // translate them into other actions\n\n    for (let group of groups) {\n      const [, actions] = group;\n      let addedItems = 0;\n\n      for (const action of actions) {\n        if (action instanceof SubmenuItemAction) {\n          const subActions = this._getMenuActions(model, action.item.submenu);\n\n          if (subActions.length > 0) {\n            result.push(new SubmenuAction(action.id, action.label, subActions));\n            addedItems++;\n          }\n        } else {\n          result.push(action);\n          addedItems++;\n        }\n      }\n\n      if (addedItems) {\n        result.push(new Separator());\n      }\n    }\n\n    if (result.length) {\n      result.pop(); // remove last separator\n    }\n\n    return result;\n  }\n\n  _doShowContextMenu(actions, anchor = null) {\n    if (!this._editor.hasModel()) {\n      return;\n    } // Disable hover\n\n\n    const oldHoverSetting = this._editor.getOption(53\n    /* hover */\n    );\n\n    this._editor.updateOptions({\n      hover: {\n        enabled: false\n      }\n    });\n\n    if (!anchor) {\n      // Ensure selection is visible\n      this._editor.revealPosition(this._editor.getPosition(), 1\n      /* Immediate */\n      );\n\n      this._editor.render();\n\n      const cursorCoords = this._editor.getScrolledVisiblePosition(this._editor.getPosition()); // Translate to absolute editor position\n\n\n      const editorCoords = dom.getDomNodePagePosition(this._editor.getDomNode());\n      const posx = editorCoords.left + cursorCoords.left;\n      const posy = editorCoords.top + cursorCoords.top + cursorCoords.height;\n      anchor = {\n        x: posx,\n        y: posy\n      };\n    }\n\n    const useShadowDOM = this._editor.getOption(115\n    /* useShadowDOM */\n    ) && !isIOS; // Do not use shadow dom on IOS #122035\n    // Show menu\n\n    this._contextMenuIsBeingShownCount++;\n\n    this._contextMenuService.showContextMenu({\n      domForShadowRoot: useShadowDOM ? this._editor.getDomNode() : undefined,\n      getAnchor: () => anchor,\n      getActions: () => actions,\n      getActionViewItem: action => {\n        const keybinding = this._keybindingFor(action);\n\n        if (keybinding) {\n          return new ActionViewItem(action, action, {\n            label: true,\n            keybinding: keybinding.getLabel(),\n            isMenu: true\n          });\n        }\n\n        const customActionViewItem = action;\n\n        if (typeof customActionViewItem.getActionViewItem === 'function') {\n          return customActionViewItem.getActionViewItem();\n        }\n\n        return new ActionViewItem(action, action, {\n          icon: true,\n          label: true,\n          isMenu: true\n        });\n      },\n      getKeyBinding: action => {\n        return this._keybindingFor(action);\n      },\n      onHide: wasCancelled => {\n        this._contextMenuIsBeingShownCount--;\n\n        this._editor.focus();\n\n        this._editor.updateOptions({\n          hover: oldHoverSetting\n        });\n      }\n    });\n  }\n\n  _keybindingFor(action) {\n    return this._keybindingService.lookupKeybinding(action.id);\n  }\n\n  dispose() {\n    if (this._contextMenuIsBeingShownCount > 0) {\n      this._contextViewService.hideContextView();\n    }\n\n    this._toDispose.dispose();\n  }\n\n};\nContextMenuController.ID = 'editor.contrib.contextmenu';\nContextMenuController = __decorate([__param(1, IContextMenuService), __param(2, IContextViewService), __param(3, IContextKeyService), __param(4, IKeybindingService), __param(5, IMenuService)], ContextMenuController);\nexport { ContextMenuController };\n\nclass ShowContextMenu extends EditorAction {\n  constructor() {\n    super({\n      id: 'editor.action.showContextMenu',\n      label: nls.localize('action.showContextMenu.label', \"Show Editor Context Menu\"),\n      alias: 'Show Editor Context Menu',\n      precondition: undefined,\n      kbOpts: {\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 1024\n        /* Shift */\n        | 68\n        /* F10 */\n        ,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  run(accessor, editor) {\n    var _a;\n\n    (_a = ContextMenuController.get(editor)) === null || _a === void 0 ? void 0 : _a.showContextMenu();\n  }\n\n}\n\nregisterEditorContribution(ContextMenuController.ID, ContextMenuController);\nregisterEditorAction(ShowContextMenu);","map":{"version":3,"sources":["/home/joe/DISSY/flask_test_1/react-flask-app/node_modules/monaco-editor/esm/vs/editor/contrib/contextmenu/browser/contextmenu.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","dom","ActionViewItem","Separator","SubmenuAction","DisposableStore","isIOS","EditorAction","registerEditorAction","registerEditorContribution","EditorContextKeys","nls","IMenuService","MenuId","SubmenuItemAction","IContextKeyService","IContextMenuService","IContextViewService","IKeybindingService","ContextMenuController","constructor","editor","_contextMenuService","_contextViewService","_contextKeyService","_keybindingService","_menuService","_toDispose","_contextMenuIsBeingShownCount","_editor","add","onContextMenu","e","_onContextMenu","onMouseWheel","view","getContextViewElement","srcElement","shadowRoot","getShadowRoot","hideContextView","onKeyDown","keyCode","preventDefault","stopPropagation","showContextMenu","get","getContribution","ID","hasModel","getOption","focus","position","getSelection","containsPosition","setPosition","type","detail","injectedText","event","hasSelectionAtPosition","selection","getSelections","anchor","x","posx","width","y","posy","height","menuActions","_getMenuActions","getModel","isSimpleWidget","SimpleEditorContext","EditorContext","_doShowContextMenu","model","menuId","result","menu","createMenu","groups","getActions","arg","uri","dispose","group","actions","addedItems","action","subActions","item","submenu","push","id","label","pop","oldHoverSetting","updateOptions","hover","enabled","revealPosition","getPosition","render","cursorCoords","getScrolledVisiblePosition","editorCoords","getDomNodePagePosition","getDomNode","left","top","useShadowDOM","domForShadowRoot","undefined","getAnchor","getActionViewItem","keybinding","_keybindingFor","getLabel","isMenu","customActionViewItem","icon","getKeyBinding","onHide","wasCancelled","lookupKeybinding","ShowContextMenu","localize","alias","precondition","kbOpts","kbExpr","textInputFocus","primary","weight","run","accessor","_a"],"mappings":"AAAA;AACA;AACA;AACA;AACA,IAAIA,UAAU,GAAI,QAAQ,KAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BC,CAAC,GAAGH,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGK,MAAM,CAACC,wBAAP,CAAgCR,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HO,CAA3H;AACA,MAAI,OAAOC,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EL,CAAC,GAAGI,OAAO,CAACC,QAAR,CAAiBZ,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIU,CAAC,GAAGb,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCO,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD,IAAIH,CAAC,GAAGV,UAAU,CAACa,CAAD,CAAlB,EAAuBN,CAAC,GAAG,CAACH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACH,CAAD,CAAT,GAAeH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACT,MAAD,EAASC,GAAT,EAAcK,CAAd,CAAT,GAA4BG,CAAC,CAACT,MAAD,EAASC,GAAT,CAA7C,KAA+DK,CAAnE;AAC7E,SAAOH,CAAC,GAAG,CAAJ,IAASG,CAAT,IAAcC,MAAM,CAACM,cAAP,CAAsBb,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;;AAMA,IAAIQ,OAAO,GAAI,QAAQ,KAAKA,OAAd,IAA0B,UAAUC,UAAV,EAAsBC,SAAtB,EAAiC;AACrE,SAAO,UAAUhB,MAAV,EAAkBC,GAAlB,EAAuB;AAAEe,IAAAA,SAAS,CAAChB,MAAD,EAASC,GAAT,EAAcc,UAAd,CAAT;AAAqC,GAArE;AACH,CAFD;;AAGA,OAAO,KAAKE,GAAZ,MAAqB,iCAArB;AACA,SAASC,cAAT,QAA+B,0DAA/B;AACA,SAASC,SAAT,EAAoBC,aAApB,QAAyC,oCAAzC;AACA,SAASC,eAAT,QAAgC,sCAAhC;AACA,SAASC,KAAT,QAAsB,qCAAtB;AACA,SAASC,YAAT,EAAuBC,oBAAvB,EAA6CC,0BAA7C,QAA+E,sCAA/E;AACA,SAASC,iBAAT,QAAkC,sCAAlC;AACA,OAAO,KAAKC,GAAZ,MAAqB,oBAArB;AACA,SAASC,YAAT,EAAuBC,MAAvB,EAA+BC,iBAA/B,QAAwD,gDAAxD;AACA,SAASC,kBAAT,QAAmC,sDAAnC;AACA,SAASC,mBAAT,EAA8BC,mBAA9B,QAAyD,yDAAzD;AACA,SAASC,kBAAT,QAAmC,sDAAnC;AACA,IAAIC,qBAAqB,GAAG,MAAMA,qBAAN,CAA4B;AACpDC,EAAAA,WAAW,CAACC,MAAD,EAASC,mBAAT,EAA8BC,mBAA9B,EAAmDC,kBAAnD,EAAuEC,kBAAvE,EAA2FC,YAA3F,EAAyG;AAChH,SAAKJ,mBAAL,GAA2BA,mBAA3B;AACA,SAAKC,mBAAL,GAA2BA,mBAA3B;AACA,SAAKC,kBAAL,GAA0BA,kBAA1B;AACA,SAAKC,kBAAL,GAA0BA,kBAA1B;AACA,SAAKC,YAAL,GAAoBA,YAApB;AACA,SAAKC,UAAL,GAAkB,IAAItB,eAAJ,EAAlB;AACA,SAAKuB,6BAAL,GAAqC,CAArC;AACA,SAAKC,OAAL,GAAeR,MAAf;;AACA,SAAKM,UAAL,CAAgBG,GAAhB,CAAoB,KAAKD,OAAL,CAAaE,aAAb,CAA4BC,CAAD,IAAO,KAAKC,cAAL,CAAoBD,CAApB,CAAlC,CAApB;;AACA,SAAKL,UAAL,CAAgBG,GAAhB,CAAoB,KAAKD,OAAL,CAAaK,YAAb,CAA2BF,CAAD,IAAO;AACjD,UAAI,KAAKJ,6BAAL,GAAqC,CAAzC,EAA4C;AACxC,cAAMO,IAAI,GAAG,KAAKZ,mBAAL,CAAyBa,qBAAzB,EAAb;;AACA,cAAMpD,MAAM,GAAGgD,CAAC,CAACK,UAAjB,CAFwC,CAGxC;AACA;;AACA,YAAI,EAAErD,MAAM,CAACsD,UAAP,IAAqBrC,GAAG,CAACsC,aAAJ,CAAkBJ,IAAlB,MAA4BnD,MAAM,CAACsD,UAA1D,CAAJ,EAA2E;AACvE,eAAKf,mBAAL,CAAyBiB,eAAzB;AACH;AACJ;AACJ,KAVmB,CAApB;;AAWA,SAAKb,UAAL,CAAgBG,GAAhB,CAAoB,KAAKD,OAAL,CAAaY,SAAb,CAAwBT,CAAD,IAAO;AAC9C,UAAIA,CAAC,CAACU,OAAF,KAAc;AAAG;AAArB,QAAwC;AACpC;AACAV,QAAAA,CAAC,CAACW,cAAF;AACAX,QAAAA,CAAC,CAACY,eAAF;AACA,aAAKC,eAAL;AACH;AACJ,KAPmB,CAApB;AAQH;;AACS,SAAHC,GAAG,CAACzB,MAAD,EAAS;AACf,WAAOA,MAAM,CAAC0B,eAAP,CAAuB5B,qBAAqB,CAAC6B,EAA7C,CAAP;AACH;;AACDf,EAAAA,cAAc,CAACD,CAAD,EAAI;AACd,QAAI,CAAC,KAAKH,OAAL,CAAaoB,QAAb,EAAL,EAA8B;AAC1B;AACH;;AACD,QAAI,CAAC,KAAKpB,OAAL,CAAaqB,SAAb,CAAuB;AAAG;AAA1B,KAAL,EAAmD;AAC/C,WAAKrB,OAAL,CAAasB,KAAb,GAD+C,CAE/C;;;AACA,UAAInB,CAAC,CAAChD,MAAF,CAASoE,QAAT,IAAqB,CAAC,KAAKvB,OAAL,CAAawB,YAAb,GAA4BC,gBAA5B,CAA6CtB,CAAC,CAAChD,MAAF,CAASoE,QAAtD,CAA1B,EAA2F;AACvF,aAAKvB,OAAL,CAAa0B,WAAb,CAAyBvB,CAAC,CAAChD,MAAF,CAASoE,QAAlC;AACH;;AACD,aAN+C,CAMvC;AACX;;AACD,QAAIpB,CAAC,CAAChD,MAAF,CAASwE,IAAT,KAAkB;AAAG;AAAzB,MAA+C;AAC3C,aAD2C,CACnC;AACX;;AACD,QAAIxB,CAAC,CAAChD,MAAF,CAASwE,IAAT,KAAkB;AAAE;AAApB,OAA0CxB,CAAC,CAAChD,MAAF,CAASyE,MAAT,CAAgBC,YAA9D,EAA4E;AACxE,aADwE,CAChE;AACX;;AACD1B,IAAAA,CAAC,CAAC2B,KAAF,CAAQhB,cAAR;AACAX,IAAAA,CAAC,CAAC2B,KAAF,CAAQf,eAAR;;AACA,QAAIZ,CAAC,CAAChD,MAAF,CAASwE,IAAT,KAAkB;AAAE;AAApB,OAA0CxB,CAAC,CAAChD,MAAF,CAASwE,IAAT,KAAkB;AAAE;AAA9D,OAAqFxB,CAAC,CAAChD,MAAF,CAASwE,IAAT,KAAkB;AAAE;AAA7G,MAA6H;AACzH,aADyH,CACjH;AACX,KAtBa,CAuBd;;;AACA,SAAK3B,OAAL,CAAasB,KAAb,GAxBc,CAyBd;;;AACA,QAAInB,CAAC,CAAChD,MAAF,CAASoE,QAAb,EAAuB;AACnB,UAAIQ,sBAAsB,GAAG,KAA7B;;AACA,WAAK,MAAMC,SAAX,IAAwB,KAAKhC,OAAL,CAAaiC,aAAb,EAAxB,EAAsD;AAClD,YAAID,SAAS,CAACP,gBAAV,CAA2BtB,CAAC,CAAChD,MAAF,CAASoE,QAApC,CAAJ,EAAmD;AAC/CQ,UAAAA,sBAAsB,GAAG,IAAzB;AACA;AACH;AACJ;;AACD,UAAI,CAACA,sBAAL,EAA6B;AACzB,aAAK/B,OAAL,CAAa0B,WAAb,CAAyBvB,CAAC,CAAChD,MAAF,CAASoE,QAAlC;AACH;AACJ,KArCa,CAsCd;;;AACA,QAAIW,MAAM,GAAG,IAAb;;AACA,QAAI/B,CAAC,CAAChD,MAAF,CAASwE,IAAT,KAAkB;AAAE;AAAxB,MAAwC;AACpCO,MAAAA,MAAM,GAAG;AAAEC,QAAAA,CAAC,EAAEhC,CAAC,CAAC2B,KAAF,CAAQM,IAAR,GAAe,CAApB;AAAuBC,QAAAA,KAAK,EAAE,CAA9B;AAAiCC,QAAAA,CAAC,EAAEnC,CAAC,CAAC2B,KAAF,CAAQS,IAAR,GAAe,CAAnD;AAAsDC,QAAAA,MAAM,EAAE;AAA9D,OAAT;AACH,KA1Ca,CA2Cd;;;AACA,SAAKxB,eAAL,CAAqBkB,MAArB;AACH;;AACDlB,EAAAA,eAAe,CAACkB,MAAD,EAAS;AACpB,QAAI,CAAC,KAAKlC,OAAL,CAAaqB,SAAb,CAAuB;AAAG;AAA1B,KAAL,EAAmD;AAC/C,aAD+C,CACvC;AACX;;AACD,QAAI,CAAC,KAAKrB,OAAL,CAAaoB,QAAb,EAAL,EAA8B;AAC1B;AACH;;AACD,QAAI,CAAC,KAAK3B,mBAAV,EAA+B;AAC3B,WAAKO,OAAL,CAAasB,KAAb;;AACA,aAF2B,CAEnB;AACX,KAVmB,CAWpB;;;AACA,UAAMmB,WAAW,GAAG,KAAKC,eAAL,CAAqB,KAAK1C,OAAL,CAAa2C,QAAb,EAArB,EAA8C,KAAK3C,OAAL,CAAa4C,cAAb,GAA8B5D,MAAM,CAAC6D,mBAArC,GAA2D7D,MAAM,CAAC8D,aAAhH,CAApB,CAZoB,CAapB;;;AACA,QAAIL,WAAW,CAACjF,MAAZ,GAAqB,CAAzB,EAA4B;AACxB,WAAKuF,kBAAL,CAAwBN,WAAxB,EAAqCP,MAArC;AACH;AACJ;;AACDQ,EAAAA,eAAe,CAACM,KAAD,EAAQC,MAAR,EAAgB;AAC3B,UAAMC,MAAM,GAAG,EAAf,CAD2B,CAE3B;;AACA,UAAMC,IAAI,GAAG,KAAKtD,YAAL,CAAkBuD,UAAlB,CAA6BH,MAA7B,EAAqC,KAAKtD,kBAA1C,CAAb;;AACA,UAAM0D,MAAM,GAAGF,IAAI,CAACG,UAAL,CAAgB;AAAEC,MAAAA,GAAG,EAAEP,KAAK,CAACQ;AAAb,KAAhB,CAAf;AACAL,IAAAA,IAAI,CAACM,OAAL,GAL2B,CAM3B;;AACA,SAAK,IAAIC,KAAT,IAAkBL,MAAlB,EAA0B;AACtB,YAAM,GAAGM,OAAH,IAAcD,KAApB;AACA,UAAIE,UAAU,GAAG,CAAjB;;AACA,WAAK,MAAMC,MAAX,IAAqBF,OAArB,EAA8B;AAC1B,YAAIE,MAAM,YAAY5E,iBAAtB,EAAyC;AACrC,gBAAM6E,UAAU,GAAG,KAAKpB,eAAL,CAAqBM,KAArB,EAA4Ba,MAAM,CAACE,IAAP,CAAYC,OAAxC,CAAnB;;AACA,cAAIF,UAAU,CAACtG,MAAX,GAAoB,CAAxB,EAA2B;AACvB0F,YAAAA,MAAM,CAACe,IAAP,CAAY,IAAI1F,aAAJ,CAAkBsF,MAAM,CAACK,EAAzB,EAA6BL,MAAM,CAACM,KAApC,EAA2CL,UAA3C,CAAZ;AACAF,YAAAA,UAAU;AACb;AACJ,SAND,MAOK;AACDV,UAAAA,MAAM,CAACe,IAAP,CAAYJ,MAAZ;AACAD,UAAAA,UAAU;AACb;AACJ;;AACD,UAAIA,UAAJ,EAAgB;AACZV,QAAAA,MAAM,CAACe,IAAP,CAAY,IAAI3F,SAAJ,EAAZ;AACH;AACJ;;AACD,QAAI4E,MAAM,CAAC1F,MAAX,EAAmB;AACf0F,MAAAA,MAAM,CAACkB,GAAP,GADe,CACD;AACjB;;AACD,WAAOlB,MAAP;AACH;;AACDH,EAAAA,kBAAkB,CAACY,OAAD,EAAUzB,MAAM,GAAG,IAAnB,EAAyB;AACvC,QAAI,CAAC,KAAKlC,OAAL,CAAaoB,QAAb,EAAL,EAA8B;AAC1B;AACH,KAHsC,CAIvC;;;AACA,UAAMiD,eAAe,GAAG,KAAKrE,OAAL,CAAaqB,SAAb,CAAuB;AAAG;AAA1B,KAAxB;;AACA,SAAKrB,OAAL,CAAasE,aAAb,CAA2B;AACvBC,MAAAA,KAAK,EAAE;AACHC,QAAAA,OAAO,EAAE;AADN;AADgB,KAA3B;;AAKA,QAAI,CAACtC,MAAL,EAAa;AACT;AACA,WAAKlC,OAAL,CAAayE,cAAb,CAA4B,KAAKzE,OAAL,CAAa0E,WAAb,EAA5B,EAAwD;AAAE;AAA1D;;AACA,WAAK1E,OAAL,CAAa2E,MAAb;;AACA,YAAMC,YAAY,GAAG,KAAK5E,OAAL,CAAa6E,0BAAb,CAAwC,KAAK7E,OAAL,CAAa0E,WAAb,EAAxC,CAArB,CAJS,CAKT;;;AACA,YAAMI,YAAY,GAAG1G,GAAG,CAAC2G,sBAAJ,CAA2B,KAAK/E,OAAL,CAAagF,UAAb,EAA3B,CAArB;AACA,YAAM5C,IAAI,GAAG0C,YAAY,CAACG,IAAb,GAAoBL,YAAY,CAACK,IAA9C;AACA,YAAM1C,IAAI,GAAGuC,YAAY,CAACI,GAAb,GAAmBN,YAAY,CAACM,GAAhC,GAAsCN,YAAY,CAACpC,MAAhE;AACAN,MAAAA,MAAM,GAAG;AAAEC,QAAAA,CAAC,EAAEC,IAAL;AAAWE,QAAAA,CAAC,EAAEC;AAAd,OAAT;AACH;;AACD,UAAM4C,YAAY,GAAG,KAAKnF,OAAL,CAAaqB,SAAb,CAAuB;AAAI;AAA3B,SAAkD,CAAC5C,KAAxE,CAtBuC,CAsBwC;AAC/E;;AACA,SAAKsB,6BAAL;;AACA,SAAKN,mBAAL,CAAyBuB,eAAzB,CAAyC;AACrCoE,MAAAA,gBAAgB,EAAED,YAAY,GAAG,KAAKnF,OAAL,CAAagF,UAAb,EAAH,GAA+BK,SADxB;AAErCC,MAAAA,SAAS,EAAE,MAAMpD,MAFoB;AAGrCoB,MAAAA,UAAU,EAAE,MAAMK,OAHmB;AAIrC4B,MAAAA,iBAAiB,EAAG1B,MAAD,IAAY;AAC3B,cAAM2B,UAAU,GAAG,KAAKC,cAAL,CAAoB5B,MAApB,CAAnB;;AACA,YAAI2B,UAAJ,EAAgB;AACZ,iBAAO,IAAInH,cAAJ,CAAmBwF,MAAnB,EAA2BA,MAA3B,EAAmC;AAAEM,YAAAA,KAAK,EAAE,IAAT;AAAeqB,YAAAA,UAAU,EAAEA,UAAU,CAACE,QAAX,EAA3B;AAAkDC,YAAAA,MAAM,EAAE;AAA1D,WAAnC,CAAP;AACH;;AACD,cAAMC,oBAAoB,GAAG/B,MAA7B;;AACA,YAAI,OAAO+B,oBAAoB,CAACL,iBAA5B,KAAkD,UAAtD,EAAkE;AAC9D,iBAAOK,oBAAoB,CAACL,iBAArB,EAAP;AACH;;AACD,eAAO,IAAIlH,cAAJ,CAAmBwF,MAAnB,EAA2BA,MAA3B,EAAmC;AAAEgC,UAAAA,IAAI,EAAE,IAAR;AAAc1B,UAAAA,KAAK,EAAE,IAArB;AAA2BwB,UAAAA,MAAM,EAAE;AAAnC,SAAnC,CAAP;AACH,OAdoC;AAerCG,MAAAA,aAAa,EAAGjC,MAAD,IAAY;AACvB,eAAO,KAAK4B,cAAL,CAAoB5B,MAApB,CAAP;AACH,OAjBoC;AAkBrCkC,MAAAA,MAAM,EAAGC,YAAD,IAAkB;AACtB,aAAKjG,6BAAL;;AACA,aAAKC,OAAL,CAAasB,KAAb;;AACA,aAAKtB,OAAL,CAAasE,aAAb,CAA2B;AACvBC,UAAAA,KAAK,EAAEF;AADgB,SAA3B;AAGH;AAxBoC,KAAzC;AA0BH;;AACDoB,EAAAA,cAAc,CAAC5B,MAAD,EAAS;AACnB,WAAO,KAAKjE,kBAAL,CAAwBqG,gBAAxB,CAAyCpC,MAAM,CAACK,EAAhD,CAAP;AACH;;AACDT,EAAAA,OAAO,GAAG;AACN,QAAI,KAAK1D,6BAAL,GAAqC,CAAzC,EAA4C;AACxC,WAAKL,mBAAL,CAAyBiB,eAAzB;AACH;;AACD,SAAKb,UAAL,CAAgB2D,OAAhB;AACH;;AA9LmD,CAAxD;AAgMAnE,qBAAqB,CAAC6B,EAAtB,GAA2B,4BAA3B;AACA7B,qBAAqB,GAAGrC,UAAU,CAAC,CAC/BgB,OAAO,CAAC,CAAD,EAAIkB,mBAAJ,CADwB,EAE/BlB,OAAO,CAAC,CAAD,EAAImB,mBAAJ,CAFwB,EAG/BnB,OAAO,CAAC,CAAD,EAAIiB,kBAAJ,CAHwB,EAI/BjB,OAAO,CAAC,CAAD,EAAIoB,kBAAJ,CAJwB,EAK/BpB,OAAO,CAAC,CAAD,EAAIc,YAAJ,CALwB,CAAD,EAM/BO,qBAN+B,CAAlC;AAOA,SAASA,qBAAT;;AACA,MAAM4G,eAAN,SAA8BxH,YAA9B,CAA2C;AACvCa,EAAAA,WAAW,GAAG;AACV,UAAM;AACF2E,MAAAA,EAAE,EAAE,+BADF;AAEFC,MAAAA,KAAK,EAAErF,GAAG,CAACqH,QAAJ,CAAa,8BAAb,EAA6C,0BAA7C,CAFL;AAGFC,MAAAA,KAAK,EAAE,0BAHL;AAIFC,MAAAA,YAAY,EAAEhB,SAJZ;AAKFiB,MAAAA,MAAM,EAAE;AACJC,QAAAA,MAAM,EAAE1H,iBAAiB,CAAC2H,cADtB;AAEJC,QAAAA,OAAO,EAAE;AAAK;AAAL,UAAmB;AAAG;AAF3B;AAGJC,QAAAA,MAAM,EAAE;AAAI;;AAHR;AALN,KAAN;AAWH;;AACDC,EAAAA,GAAG,CAACC,QAAD,EAAWpH,MAAX,EAAmB;AAClB,QAAIqH,EAAJ;;AACA,KAACA,EAAE,GAAGvH,qBAAqB,CAAC2B,GAAtB,CAA0BzB,MAA1B,CAAN,MAA6C,IAA7C,IAAqDqH,EAAE,KAAK,KAAK,CAAjE,GAAqE,KAAK,CAA1E,GAA8EA,EAAE,CAAC7F,eAAH,EAA9E;AACH;;AAjBsC;;AAmB3CpC,0BAA0B,CAACU,qBAAqB,CAAC6B,EAAvB,EAA2B7B,qBAA3B,CAA1B;AACAX,oBAAoB,CAACuH,eAAD,CAApB","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport * as dom from '../../../../base/browser/dom.js';\nimport { ActionViewItem } from '../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { Separator, SubmenuAction } from '../../../../base/common/actions.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { isIOS } from '../../../../base/common/platform.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport * as nls from '../../../../nls.js';\nimport { IMenuService, MenuId, SubmenuItemAction } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService, IContextViewService } from '../../../../platform/contextview/browser/contextView.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nlet ContextMenuController = class ContextMenuController {\n    constructor(editor, _contextMenuService, _contextViewService, _contextKeyService, _keybindingService, _menuService) {\n        this._contextMenuService = _contextMenuService;\n        this._contextViewService = _contextViewService;\n        this._contextKeyService = _contextKeyService;\n        this._keybindingService = _keybindingService;\n        this._menuService = _menuService;\n        this._toDispose = new DisposableStore();\n        this._contextMenuIsBeingShownCount = 0;\n        this._editor = editor;\n        this._toDispose.add(this._editor.onContextMenu((e) => this._onContextMenu(e)));\n        this._toDispose.add(this._editor.onMouseWheel((e) => {\n            if (this._contextMenuIsBeingShownCount > 0) {\n                const view = this._contextViewService.getContextViewElement();\n                const target = e.srcElement;\n                // Event triggers on shadow root host first\n                // Check if the context view is under this host before hiding it #103169\n                if (!(target.shadowRoot && dom.getShadowRoot(view) === target.shadowRoot)) {\n                    this._contextViewService.hideContextView();\n                }\n            }\n        }));\n        this._toDispose.add(this._editor.onKeyDown((e) => {\n            if (e.keyCode === 58 /* ContextMenu */) {\n                // Chrome is funny like that\n                e.preventDefault();\n                e.stopPropagation();\n                this.showContextMenu();\n            }\n        }));\n    }\n    static get(editor) {\n        return editor.getContribution(ContextMenuController.ID);\n    }\n    _onContextMenu(e) {\n        if (!this._editor.hasModel()) {\n            return;\n        }\n        if (!this._editor.getOption(20 /* contextmenu */)) {\n            this._editor.focus();\n            // Ensure the cursor is at the position of the mouse click\n            if (e.target.position && !this._editor.getSelection().containsPosition(e.target.position)) {\n                this._editor.setPosition(e.target.position);\n            }\n            return; // Context menu is turned off through configuration\n        }\n        if (e.target.type === 12 /* OVERLAY_WIDGET */) {\n            return; // allow native menu on widgets to support right click on input field for example in find\n        }\n        if (e.target.type === 6 /* CONTENT_TEXT */ && e.target.detail.injectedText) {\n            return; // allow native menu on injected text\n        }\n        e.event.preventDefault();\n        e.event.stopPropagation();\n        if (e.target.type !== 6 /* CONTENT_TEXT */ && e.target.type !== 7 /* CONTENT_EMPTY */ && e.target.type !== 1 /* TEXTAREA */) {\n            return; // only support mouse click into text or native context menu key for now\n        }\n        // Ensure the editor gets focus if it hasn't, so the right events are being sent to other contributions\n        this._editor.focus();\n        // Ensure the cursor is at the position of the mouse click\n        if (e.target.position) {\n            let hasSelectionAtPosition = false;\n            for (const selection of this._editor.getSelections()) {\n                if (selection.containsPosition(e.target.position)) {\n                    hasSelectionAtPosition = true;\n                    break;\n                }\n            }\n            if (!hasSelectionAtPosition) {\n                this._editor.setPosition(e.target.position);\n            }\n        }\n        // Unless the user triggerd the context menu through Shift+F10, use the mouse position as menu position\n        let anchor = null;\n        if (e.target.type !== 1 /* TEXTAREA */) {\n            anchor = { x: e.event.posx - 1, width: 2, y: e.event.posy - 1, height: 2 };\n        }\n        // Show the context menu\n        this.showContextMenu(anchor);\n    }\n    showContextMenu(anchor) {\n        if (!this._editor.getOption(20 /* contextmenu */)) {\n            return; // Context menu is turned off through configuration\n        }\n        if (!this._editor.hasModel()) {\n            return;\n        }\n        if (!this._contextMenuService) {\n            this._editor.focus();\n            return; // We need the context menu service to function\n        }\n        // Find actions available for menu\n        const menuActions = this._getMenuActions(this._editor.getModel(), this._editor.isSimpleWidget ? MenuId.SimpleEditorContext : MenuId.EditorContext);\n        // Show menu if we have actions to show\n        if (menuActions.length > 0) {\n            this._doShowContextMenu(menuActions, anchor);\n        }\n    }\n    _getMenuActions(model, menuId) {\n        const result = [];\n        // get menu groups\n        const menu = this._menuService.createMenu(menuId, this._contextKeyService);\n        const groups = menu.getActions({ arg: model.uri });\n        menu.dispose();\n        // translate them into other actions\n        for (let group of groups) {\n            const [, actions] = group;\n            let addedItems = 0;\n            for (const action of actions) {\n                if (action instanceof SubmenuItemAction) {\n                    const subActions = this._getMenuActions(model, action.item.submenu);\n                    if (subActions.length > 0) {\n                        result.push(new SubmenuAction(action.id, action.label, subActions));\n                        addedItems++;\n                    }\n                }\n                else {\n                    result.push(action);\n                    addedItems++;\n                }\n            }\n            if (addedItems) {\n                result.push(new Separator());\n            }\n        }\n        if (result.length) {\n            result.pop(); // remove last separator\n        }\n        return result;\n    }\n    _doShowContextMenu(actions, anchor = null) {\n        if (!this._editor.hasModel()) {\n            return;\n        }\n        // Disable hover\n        const oldHoverSetting = this._editor.getOption(53 /* hover */);\n        this._editor.updateOptions({\n            hover: {\n                enabled: false\n            }\n        });\n        if (!anchor) {\n            // Ensure selection is visible\n            this._editor.revealPosition(this._editor.getPosition(), 1 /* Immediate */);\n            this._editor.render();\n            const cursorCoords = this._editor.getScrolledVisiblePosition(this._editor.getPosition());\n            // Translate to absolute editor position\n            const editorCoords = dom.getDomNodePagePosition(this._editor.getDomNode());\n            const posx = editorCoords.left + cursorCoords.left;\n            const posy = editorCoords.top + cursorCoords.top + cursorCoords.height;\n            anchor = { x: posx, y: posy };\n        }\n        const useShadowDOM = this._editor.getOption(115 /* useShadowDOM */) && !isIOS; // Do not use shadow dom on IOS #122035\n        // Show menu\n        this._contextMenuIsBeingShownCount++;\n        this._contextMenuService.showContextMenu({\n            domForShadowRoot: useShadowDOM ? this._editor.getDomNode() : undefined,\n            getAnchor: () => anchor,\n            getActions: () => actions,\n            getActionViewItem: (action) => {\n                const keybinding = this._keybindingFor(action);\n                if (keybinding) {\n                    return new ActionViewItem(action, action, { label: true, keybinding: keybinding.getLabel(), isMenu: true });\n                }\n                const customActionViewItem = action;\n                if (typeof customActionViewItem.getActionViewItem === 'function') {\n                    return customActionViewItem.getActionViewItem();\n                }\n                return new ActionViewItem(action, action, { icon: true, label: true, isMenu: true });\n            },\n            getKeyBinding: (action) => {\n                return this._keybindingFor(action);\n            },\n            onHide: (wasCancelled) => {\n                this._contextMenuIsBeingShownCount--;\n                this._editor.focus();\n                this._editor.updateOptions({\n                    hover: oldHoverSetting\n                });\n            }\n        });\n    }\n    _keybindingFor(action) {\n        return this._keybindingService.lookupKeybinding(action.id);\n    }\n    dispose() {\n        if (this._contextMenuIsBeingShownCount > 0) {\n            this._contextViewService.hideContextView();\n        }\n        this._toDispose.dispose();\n    }\n};\nContextMenuController.ID = 'editor.contrib.contextmenu';\nContextMenuController = __decorate([\n    __param(1, IContextMenuService),\n    __param(2, IContextViewService),\n    __param(3, IContextKeyService),\n    __param(4, IKeybindingService),\n    __param(5, IMenuService)\n], ContextMenuController);\nexport { ContextMenuController };\nclass ShowContextMenu extends EditorAction {\n    constructor() {\n        super({\n            id: 'editor.action.showContextMenu',\n            label: nls.localize('action.showContextMenu.label', \"Show Editor Context Menu\"),\n            alias: 'Show Editor Context Menu',\n            precondition: undefined,\n            kbOpts: {\n                kbExpr: EditorContextKeys.textInputFocus,\n                primary: 1024 /* Shift */ | 68 /* F10 */,\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    run(accessor, editor) {\n        var _a;\n        (_a = ContextMenuController.get(editor)) === null || _a === void 0 ? void 0 : _a.showContextMenu();\n    }\n}\nregisterEditorContribution(ContextMenuController.ID, ContextMenuController);\nregisterEditorAction(ShowContextMenu);\n"]},"metadata":{},"sourceType":"module"}